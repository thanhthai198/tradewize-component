{"version":3,"names":["React","useEffect","useState","useCallback","View","Text","StyleSheet","Linking","CameraComponent","Modal","Camera","ButtonBase","CameraModal","visible","onClose","modalProps","audio","mode","onError","titleErrorPermission","txtButtonPermission","txtRequestingPermissions","txtOpenSettings","txtInitializingCamera","cameraProps","hasPermission","setHasPermission","hasAudioPermission","setHasAudioPermission","isRequestingPermissions","setIsRequestingPermissions","permissionDenied","setPermissionDenied","isLoading","setIsLoading","checkAndRequestPermissions","cameraStatus","getCameraPermissionStatus","cameraGranted","newCameraStatus","requestCameraPermission","microphoneStatus","getMicrophonePermissionStatus","audioGranted","newMicrophoneStatus","requestMicrophonePermission","error","console","timer","setTimeout","clearTimeout","undefined","openSettings","renderLoadingScreen","createElement","style","styles","loadingContainer","closeButton","onPress","closeButtonText","itemCenter","loadingText","renderPermissionScreen","permissionContainer","Fragment","permissionText","permissionButton","permissionButtonText","renderCameraComponent","_extends","propagateSwipe","isVisible","animationIn","animationOut","animationInTiming","animationOutTiming","useNativeDriver","margin","backgroundColor","create","flex","padding","color","fontSize","textAlign","marginTop","marginBottom","paddingHorizontal","paddingVertical","borderRadius","fontWeight","position","top","right","width","height","justifyContent","alignItems","zIndex"],"sources":["CommonCameraModal.tsx"],"sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\nimport { View, Text, StyleSheet, Linking } from 'react-native';\nimport { CameraComponent } from './CameraComponent';\nimport type { CameraProps } from './CameraComponent';\nimport Modal, { type ModalProps } from 'react-native-modal';\nimport { Camera } from 'react-native-vision-camera';\nimport { ButtonBase } from '../ButtonBase';\n\nexport interface CameraModalProps extends Omit<CameraProps, 'onClose'> {\n  visible: boolean;\n  onClose: () => void;\n  modalProps?: Partial<ModalProps>;\n  titleErrorPermission?: string;\n  txtButtonPermission?: string;\n  txtRequestingPermissions?: string;\n  txtOpenSettings?: string;\n  txtInitializingCamera?: string;\n}\n\nexport const CameraModal: React.FC<CameraModalProps> = ({\n  visible,\n  onClose,\n  modalProps,\n  audio = true,\n  mode = 'both',\n  onError,\n  titleErrorPermission = 'Camera permission is required',\n  txtButtonPermission = 'Grant Permission',\n  txtRequestingPermissions = 'Requesting permissions...',\n  txtOpenSettings = 'Open Settings',\n  txtInitializingCamera = 'Initializing camera...',\n  ...cameraProps\n}) => {\n  const [hasPermission, setHasPermission] = useState<boolean>(false);\n  const [hasAudioPermission, setHasAudioPermission] = useState<boolean>(false);\n  const [isRequestingPermissions, setIsRequestingPermissions] =\n    useState<boolean>(false);\n  const [permissionDenied, setPermissionDenied] = useState<boolean>(false);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n\n  // Check and request permissions when modal becomes visible\n  const checkAndRequestPermissions = useCallback(async () => {\n    try {\n      setIsRequestingPermissions(true);\n\n      // Check camera permission\n      const cameraStatus = await Camera.getCameraPermissionStatus();\n\n      let cameraGranted = cameraStatus === 'granted';\n\n      // Request camera permission if not granted\n      if (!cameraGranted) {\n        const newCameraStatus = await Camera.requestCameraPermission();\n        cameraGranted = newCameraStatus === 'granted';\n        setHasPermission(cameraGranted);\n\n        if (!cameraGranted) {\n          // Kiểm tra xem quyền có bị từ chối vĩnh viễn không\n          if (newCameraStatus === 'denied') {\n            setPermissionDenied(true);\n          }\n          onError?.('Camera permission is required');\n        } else {\n          setPermissionDenied(false);\n        }\n      } else {\n        setHasPermission(cameraGranted);\n        setPermissionDenied(false);\n      }\n\n      // Check microphone permission if audio is enabled\n      if (audio && (mode === 'video' || mode === 'both')) {\n        const microphoneStatus = await Camera.getMicrophonePermissionStatus();\n        let audioGranted = microphoneStatus === 'granted';\n\n        // Request microphone permission if not granted\n        if (!audioGranted) {\n          const newMicrophoneStatus =\n            await Camera.requestMicrophonePermission();\n          audioGranted = newMicrophoneStatus === 'granted';\n          setHasAudioPermission(audioGranted);\n\n          if (!audioGranted) {\n            onError?.(\n              'Microphone permission is required for video recording with audio'\n            );\n          }\n        } else {\n          setHasAudioPermission(audioGranted);\n        }\n      } else {\n        setHasAudioPermission(true);\n      }\n    } catch (error) {\n      console.error('Error checking/requesting permissions:', error);\n      onError?.('Failed to request camera permissions');\n    } finally {\n      setIsLoading(false);\n      setIsRequestingPermissions(false);\n    }\n  }, [audio, mode, onError]);\n\n  // Check and request permissions when modal becomes visible\n  useEffect(() => {\n    if (visible) {\n      // Hiển thị loading ngay lập tức\n      setIsLoading(true);\n\n      // Delay để modal mở xong rồi mới xin quyền\n      const timer = setTimeout(() => {\n        checkAndRequestPermissions();\n      }, 500); // Delay 500ms để loading hiển thị đủ lâu\n\n      return () => clearTimeout(timer);\n    } else {\n      return undefined;\n    }\n  }, [visible, checkAndRequestPermissions]);\n\n  const openSettings = useCallback(() => {\n    Linking.openSettings();\n  }, []);\n\n  const renderLoadingScreen = () => (\n    <View style={styles.loadingContainer}>\n      <ButtonBase style={styles.closeButton} onPress={onClose}>\n        <Text style={styles.closeButtonText}>✕</Text>\n      </ButtonBase>\n      <View style={styles.itemCenter}>\n        <Text style={styles.loadingText}>{txtInitializingCamera}</Text>\n      </View>\n    </View>\n  );\n\n  const renderPermissionScreen = () => (\n    <View style={styles.permissionContainer}>\n      <ButtonBase style={styles.closeButton} onPress={onClose}>\n        <Text style={styles.closeButtonText}>✕</Text>\n      </ButtonBase>\n      <View style={styles.itemCenter}>\n        {isRequestingPermissions ? (\n          <>\n            <Text style={styles.permissionText}>\n              {txtRequestingPermissions}\n            </Text>\n          </>\n        ) : (\n          <>\n            <Text style={styles.permissionText}>{titleErrorPermission}</Text>\n            {permissionDenied ? (\n              <ButtonBase\n                style={styles.permissionButton}\n                onPress={openSettings}\n              >\n                <Text style={styles.permissionButtonText}>\n                  {txtOpenSettings}\n                </Text>\n              </ButtonBase>\n            ) : (\n              <ButtonBase\n                style={styles.permissionButton}\n                onPress={checkAndRequestPermissions}\n              >\n                <Text style={styles.permissionButtonText}>\n                  {txtButtonPermission}\n                </Text>\n              </ButtonBase>\n            )}\n          </>\n        )}\n      </View>\n    </View>\n  );\n\n  const renderCameraComponent = () => (\n    <CameraComponent\n      {...cameraProps}\n      mode={mode}\n      onClose={onClose}\n      hasPermission={hasPermission}\n      hasAudioPermission={hasAudioPermission}\n      audio={audio}\n    />\n  );\n\n  return (\n    <Modal\n      propagateSwipe={false}\n      isVisible={visible}\n      animationIn=\"slideInUp\"\n      animationOut=\"slideOutDown\"\n      animationInTiming={300}\n      animationOutTiming={300}\n      useNativeDriver={true}\n      style={{ margin: 0, backgroundColor: 'black' }}\n      {...modalProps}\n    >\n      {isLoading\n        ? renderLoadingScreen()\n        : hasPermission\n          ? renderCameraComponent()\n          : renderPermissionScreen()}\n    </Modal>\n  );\n};\nconst styles = StyleSheet.create({\n  loadingContainer: {\n    flex: 1,\n    backgroundColor: '#000',\n    padding: 20,\n  },\n  loadingText: {\n    color: '#FFFFFF',\n    fontSize: 16,\n    textAlign: 'center',\n    marginTop: 10,\n  },\n  permissionContainer: {\n    flex: 1,\n    backgroundColor: '#000',\n    padding: 20,\n  },\n  permissionText: {\n    color: '#FFFFFF',\n    fontSize: 16,\n    textAlign: 'center',\n    marginBottom: 20,\n  },\n  permissionButton: {\n    backgroundColor: '#007AFF',\n    paddingHorizontal: 20,\n    paddingVertical: 10,\n    borderRadius: 8,\n  },\n  permissionButtonText: {\n    color: '#FFFFFF',\n    fontSize: 16,\n    fontWeight: '600',\n  },\n  closeButton: {\n    position: 'absolute',\n    top: 50,\n    right: 20,\n    width: 40,\n    height: 40,\n    borderRadius: 20,\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n    justifyContent: 'center',\n    alignItems: 'center',\n    zIndex: 1,\n  },\n  closeButtonText: {\n    color: '#FFFFFF',\n    fontSize: 20,\n    fontWeight: 'bold',\n  },\n  itemCenter: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n});\n"],"mappings":"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","ignoreList":[]}