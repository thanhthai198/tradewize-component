{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","Alert","Animated","Dimensions","Image","Keyboard","Modal","PanResponder","Platform","ScrollView","Text","TextInput","TouchableOpacity","View","styles","SafeAreaView","Canvas","Path","Skia","useImage","SkiaImage","useCanvasRef","Group","Rect","Circle","colors","ViewShot","IMG_WIDTH","get","width","IMG_HEIGHT","fontSize","ImageDrawingCanvas","props","visible","isModal","uriImage","onClose","onSave","titleCancel","contentCancel","txtBtnContinueCancel","txtBtnCancelCancel","txtBtnDone","txtBtnDoneEdit","canvasRef","image","textAnimationsRef","Map","viewShotRef","mode","setMode","paths","setPaths","history","setHistory","shapes","setShapes","currentPath","setCurrentPath","currentShape","setCurrentShape","shapeStartPos","setShapeStartPos","colorDraw","setColorDraw","showTextInput","setShowTextInput","currentInputText","setCurrentInputText","inputText","setInputText","editingTextId","setEditingTextId","editingTextValue","setEditingTextValue","colorText","setColorText","keyboardHeight","setKeyboardHeight","clipPath","path","Make","addRect","x","y","height","handleUndo","length","lastItem","type","prev","slice","handleDoneDraw","handleCapture","_viewShotRef$current","current","capture","uri","OS","error","console","createPanResponder","textId","textContent","textColor","hasMovedRef","create","onStartShouldSetPanResponder","onPanResponderGrant","panValue","setOffset","_value","setValue","onPanResponderMove","_","gestureState","Math","abs","dx","dy","event","useNativeDriver","onPanResponderRelease","flattenOffset","map","item","id","newId","Date","now","toString","text","color","set","ValueXY","onKeyboardShow","e","endCoordinates","onKeyboardHide","showSub","addListener","hideSub","remove","pan","locationX","locationY","nativeEvent","p","moveTo","newPath","copy","lineTo","min","radius","sqrt","pow","newPaths","h","pathIndex","shapeToAdd","newShapes","shapeIndex","renderHeaderControls","hasDrawing","createElement","style","headerControls","btnClose","onPress","undefined","txtUndo","txtDone","justifyContent","dismiss","alert","clear","txtClose","layoutCanvas","btnCanvas","tintColor","source","require","imgCanvas","transform","rotate","txtCanvasMore","renderFooterControls","footerDraw","keyboardShouldPersistTaps","horizontal","showsHorizontalScrollIndicator","key","btnColor","colorSelected","colorDot","backgroundColor","btnDone","transparent","containerModal","containerContent","flex","ref","options","format","quality","canvasContainer","_extends","panHandlers","clip","fit","pathWithColor","i","strokeWidth","shape","cx","cy","r","Fragment","opacity","element","has","panResponder","isEditing","movableBox","getTranslateTransform","textOverlay","value","onChangeText","selectionColor","autoFocus","multiline","onBlur","dimOverlay","pointerEvents","textInputOverlay","top","onFocus","footer","bottom","container"],"sources":["index.tsx"],"sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  Alert,\n  Animated,\n  Dimensions,\n  Image,\n  Keyboard,\n  Modal,\n  PanResponder,\n  Platform,\n  ScrollView,\n  Text,\n  TextInput,\n  TouchableOpacity,\n  View,\n  type KeyboardEvent,\n} from 'react-native';\nimport { styles } from './styles';\nimport { SafeAreaView } from 'react-native-safe-area-context';\nimport {\n  Canvas,\n  Path,\n  Skia,\n  useImage,\n  Image as SkiaImage,\n  useCanvasRef,\n  type SkPath,\n  Group,\n  Rect,\n  Circle,\n} from '@shopify/react-native-skia';\nimport {\n  colors,\n  type HistoryItem,\n  type IImageDrawingCanvas,\n  type IShapeStartPos,\n  type PathWithColor,\n  type Shape,\n  type TextItem,\n} from './types';\nimport ViewShot from 'react-native-view-shot';\n\nconst IMG_WIDTH = Dimensions.get('window').width;\nconst IMG_HEIGHT = Dimensions.get('window').width;\nconst fontSize = 22;\n\nconst ImageDrawingCanvas = (props: IImageDrawingCanvas) => {\n  const {\n    visible,\n    isModal,\n    uriImage,\n    onClose,\n    onSave,\n    titleCancel = 'Huỷ bỏ chỉnh sửa',\n    contentCancel = 'Bạn có chắc muốn huỷ bỏ tất cả chỉnh sửa?',\n    txtBtnContinueCancel = 'Tiếp tục',\n    txtBtnCancelCancel = 'Huỷ bỏ',\n    txtBtnDone = 'Hoàn thành',\n    txtBtnDoneEdit = 'Xong',\n  } = props;\n\n  // Hooks phải được gọi trước early return\n  const canvasRef = useCanvasRef();\n  const image = useImage(uriImage);\n\n  // Lưu trữ Animated values cho mỗi text\n  const textAnimationsRef = useRef<Map<string, Animated.ValueXY>>(new Map());\n  const viewShotRef = useRef<ViewShot>(null);\n\n  const [mode, setMode] = useState<'draw' | 'text' | 'rect' | 'circle' | null>(\n    null\n  );\n  const [paths, setPaths] = useState<PathWithColor[]>([]);\n  const [history, setHistory] = useState<HistoryItem[]>([]);\n  const [shapes, setShapes] = useState<Shape[]>([]);\n  const [currentPath, setCurrentPath] = useState<SkPath | null>(null);\n  const [currentShape, setCurrentShape] = useState<Shape | null>(null);\n  const [shapeStartPos, setShapeStartPos] = useState<IShapeStartPos | null>(\n    null\n  );\n\n  const [colorDraw, setColorDraw] = useState<string>(colors[0] || '');\n\n  const [showTextInput, setShowTextInput] = useState(false);\n  const [currentInputText, setCurrentInputText] = useState<string>('');\n  const [inputText, setInputText] = useState<TextItem[]>([]);\n  const [editingTextId, setEditingTextId] = useState<string | null>(null);\n  const [editingTextValue, setEditingTextValue] = useState<string>('');\n  const [colorText, setColorText] = useState<string>(colors[0] || '');\n\n  const [keyboardHeight, setKeyboardHeight] = useState(0);\n\n  const clipPath = useMemo(() => {\n    const path = Skia.Path.Make();\n    path.addRect({ x: 0, y: 0, width: IMG_WIDTH, height: IMG_HEIGHT });\n    return path;\n  }, []);\n\n  const handleUndo = useCallback(() => {\n    if (history.length === 0) return;\n\n    const lastItem = history[history.length - 1];\n\n    if (lastItem?.type === 'path') {\n      setPaths((prev) => prev.slice(0, -1));\n    } else if (lastItem?.type === 'shape') {\n      setShapes((prev) => prev.slice(0, -1));\n    }\n\n    setHistory((prev) => prev.slice(0, -1));\n  }, [history]);\n\n  const handleDoneDraw = useCallback(() => {\n    setMode(null);\n  }, []);\n\n  const handleCapture = useCallback(async () => {\n    try {\n      if (viewShotRef.current?.capture) {\n        const uri = await viewShotRef.current.capture();\n        // Có thể return uri này hoặc gọi callback\n        return Platform.OS === 'ios' ? `file://${uri}` : uri;\n      }\n      return null;\n    } catch (error) {\n      console.error('Error capturing image:', error);\n      return null;\n    }\n  }, []);\n\n  const createPanResponder = (\n    textId: string,\n    textContent: string,\n    textColor: string\n  ) => {\n    let hasMovedRef = false;\n\n    return PanResponder.create({\n      onStartShouldSetPanResponder: () => true,\n      onPanResponderGrant: () => {\n        hasMovedRef = false;\n        const panValue = textAnimationsRef.current.get(textId);\n        if (panValue) {\n          panValue.setOffset({\n            x: (panValue.x as any)._value,\n            y: (panValue.y as any)._value,\n          });\n          panValue.setValue({ x: 0, y: 0 });\n        }\n      },\n      onPanResponderMove: (_, gestureState) => {\n        // Nếu di chuyển quá 5px thì coi như đang kéo\n        if (Math.abs(gestureState.dx) > 5 || Math.abs(gestureState.dy) > 5) {\n          hasMovedRef = true;\n        }\n\n        const panValue = textAnimationsRef.current.get(textId);\n        if (panValue && hasMovedRef) {\n          Animated.event([null, { dx: panValue.x, dy: panValue.y }], {\n            useNativeDriver: false,\n          })(_, gestureState);\n        }\n      },\n      onPanResponderRelease: () => {\n        const panValue = textAnimationsRef.current.get(textId);\n\n        if (!hasMovedRef) {\n          // Nếu không có movement, đây là tap -> mở edit mode\n          setMode('text');\n          setEditingTextId(textId);\n          setEditingTextValue(textContent);\n          setColorText(textColor);\n          if (panValue) {\n            // Reset về vị trí cũ\n            panValue.setValue({ x: 0, y: 0 });\n            panValue.flattenOffset();\n          }\n        } else if (panValue) {\n          // Nếu có movement, lưu vị trí mới\n          panValue.flattenOffset();\n          setInputText((prev) =>\n            prev.map((item) =>\n              item.id === textId\n                ? {\n                    ...item,\n                    x: (panValue.x as any)._value,\n                    y: (panValue.y as any)._value,\n                  }\n                : item\n            )\n          );\n        }\n      },\n    });\n  };\n\n  useEffect(() => {\n    if (!showTextInput && currentInputText?.length > 0) {\n      const newId = Date.now().toString();\n      setCurrentInputText('');\n      setInputText((prev) => [\n        ...prev,\n        {\n          text: currentInputText,\n          id: newId,\n          x: -IMG_WIDTH / 2,\n          y: -IMG_HEIGHT / 2,\n          color: colorText,\n        },\n      ]);\n      // Tạo Animated value mới cho text này\n      textAnimationsRef.current.set(\n        newId,\n        new Animated.ValueXY({\n          x: -IMG_WIDTH / 2,\n          y: -IMG_HEIGHT / 2,\n        })\n      );\n    }\n  }, [currentInputText, showTextInput, colorText]);\n\n  useEffect(() => {\n    const onKeyboardShow = (e: KeyboardEvent) => {\n      setKeyboardHeight(e.endCoordinates.height);\n    };\n\n    const onKeyboardHide = () => {\n      setKeyboardHeight(0);\n    };\n\n    const showSub = Keyboard.addListener('keyboardDidShow', onKeyboardShow);\n    const hideSub = Keyboard.addListener('keyboardDidHide', onKeyboardHide);\n\n    return () => {\n      showSub.remove();\n      hideSub.remove();\n    };\n  }, []);\n\n  const pan = useMemo(\n    () =>\n      PanResponder.create({\n        onStartShouldSetPanResponder: () => true,\n        onPanResponderGrant: (e) => {\n          const { locationX, locationY } = e.nativeEvent;\n\n          if (mode === 'draw') {\n            const p = Skia.Path.Make();\n            p.moveTo(locationX, locationY);\n            setCurrentPath(p);\n          } else if (mode === 'rect' || mode === 'circle') {\n            // Only set start position, wait for move to create shape\n            setShapeStartPos({ x: locationX, y: locationY });\n          }\n        },\n        onPanResponderMove: (e) => {\n          const { locationX, locationY } = e.nativeEvent;\n\n          if (mode === 'draw' && currentPath) {\n            const newPath = currentPath.copy();\n            newPath.lineTo(locationX, locationY);\n            setCurrentPath(newPath);\n          } else if ((mode === 'rect' || mode === 'circle') && shapeStartPos) {\n            if (mode === 'rect') {\n              setCurrentShape({\n                type: 'rect',\n                x: Math.min(shapeStartPos.x, locationX),\n                y: Math.min(shapeStartPos.y, locationY),\n                width: Math.abs(locationX - shapeStartPos.x),\n                height: Math.abs(locationY - shapeStartPos.y),\n              });\n            } else {\n              const radius = Math.sqrt(\n                Math.pow(locationX - shapeStartPos.x, 2) +\n                  Math.pow(locationY - shapeStartPos.y, 2)\n              );\n              setCurrentShape({\n                type: 'circle',\n                x: shapeStartPos.x,\n                y: shapeStartPos.y,\n                radius: radius,\n              });\n            }\n          }\n        },\n        onPanResponderRelease: () => {\n          if (mode === 'draw' && currentPath) {\n            setPaths((prev) => {\n              const newPaths = [\n                ...prev,\n                { path: currentPath, color: colorDraw },\n              ];\n              setHistory((h) => [\n                ...h,\n                { type: 'path', pathIndex: newPaths.length - 1 },\n              ]);\n              return newPaths;\n            });\n            setCurrentPath(null);\n          } else if ((mode === 'rect' || mode === 'circle') && currentShape) {\n            // Batch state updates to prevent UI flickering\n            const shapeToAdd = currentShape;\n            setCurrentShape(null);\n            setShapeStartPos(null);\n            setShapes((prev) => {\n              const newShapes = [...prev, shapeToAdd];\n              setHistory((h) => [\n                ...h,\n                { type: 'shape', shapeIndex: newShapes.length - 1 },\n              ]);\n              return newShapes;\n            });\n          }\n        },\n      }),\n    [mode, currentPath, currentShape, shapeStartPos, colorDraw]\n  );\n\n  const renderHeaderControls = useMemo(() => {\n    const hasDrawing =\n      paths?.length > 0 || shapes?.length > 0 || inputText?.length > 0;\n    if (mode === 'draw') {\n      return (\n        <View style={styles.headerControls}>\n          <TouchableOpacity\n            style={styles.btnClose}\n            onPress={paths?.length > 0 ? handleUndo : undefined}\n          >\n            {paths?.length > 0 && <Text style={styles.txtUndo}>Hoàn tác</Text>}\n          </TouchableOpacity>\n\n          <TouchableOpacity style={styles.btnClose} onPress={handleDoneDraw}>\n            <Text style={styles.txtDone}>{txtBtnDoneEdit}</Text>\n          </TouchableOpacity>\n        </View>\n      );\n    }\n    if (mode === 'text') {\n      return (\n        <View style={[styles.headerControls, { justifyContent: 'flex-end' }]}>\n          <TouchableOpacity\n            style={styles.btnClose}\n            onPress={() => {\n              handleDoneDraw();\n              Keyboard.dismiss();\n            }}\n          >\n            <Text style={styles.txtDone}>{txtBtnDoneEdit}</Text>\n          </TouchableOpacity>\n        </View>\n      );\n    }\n    return (\n      <View style={styles.headerControls}>\n        <TouchableOpacity\n          style={styles.btnClose}\n          onPress={() => {\n            if (hasDrawing) {\n              Alert.alert(titleCancel, contentCancel, [\n                {\n                  text: txtBtnContinueCancel,\n                  style: 'cancel',\n                },\n                {\n                  text: txtBtnCancelCancel,\n                  style: 'destructive',\n                  onPress: () => {\n                    onClose();\n                    setPaths([]);\n                    setCurrentPath(null);\n                    setShapes([]);\n                    setCurrentShape(null);\n                    setShapeStartPos(null);\n                    setColorDraw(colors[0] || '');\n                    setInputText([]);\n                    setHistory([]);\n                    // Xóa tất cả animations\n                    textAnimationsRef.current.clear();\n                  },\n                },\n              ]);\n            } else {\n              onClose();\n              setPaths([]);\n              setCurrentPath(null);\n              setShapes([]);\n              setCurrentShape(null);\n              setShapeStartPos(null);\n              setColorDraw(colors[0] || '');\n              setInputText([]);\n              setHistory([]);\n              // Xóa tất cả animations\n              textAnimationsRef.current.clear();\n            }\n          }}\n        >\n          <Text style={styles.txtClose}>X</Text>\n        </TouchableOpacity>\n\n        <View style={styles.layoutCanvas}>\n          <TouchableOpacity\n            onPress={() => {\n              setMode('draw');\n              setShowTextInput(false);\n            }}\n            style={styles.btnCanvas}\n          >\n            <Image\n              tintColor={'white'}\n              source={require('./assets/line.png')}\n              style={[styles.imgCanvas, { transform: [{ rotate: '45deg' }] }]}\n            />\n          </TouchableOpacity>\n          <TouchableOpacity\n            onPress={() => {\n              setMode('text');\n              setShowTextInput(true);\n              setColorText(colors[0] || '');\n            }}\n            style={styles.btnCanvas}\n          >\n            <Text style={styles.txtCanvasMore}>Aa</Text>\n          </TouchableOpacity>\n          {/* <TouchableOpacity style={styles.btnCanvas}>\n            <Image\n              tintColor={'white'}\n              source={require('./assets/crop.png')}\n              style={styles.imgCanvas}\n            />\n          </TouchableOpacity> */}\n          {/* <TouchableOpacity\n            style={styles.btnCanvas}\n            onPress={async () => {\n              const uri = await handleCapture();\n              if (uri && onSave) {\n                onSave(uri);\n              }\n            }}\n          >\n            <Image\n              tintColor={'white'}\n              source={require('./assets/download.png')}\n              style={styles.imgCanvas}\n            />\n          </TouchableOpacity> */}\n        </View>\n      </View>\n    );\n  }, [\n    paths?.length,\n    shapes?.length,\n    inputText?.length,\n    mode,\n    handleUndo,\n    handleDoneDraw,\n    txtBtnDoneEdit,\n    titleCancel,\n    contentCancel,\n    txtBtnContinueCancel,\n    txtBtnCancelCancel,\n    onClose,\n  ]);\n\n  const renderFooterControls = useMemo(() => {\n    if (mode === 'draw') {\n      return (\n        <View style={styles.footerDraw}>\n          {/* <TouchableOpacity style={[styles.btnEaser]}>\n            <Image\n              tintColor={'white'}\n              source={require('./assets/eraser_white.png')}\n              style={styles.btnEaserImage}\n            />\n          </TouchableOpacity> */}\n\n          <ScrollView\n            keyboardShouldPersistTaps=\"always\"\n            horizontal\n            showsHorizontalScrollIndicator={false}\n          >\n            {colors.map((color) => (\n              <TouchableOpacity\n                onPress={() => {\n                  setColorDraw(color);\n                }}\n                key={color}\n                style={[\n                  styles.btnColor,\n                  colorDraw === color && styles.colorSelected,\n                ]}\n              >\n                <View style={[styles.colorDot, { backgroundColor: color }]} />\n              </TouchableOpacity>\n            ))}\n          </ScrollView>\n        </View>\n      );\n    }\n\n    if (mode === 'text') {\n      return (\n        <View style={styles.footerDraw}>\n          <ScrollView\n            keyboardShouldPersistTaps=\"always\"\n            horizontal\n            showsHorizontalScrollIndicator={false}\n          >\n            {colors.map((color) => (\n              <TouchableOpacity\n                onPress={() => {\n                  setColorText(color);\n                }}\n                key={color}\n                style={[\n                  styles.btnColor,\n                  colorText === color && styles.colorSelected,\n                ]}\n              >\n                <View style={[styles.colorDot, { backgroundColor: color }]} />\n              </TouchableOpacity>\n            ))}\n          </ScrollView>\n        </View>\n      );\n    }\n    const hasDrawing =\n      paths?.length > 0 || shapes?.length > 0 || inputText?.length > 0;\n    return (\n      <View style={styles.footerDraw}>\n        {hasDrawing && (\n          <TouchableOpacity\n            style={styles.btnDone}\n            onPress={async () => {\n              const uri = await handleCapture();\n              if (uri && onSave) {\n                onSave(uri);\n              }\n\n              handleDoneDraw();\n              onClose();\n              setPaths([]);\n              setCurrentPath(null);\n              setShapes([]);\n              setCurrentShape(null);\n              setShapeStartPos(null);\n              setColorDraw(colors[0] || '');\n              setInputText([]);\n              setHistory([]);\n              // Xóa tất cả animations\n              textAnimationsRef.current.clear();\n            }}\n          >\n            <Text style={[styles.txtDone, { color: 'black' }]}>\n              {txtBtnDone}\n            </Text>\n          </TouchableOpacity>\n        )}\n      </View>\n    );\n  }, [\n    mode,\n    txtBtnDone,\n    colorDraw,\n    colorText,\n    paths.length,\n    shapes.length,\n    inputText.length,\n    handleDoneDraw,\n    onClose,\n    handleCapture,\n    onSave,\n  ]);\n\n  if (!visible) {\n    return null;\n  }\n\n  if (isModal) {\n    return (\n      <Modal visible={visible} transparent>\n        <SafeAreaView style={styles.containerModal}>\n          <View style={styles.containerContent}>\n            {renderHeaderControls}\n\n            <ViewShot\n              style={{ flex: 1 }}\n              ref={viewShotRef}\n              options={{\n                format: 'jpg',\n                quality: 0.9,\n              }}\n            >\n              <View style={styles.canvasContainer}>\n                <Canvas\n                  ref={canvasRef as any}\n                  style={{ width: IMG_WIDTH, height: IMG_HEIGHT }}\n                  {...pan.panHandlers}\n                >\n                  <Group clip={clipPath}>\n                    {/* Image nền */}\n                    {image && (\n                      <SkiaImage\n                        image={image}\n                        x={0}\n                        y={0}\n                        width={IMG_WIDTH}\n                        height={IMG_HEIGHT}\n                        fit=\"contain\"\n                      />\n                    )}\n\n                    {/* Nét vẽ */}\n                    {paths.map((pathWithColor, i) => (\n                      <Path\n                        key={`path-${i}`}\n                        path={pathWithColor.path}\n                        color={pathWithColor.color}\n                        style=\"stroke\"\n                        strokeWidth={4}\n                      />\n                    ))}\n                    {currentPath && (\n                      <Path\n                        path={currentPath}\n                        color={colorDraw}\n                        style=\"stroke\"\n                        strokeWidth={4}\n                      />\n                    )}\n\n                    {/* Hình vẽ */}\n                    {shapes.map((shape, i) => {\n                      if (\n                        shape.type === 'rect' &&\n                        shape.width &&\n                        shape.height\n                      ) {\n                        return (\n                          <Rect\n                            key={`rect-${i}`}\n                            x={shape.x}\n                            y={shape.y}\n                            width={shape.width}\n                            height={shape.height}\n                            color=\"green\"\n                            style=\"stroke\"\n                            strokeWidth={3}\n                          />\n                        );\n                      }\n                      if (shape.type === 'circle' && shape.radius) {\n                        return (\n                          <Circle\n                            key={`circle-${i}`}\n                            cx={shape.x}\n                            cy={shape.y}\n                            r={shape.radius}\n                            color=\"blue\"\n                            style=\"stroke\"\n                            strokeWidth={3}\n                          />\n                        );\n                      }\n                      return <React.Fragment key={`empty-${i}`} />;\n                    })}\n\n                    {/* Hình đang kéo */}\n                    {currentShape?.type === 'rect' &&\n                      currentShape.width &&\n                      currentShape.height && (\n                        <Rect\n                          x={currentShape.x}\n                          y={currentShape.y}\n                          width={currentShape.width}\n                          height={currentShape.height}\n                          color=\"green\"\n                          style=\"stroke\"\n                          strokeWidth={3}\n                          opacity={1}\n                        />\n                      )}\n                    {currentShape?.type === 'circle' && currentShape.radius && (\n                      <Circle\n                        cx={currentShape.x}\n                        cy={currentShape.y}\n                        r={currentShape.radius}\n                        color=\"blue\"\n                        style=\"stroke\"\n                        strokeWidth={3}\n                        opacity={1}\n                      />\n                    )}\n                  </Group>\n                </Canvas>\n\n                {(mode === 'text' || inputText.length > 0) && (\n                  <View>\n                    {inputText?.map((element) => {\n                      // Lấy hoặc tạo animation value cho text này\n                      if (!textAnimationsRef.current.has(element.id)) {\n                        textAnimationsRef.current.set(\n                          element.id,\n                          new Animated.ValueXY({ x: element.x, y: element.y })\n                        );\n                      }\n                      const panValue = textAnimationsRef.current.get(\n                        element.id\n                      );\n                      const panResponder = createPanResponder(\n                        element.id,\n                        element.text,\n                        element.color\n                      );\n                      const isEditing = editingTextId === element.id;\n\n                      return (\n                        <Animated.View\n                          key={element.id}\n                          {...(!isEditing ? panResponder.panHandlers : {})}\n                          style={[\n                            styles.movableBox,\n                            {\n                              transform:\n                                panValue?.getTranslateTransform() ?? [],\n                            },\n                          ]}\n                        >\n                          {isEditing ? (\n                            <TextInput\n                              style={[\n                                styles.textOverlay,\n                                { color: colorText, fontSize },\n                              ]}\n                              value={editingTextValue}\n                              onChangeText={setEditingTextValue}\n                              selectionColor={colorText}\n                              autoFocus\n                              multiline\n                              onBlur={() => {\n                                // Lưu text và màu mới khi mất focus\n                                setInputText((prev) =>\n                                  prev.map((item) =>\n                                    item.id === element.id\n                                      ? {\n                                          ...item,\n                                          text: editingTextValue,\n                                          color: colorText,\n                                        }\n                                      : item\n                                  )\n                                );\n                                setMode(null);\n                                setEditingTextId(null);\n                                setEditingTextValue('');\n                              }}\n                            />\n                          ) : (\n                            <Text\n                              style={[\n                                styles.textOverlay,\n                                { color: element.color, fontSize },\n                              ]}\n                            >\n                              {element.text}\n                            </Text>\n                          )}\n                        </Animated.View>\n                      );\n                    })}\n                  </View>\n                )}\n\n                {showTextInput && (\n                  <>\n                    <View style={styles.dimOverlay} pointerEvents=\"none\" />\n                    <TextInput\n                      // key={colorText}\n                      style={[\n                        styles.textInputOverlay,\n                        {\n                          fontSize,\n                          top: IMG_HEIGHT / 2,\n                          color: colorText,\n                        },\n                      ]}\n                      value={currentInputText}\n                      onChangeText={setCurrentInputText}\n                      selectionColor={colorText}\n                      autoFocus\n                      onFocus={() => setShowTextInput(true)}\n                      onBlur={() => setShowTextInput(false)}\n                      multiline\n                    />\n                  </>\n                )}\n              </View>\n            </ViewShot>\n\n            <View style={[styles.footer, { bottom: keyboardHeight * 0.8 }]}>\n              {renderFooterControls}\n            </View>\n          </View>\n        </SafeAreaView>\n      </Modal>\n    );\n  }\n\n  return (\n    <SafeAreaView style={styles.container}>\n      <View style={styles.containerContent}>\n        {renderHeaderControls}\n\n        <ViewShot\n          style={{ flex: 1 }}\n          ref={viewShotRef}\n          options={{\n            format: 'jpg',\n            quality: 0.9,\n          }}\n        >\n          <View style={styles.canvasContainer}>\n            <Canvas\n              ref={canvasRef as any}\n              style={{ width: IMG_WIDTH, height: IMG_HEIGHT }}\n              {...pan.panHandlers}\n            >\n              <Group clip={clipPath}>\n                {/* Image nền */}\n                {image && (\n                  <SkiaImage\n                    image={image}\n                    x={0}\n                    y={0}\n                    width={IMG_WIDTH}\n                    height={IMG_HEIGHT}\n                    fit=\"contain\"\n                  />\n                )}\n\n                {/* Nét vẽ */}\n                {paths.map((pathWithColor, i) => (\n                  <Path\n                    key={`path-${i}`}\n                    path={pathWithColor.path}\n                    color={pathWithColor.color}\n                    style=\"stroke\"\n                    strokeWidth={4}\n                  />\n                ))}\n                {currentPath && (\n                  <Path\n                    path={currentPath}\n                    color={colorDraw}\n                    style=\"stroke\"\n                    strokeWidth={4}\n                  />\n                )}\n\n                {/* Hình vẽ */}\n                {shapes.map((shape, i) => {\n                  if (shape.type === 'rect' && shape.width && shape.height) {\n                    return (\n                      <Rect\n                        key={`rect-${i}`}\n                        x={shape.x}\n                        y={shape.y}\n                        width={shape.width}\n                        height={shape.height}\n                        color=\"green\"\n                        style=\"stroke\"\n                        strokeWidth={3}\n                      />\n                    );\n                  }\n                  if (shape.type === 'circle' && shape.radius) {\n                    return (\n                      <Circle\n                        key={`circle-${i}`}\n                        cx={shape.x}\n                        cy={shape.y}\n                        r={shape.radius}\n                        color=\"blue\"\n                        style=\"stroke\"\n                        strokeWidth={3}\n                      />\n                    );\n                  }\n                  return <React.Fragment key={`empty-${i}`} />;\n                })}\n\n                {/* Hình đang kéo */}\n                {currentShape?.type === 'rect' &&\n                  currentShape.width &&\n                  currentShape.height && (\n                    <Rect\n                      x={currentShape.x}\n                      y={currentShape.y}\n                      width={currentShape.width}\n                      height={currentShape.height}\n                      color=\"green\"\n                      style=\"stroke\"\n                      strokeWidth={3}\n                      opacity={1}\n                    />\n                  )}\n                {currentShape?.type === 'circle' && currentShape.radius && (\n                  <Circle\n                    cx={currentShape.x}\n                    cy={currentShape.y}\n                    r={currentShape.radius}\n                    color=\"blue\"\n                    style=\"stroke\"\n                    strokeWidth={3}\n                    opacity={1}\n                  />\n                )}\n              </Group>\n            </Canvas>\n\n            {(mode === 'text' || inputText.length > 0) && (\n              <View>\n                {inputText?.map((element) => {\n                  // Lấy hoặc tạo animation value cho text này\n                  if (!textAnimationsRef.current.has(element.id)) {\n                    textAnimationsRef.current.set(\n                      element.id,\n                      new Animated.ValueXY({ x: element.x, y: element.y })\n                    );\n                  }\n                  const panValue = textAnimationsRef.current.get(element.id);\n                  const panResponder = createPanResponder(\n                    element.id,\n                    element.text,\n                    element.color\n                  );\n                  const isEditing = editingTextId === element.id;\n\n                  return (\n                    <Animated.View\n                      key={element.id}\n                      {...(!isEditing ? panResponder.panHandlers : {})}\n                      style={[\n                        styles.movableBox,\n                        {\n                          transform: panValue?.getTranslateTransform() ?? [],\n                        },\n                      ]}\n                    >\n                      {isEditing ? (\n                        <TextInput\n                          style={[\n                            styles.textOverlay,\n                            { color: colorText, fontSize },\n                          ]}\n                          value={editingTextValue}\n                          onChangeText={setEditingTextValue}\n                          selectionColor={colorText}\n                          autoFocus\n                          multiline\n                          onBlur={() => {\n                            // Lưu text và màu mới khi mất focus\n                            setInputText((prev) =>\n                              prev.map((item) =>\n                                item.id === element.id\n                                  ? {\n                                      ...item,\n                                      text: editingTextValue,\n                                      color: colorText,\n                                    }\n                                  : item\n                              )\n                            );\n                            setMode(null);\n                            setEditingTextId(null);\n                            setEditingTextValue('');\n                          }}\n                        />\n                      ) : (\n                        <Text\n                          style={[\n                            styles.textOverlay,\n                            { color: element.color, fontSize },\n                          ]}\n                        >\n                          {element.text}\n                        </Text>\n                      )}\n                    </Animated.View>\n                  );\n                })}\n              </View>\n            )}\n\n            {showTextInput && (\n              <>\n                <View style={styles.dimOverlay} pointerEvents=\"none\" />\n                <TextInput\n                  // key={colorText}\n                  style={[\n                    styles.textInputOverlay,\n                    {\n                      fontSize,\n                      top: IMG_HEIGHT / 2,\n                      color: colorText,\n                    },\n                  ]}\n                  value={currentInputText}\n                  onChangeText={setCurrentInputText}\n                  selectionColor={colorText}\n                  autoFocus\n                  onFocus={() => setShowTextInput(true)}\n                  onBlur={() => setShowTextInput(false)}\n                  multiline\n                />\n              </>\n            )}\n          </View>\n        </ViewShot>\n\n        <View style={[styles.footer, { bottom: keyboardHeight * 0.7 }]}>\n          {renderFooterControls}\n        </View>\n      </View>\n    </SafeAreaView>\n  );\n};\n\nexport default ImageDrawingCanvas;\n"],"mappings":";AAAA,OAAOA,KAAK,IACVC,WAAW,EACXC,SAAS,EACTC,OAAO,EACPC,MAAM,EACNC,QAAQ,QACH,OAAO;AACd,SACEC,KAAK,EACLC,QAAQ,EACRC,UAAU,EACVC,KAAK,EACLC,QAAQ,EACRC,KAAK,EACLC,YAAY,EACZC,QAAQ,EACRC,UAAU,EACVC,IAAI,EACJC,SAAS,EACTC,gBAAgB,EAChBC,IAAI,QAEC,cAAc;AACrB,SAASC,MAAM,QAAQ,UAAU;AACjC,SAASC,YAAY,QAAQ,gCAAgC;AAC7D,SACEC,MAAM,EACNC,IAAI,EACJC,IAAI,EACJC,QAAQ,EACRf,KAAK,IAAIgB,SAAS,EAClBC,YAAY,EAEZC,KAAK,EACLC,IAAI,EACJC,MAAM,QACD,4BAA4B;AACnC,SACEC,MAAM,QAOD,SAAS;AAChB,OAAOC,QAAQ,MAAM,wBAAwB;AAE7C,MAAMC,SAAS,GAAGxB,UAAU,CAACyB,GAAG,CAAC,QAAQ,CAAC,CAACC,KAAK;AAChD,MAAMC,UAAU,GAAG3B,UAAU,CAACyB,GAAG,CAAC,QAAQ,CAAC,CAACC,KAAK;AACjD,MAAME,QAAQ,GAAG,EAAE;AAEnB,MAAMC,kBAAkB,GAAIC,KAA0B,IAAK;EACzD,MAAM;IACJC,OAAO;IACPC,OAAO;IACPC,QAAQ;IACRC,OAAO;IACPC,MAAM;IACNC,WAAW,GAAG,kBAAkB;IAChCC,aAAa,GAAG,2CAA2C;IAC3DC,oBAAoB,GAAG,UAAU;IACjCC,kBAAkB,GAAG,QAAQ;IAC7BC,UAAU,GAAG,YAAY;IACzBC,cAAc,GAAG;EACnB,CAAC,GAAGX,KAAK;;EAET;EACA,MAAMY,SAAS,GAAGxB,YAAY,CAAC,CAAC;EAChC,MAAMyB,KAAK,GAAG3B,QAAQ,CAACiB,QAAQ,CAAC;;EAEhC;EACA,MAAMW,iBAAiB,GAAGhD,MAAM,CAAgC,IAAIiD,GAAG,CAAC,CAAC,CAAC;EAC1E,MAAMC,WAAW,GAAGlD,MAAM,CAAW,IAAI,CAAC;EAE1C,MAAM,CAACmD,IAAI,EAAEC,OAAO,CAAC,GAAGnD,QAAQ,CAC9B,IACF,CAAC;EACD,MAAM,CAACoD,KAAK,EAAEC,QAAQ,CAAC,GAAGrD,QAAQ,CAAkB,EAAE,CAAC;EACvD,MAAM,CAACsD,OAAO,EAAEC,UAAU,CAAC,GAAGvD,QAAQ,CAAgB,EAAE,CAAC;EACzD,MAAM,CAACwD,MAAM,EAAEC,SAAS,CAAC,GAAGzD,QAAQ,CAAU,EAAE,CAAC;EACjD,MAAM,CAAC0D,WAAW,EAAEC,cAAc,CAAC,GAAG3D,QAAQ,CAAgB,IAAI,CAAC;EACnE,MAAM,CAAC4D,YAAY,EAAEC,eAAe,CAAC,GAAG7D,QAAQ,CAAe,IAAI,CAAC;EACpE,MAAM,CAAC8D,aAAa,EAAEC,gBAAgB,CAAC,GAAG/D,QAAQ,CAChD,IACF,CAAC;EAED,MAAM,CAACgE,SAAS,EAAEC,YAAY,CAAC,GAAGjE,QAAQ,CAASyB,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;EAEnE,MAAM,CAACyC,aAAa,EAAEC,gBAAgB,CAAC,GAAGnE,QAAQ,CAAC,KAAK,CAAC;EACzD,MAAM,CAACoE,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGrE,QAAQ,CAAS,EAAE,CAAC;EACpE,MAAM,CAACsE,SAAS,EAAEC,YAAY,CAAC,GAAGvE,QAAQ,CAAa,EAAE,CAAC;EAC1D,MAAM,CAACwE,aAAa,EAAEC,gBAAgB,CAAC,GAAGzE,QAAQ,CAAgB,IAAI,CAAC;EACvE,MAAM,CAAC0E,gBAAgB,EAAEC,mBAAmB,CAAC,GAAG3E,QAAQ,CAAS,EAAE,CAAC;EACpE,MAAM,CAAC4E,SAAS,EAAEC,YAAY,CAAC,GAAG7E,QAAQ,CAASyB,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;EAEnE,MAAM,CAACqD,cAAc,EAAEC,iBAAiB,CAAC,GAAG/E,QAAQ,CAAC,CAAC,CAAC;EAEvD,MAAMgF,QAAQ,GAAGlF,OAAO,CAAC,MAAM;IAC7B,MAAMmF,IAAI,GAAG/D,IAAI,CAACD,IAAI,CAACiE,IAAI,CAAC,CAAC;IAC7BD,IAAI,CAACE,OAAO,CAAC;MAAEC,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE,CAAC;MAAExD,KAAK,EAAEF,SAAS;MAAE2D,MAAM,EAAExD;IAAW,CAAC,CAAC;IAClE,OAAOmD,IAAI;EACb,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMM,UAAU,GAAG3F,WAAW,CAAC,MAAM;IACnC,IAAI0D,OAAO,CAACkC,MAAM,KAAK,CAAC,EAAE;IAE1B,MAAMC,QAAQ,GAAGnC,OAAO,CAACA,OAAO,CAACkC,MAAM,GAAG,CAAC,CAAC;IAE5C,IAAI,CAAAC,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEC,IAAI,MAAK,MAAM,EAAE;MAC7BrC,QAAQ,CAAEsC,IAAI,IAAKA,IAAI,CAACC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IACvC,CAAC,MAAM,IAAI,CAAAH,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEC,IAAI,MAAK,OAAO,EAAE;MACrCjC,SAAS,CAAEkC,IAAI,IAAKA,IAAI,CAACC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IACxC;IAEArC,UAAU,CAAEoC,IAAI,IAAKA,IAAI,CAACC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACzC,CAAC,EAAE,CAACtC,OAAO,CAAC,CAAC;EAEb,MAAMuC,cAAc,GAAGjG,WAAW,CAAC,MAAM;IACvCuD,OAAO,CAAC,IAAI,CAAC;EACf,CAAC,EAAE,EAAE,CAAC;EAEN,MAAM2C,aAAa,GAAGlG,WAAW,CAAC,YAAY;IAC5C,IAAI;MAAA,IAAAmG,oBAAA;MACF,KAAAA,oBAAA,GAAI9C,WAAW,CAAC+C,OAAO,cAAAD,oBAAA,eAAnBA,oBAAA,CAAqBE,OAAO,EAAE;QAChC,MAAMC,GAAG,GAAG,MAAMjD,WAAW,CAAC+C,OAAO,CAACC,OAAO,CAAC,CAAC;QAC/C;QACA,OAAOzF,QAAQ,CAAC2F,EAAE,KAAK,KAAK,GAAG,UAAUD,GAAG,EAAE,GAAGA,GAAG;MACtD;MACA,OAAO,IAAI;IACb,CAAC,CAAC,OAAOE,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAC9C,OAAO,IAAI;IACb;EACF,CAAC,EAAE,EAAE,CAAC;EAEN,MAAME,kBAAkB,GAAGA,CACzBC,MAAc,EACdC,WAAmB,EACnBC,SAAiB,KACd;IACH,IAAIC,WAAW,GAAG,KAAK;IAEvB,OAAOnG,YAAY,CAACoG,MAAM,CAAC;MACzBC,4BAA4B,EAAEA,CAAA,KAAM,IAAI;MACxCC,mBAAmB,EAAEA,CAAA,KAAM;QACzBH,WAAW,GAAG,KAAK;QACnB,MAAMI,QAAQ,GAAG/D,iBAAiB,CAACiD,OAAO,CAACpE,GAAG,CAAC2E,MAAM,CAAC;QACtD,IAAIO,QAAQ,EAAE;UACZA,QAAQ,CAACC,SAAS,CAAC;YACjB3B,CAAC,EAAG0B,QAAQ,CAAC1B,CAAC,CAAS4B,MAAM;YAC7B3B,CAAC,EAAGyB,QAAQ,CAACzB,CAAC,CAAS2B;UACzB,CAAC,CAAC;UACFF,QAAQ,CAACG,QAAQ,CAAC;YAAE7B,CAAC,EAAE,CAAC;YAAEC,CAAC,EAAE;UAAE,CAAC,CAAC;QACnC;MACF,CAAC;MACD6B,kBAAkB,EAAEA,CAACC,CAAC,EAAEC,YAAY,KAAK;QACvC;QACA,IAAIC,IAAI,CAACC,GAAG,CAACF,YAAY,CAACG,EAAE,CAAC,GAAG,CAAC,IAAIF,IAAI,CAACC,GAAG,CAACF,YAAY,CAACI,EAAE,CAAC,GAAG,CAAC,EAAE;UAClEd,WAAW,GAAG,IAAI;QACpB;QAEA,MAAMI,QAAQ,GAAG/D,iBAAiB,CAACiD,OAAO,CAACpE,GAAG,CAAC2E,MAAM,CAAC;QACtD,IAAIO,QAAQ,IAAIJ,WAAW,EAAE;UAC3BxG,QAAQ,CAACuH,KAAK,CAAC,CAAC,IAAI,EAAE;YAAEF,EAAE,EAAET,QAAQ,CAAC1B,CAAC;YAAEoC,EAAE,EAAEV,QAAQ,CAACzB;UAAE,CAAC,CAAC,EAAE;YACzDqC,eAAe,EAAE;UACnB,CAAC,CAAC,CAACP,CAAC,EAAEC,YAAY,CAAC;QACrB;MACF,CAAC;MACDO,qBAAqB,EAAEA,CAAA,KAAM;QAC3B,MAAMb,QAAQ,GAAG/D,iBAAiB,CAACiD,OAAO,CAACpE,GAAG,CAAC2E,MAAM,CAAC;QAEtD,IAAI,CAACG,WAAW,EAAE;UAChB;UACAvD,OAAO,CAAC,MAAM,CAAC;UACfsB,gBAAgB,CAAC8B,MAAM,CAAC;UACxB5B,mBAAmB,CAAC6B,WAAW,CAAC;UAChC3B,YAAY,CAAC4B,SAAS,CAAC;UACvB,IAAIK,QAAQ,EAAE;YACZ;YACAA,QAAQ,CAACG,QAAQ,CAAC;cAAE7B,CAAC,EAAE,CAAC;cAAEC,CAAC,EAAE;YAAE,CAAC,CAAC;YACjCyB,QAAQ,CAACc,aAAa,CAAC,CAAC;UAC1B;QACF,CAAC,MAAM,IAAId,QAAQ,EAAE;UACnB;UACAA,QAAQ,CAACc,aAAa,CAAC,CAAC;UACxBrD,YAAY,CAAEoB,IAAI,IAChBA,IAAI,CAACkC,GAAG,CAAEC,IAAI,IACZA,IAAI,CAACC,EAAE,KAAKxB,MAAM,GACd;YACE,GAAGuB,IAAI;YACP1C,CAAC,EAAG0B,QAAQ,CAAC1B,CAAC,CAAS4B,MAAM;YAC7B3B,CAAC,EAAGyB,QAAQ,CAACzB,CAAC,CAAS2B;UACzB,CAAC,GACDc,IACN,CACF,CAAC;QACH;MACF;IACF,CAAC,CAAC;EACJ,CAAC;EAEDjI,SAAS,CAAC,MAAM;IACd,IAAI,CAACqE,aAAa,IAAI,CAAAE,gBAAgB,aAAhBA,gBAAgB,uBAAhBA,gBAAgB,CAAEoB,MAAM,IAAG,CAAC,EAAE;MAClD,MAAMwC,KAAK,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC;MACnC9D,mBAAmB,CAAC,EAAE,CAAC;MACvBE,YAAY,CAAEoB,IAAI,IAAK,CACrB,GAAGA,IAAI,EACP;QACEyC,IAAI,EAAEhE,gBAAgB;QACtB2D,EAAE,EAAEC,KAAK;QACT5C,CAAC,EAAE,CAACzD,SAAS,GAAG,CAAC;QACjB0D,CAAC,EAAE,CAACvD,UAAU,GAAG,CAAC;QAClBuG,KAAK,EAAEzD;MACT,CAAC,CACF,CAAC;MACF;MACA7B,iBAAiB,CAACiD,OAAO,CAACsC,GAAG,CAC3BN,KAAK,EACL,IAAI9H,QAAQ,CAACqI,OAAO,CAAC;QACnBnD,CAAC,EAAE,CAACzD,SAAS,GAAG,CAAC;QACjB0D,CAAC,EAAE,CAACvD,UAAU,GAAG;MACnB,CAAC,CACH,CAAC;IACH;EACF,CAAC,EAAE,CAACsC,gBAAgB,EAAEF,aAAa,EAAEU,SAAS,CAAC,CAAC;EAEhD/E,SAAS,CAAC,MAAM;IACd,MAAM2I,cAAc,GAAIC,CAAgB,IAAK;MAC3C1D,iBAAiB,CAAC0D,CAAC,CAACC,cAAc,CAACpD,MAAM,CAAC;IAC5C,CAAC;IAED,MAAMqD,cAAc,GAAGA,CAAA,KAAM;MAC3B5D,iBAAiB,CAAC,CAAC,CAAC;IACtB,CAAC;IAED,MAAM6D,OAAO,GAAGvI,QAAQ,CAACwI,WAAW,CAAC,iBAAiB,EAAEL,cAAc,CAAC;IACvE,MAAMM,OAAO,GAAGzI,QAAQ,CAACwI,WAAW,CAAC,iBAAiB,EAAEF,cAAc,CAAC;IAEvE,OAAO,MAAM;MACXC,OAAO,CAACG,MAAM,CAAC,CAAC;MAChBD,OAAO,CAACC,MAAM,CAAC,CAAC;IAClB,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMC,GAAG,GAAGlJ,OAAO,CACjB,MACES,YAAY,CAACoG,MAAM,CAAC;IAClBC,4BAA4B,EAAEA,CAAA,KAAM,IAAI;IACxCC,mBAAmB,EAAG4B,CAAC,IAAK;MAC1B,MAAM;QAAEQ,SAAS;QAAEC;MAAU,CAAC,GAAGT,CAAC,CAACU,WAAW;MAE9C,IAAIjG,IAAI,KAAK,MAAM,EAAE;QACnB,MAAMkG,CAAC,GAAGlI,IAAI,CAACD,IAAI,CAACiE,IAAI,CAAC,CAAC;QAC1BkE,CAAC,CAACC,MAAM,CAACJ,SAAS,EAAEC,SAAS,CAAC;QAC9BvF,cAAc,CAACyF,CAAC,CAAC;MACnB,CAAC,MAAM,IAAIlG,IAAI,KAAK,MAAM,IAAIA,IAAI,KAAK,QAAQ,EAAE;QAC/C;QACAa,gBAAgB,CAAC;UAAEqB,CAAC,EAAE6D,SAAS;UAAE5D,CAAC,EAAE6D;QAAU,CAAC,CAAC;MAClD;IACF,CAAC;IACDhC,kBAAkB,EAAGuB,CAAC,IAAK;MACzB,MAAM;QAAEQ,SAAS;QAAEC;MAAU,CAAC,GAAGT,CAAC,CAACU,WAAW;MAE9C,IAAIjG,IAAI,KAAK,MAAM,IAAIQ,WAAW,EAAE;QAClC,MAAM4F,OAAO,GAAG5F,WAAW,CAAC6F,IAAI,CAAC,CAAC;QAClCD,OAAO,CAACE,MAAM,CAACP,SAAS,EAAEC,SAAS,CAAC;QACpCvF,cAAc,CAAC2F,OAAO,CAAC;MACzB,CAAC,MAAM,IAAI,CAACpG,IAAI,KAAK,MAAM,IAAIA,IAAI,KAAK,QAAQ,KAAKY,aAAa,EAAE;QAClE,IAAIZ,IAAI,KAAK,MAAM,EAAE;UACnBW,eAAe,CAAC;YACd6B,IAAI,EAAE,MAAM;YACZN,CAAC,EAAEiC,IAAI,CAACoC,GAAG,CAAC3F,aAAa,CAACsB,CAAC,EAAE6D,SAAS,CAAC;YACvC5D,CAAC,EAAEgC,IAAI,CAACoC,GAAG,CAAC3F,aAAa,CAACuB,CAAC,EAAE6D,SAAS,CAAC;YACvCrH,KAAK,EAAEwF,IAAI,CAACC,GAAG,CAAC2B,SAAS,GAAGnF,aAAa,CAACsB,CAAC,CAAC;YAC5CE,MAAM,EAAE+B,IAAI,CAACC,GAAG,CAAC4B,SAAS,GAAGpF,aAAa,CAACuB,CAAC;UAC9C,CAAC,CAAC;QACJ,CAAC,MAAM;UACL,MAAMqE,MAAM,GAAGrC,IAAI,CAACsC,IAAI,CACtBtC,IAAI,CAACuC,GAAG,CAACX,SAAS,GAAGnF,aAAa,CAACsB,CAAC,EAAE,CAAC,CAAC,GACtCiC,IAAI,CAACuC,GAAG,CAACV,SAAS,GAAGpF,aAAa,CAACuB,CAAC,EAAE,CAAC,CAC3C,CAAC;UACDxB,eAAe,CAAC;YACd6B,IAAI,EAAE,QAAQ;YACdN,CAAC,EAAEtB,aAAa,CAACsB,CAAC;YAClBC,CAAC,EAAEvB,aAAa,CAACuB,CAAC;YAClBqE,MAAM,EAAEA;UACV,CAAC,CAAC;QACJ;MACF;IACF,CAAC;IACD/B,qBAAqB,EAAEA,CAAA,KAAM;MAC3B,IAAIzE,IAAI,KAAK,MAAM,IAAIQ,WAAW,EAAE;QAClCL,QAAQ,CAAEsC,IAAI,IAAK;UACjB,MAAMkE,QAAQ,GAAG,CACf,GAAGlE,IAAI,EACP;YAAEV,IAAI,EAAEvB,WAAW;YAAE2E,KAAK,EAAErE;UAAU,CAAC,CACxC;UACDT,UAAU,CAAEuG,CAAC,IAAK,CAChB,GAAGA,CAAC,EACJ;YAAEpE,IAAI,EAAE,MAAM;YAAEqE,SAAS,EAAEF,QAAQ,CAACrE,MAAM,GAAG;UAAE,CAAC,CACjD,CAAC;UACF,OAAOqE,QAAQ;QACjB,CAAC,CAAC;QACFlG,cAAc,CAAC,IAAI,CAAC;MACtB,CAAC,MAAM,IAAI,CAACT,IAAI,KAAK,MAAM,IAAIA,IAAI,KAAK,QAAQ,KAAKU,YAAY,EAAE;QACjE;QACA,MAAMoG,UAAU,GAAGpG,YAAY;QAC/BC,eAAe,CAAC,IAAI,CAAC;QACrBE,gBAAgB,CAAC,IAAI,CAAC;QACtBN,SAAS,CAAEkC,IAAI,IAAK;UAClB,MAAMsE,SAAS,GAAG,CAAC,GAAGtE,IAAI,EAAEqE,UAAU,CAAC;UACvCzG,UAAU,CAAEuG,CAAC,IAAK,CAChB,GAAGA,CAAC,EACJ;YAAEpE,IAAI,EAAE,OAAO;YAAEwE,UAAU,EAAED,SAAS,CAACzE,MAAM,GAAG;UAAE,CAAC,CACpD,CAAC;UACF,OAAOyE,SAAS;QAClB,CAAC,CAAC;MACJ;IACF;EACF,CAAC,CAAC,EACJ,CAAC/G,IAAI,EAAEQ,WAAW,EAAEE,YAAY,EAAEE,aAAa,EAAEE,SAAS,CAC5D,CAAC;EAED,MAAMmG,oBAAoB,GAAGrK,OAAO,CAAC,MAAM;IACzC,MAAMsK,UAAU,GACd,CAAAhH,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEoC,MAAM,IAAG,CAAC,IAAI,CAAAhC,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEgC,MAAM,IAAG,CAAC,IAAI,CAAAlB,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEkB,MAAM,IAAG,CAAC;IAClE,IAAItC,IAAI,KAAK,MAAM,EAAE;MACnB,oBACEvD,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;QAACyJ,KAAK,EAAExJ,MAAM,CAACyJ;MAAe,gBACjC5K,KAAA,CAAA0K,aAAA,CAACzJ,gBAAgB;QACf0J,KAAK,EAAExJ,MAAM,CAAC0J,QAAS;QACvBC,OAAO,EAAE,CAAArH,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEoC,MAAM,IAAG,CAAC,GAAGD,UAAU,GAAGmF;MAAU,GAEnD,CAAAtH,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEoC,MAAM,IAAG,CAAC,iBAAI7F,KAAA,CAAA0K,aAAA,CAAC3J,IAAI;QAAC4J,KAAK,EAAExJ,MAAM,CAAC6J;MAAQ,GAAC,gBAAc,CACjD,CAAC,eAEnBhL,KAAA,CAAA0K,aAAA,CAACzJ,gBAAgB;QAAC0J,KAAK,EAAExJ,MAAM,CAAC0J,QAAS;QAACC,OAAO,EAAE5E;MAAe,gBAChElG,KAAA,CAAA0K,aAAA,CAAC3J,IAAI;QAAC4J,KAAK,EAAExJ,MAAM,CAAC8J;MAAQ,GAAEhI,cAAqB,CACnC,CACd,CAAC;IAEX;IACA,IAAIM,IAAI,KAAK,MAAM,EAAE;MACnB,oBACEvD,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;QAACyJ,KAAK,EAAE,CAACxJ,MAAM,CAACyJ,cAAc,EAAE;UAAEM,cAAc,EAAE;QAAW,CAAC;MAAE,gBACnElL,KAAA,CAAA0K,aAAA,CAACzJ,gBAAgB;QACf0J,KAAK,EAAExJ,MAAM,CAAC0J,QAAS;QACvBC,OAAO,EAAEA,CAAA,KAAM;UACb5E,cAAc,CAAC,CAAC;UAChBxF,QAAQ,CAACyK,OAAO,CAAC,CAAC;QACpB;MAAE,gBAEFnL,KAAA,CAAA0K,aAAA,CAAC3J,IAAI;QAAC4J,KAAK,EAAExJ,MAAM,CAAC8J;MAAQ,GAAEhI,cAAqB,CACnC,CACd,CAAC;IAEX;IACA,oBACEjD,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;MAACyJ,KAAK,EAAExJ,MAAM,CAACyJ;IAAe,gBACjC5K,KAAA,CAAA0K,aAAA,CAACzJ,gBAAgB;MACf0J,KAAK,EAAExJ,MAAM,CAAC0J,QAAS;MACvBC,OAAO,EAAEA,CAAA,KAAM;QACb,IAAIL,UAAU,EAAE;UACdnK,KAAK,CAAC8K,KAAK,CAACxI,WAAW,EAAEC,aAAa,EAAE,CACtC;YACE4F,IAAI,EAAE3F,oBAAoB;YAC1B6H,KAAK,EAAE;UACT,CAAC,EACD;YACElC,IAAI,EAAE1F,kBAAkB;YACxB4H,KAAK,EAAE,aAAa;YACpBG,OAAO,EAAEA,CAAA,KAAM;cACbpI,OAAO,CAAC,CAAC;cACTgB,QAAQ,CAAC,EAAE,CAAC;cACZM,cAAc,CAAC,IAAI,CAAC;cACpBF,SAAS,CAAC,EAAE,CAAC;cACbI,eAAe,CAAC,IAAI,CAAC;cACrBE,gBAAgB,CAAC,IAAI,CAAC;cACtBE,YAAY,CAACxC,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;cAC7B8C,YAAY,CAAC,EAAE,CAAC;cAChBhB,UAAU,CAAC,EAAE,CAAC;cACd;cACAR,iBAAiB,CAACiD,OAAO,CAACgF,KAAK,CAAC,CAAC;YACnC;UACF,CAAC,CACF,CAAC;QACJ,CAAC,MAAM;UACL3I,OAAO,CAAC,CAAC;UACTgB,QAAQ,CAAC,EAAE,CAAC;UACZM,cAAc,CAAC,IAAI,CAAC;UACpBF,SAAS,CAAC,EAAE,CAAC;UACbI,eAAe,CAAC,IAAI,CAAC;UACrBE,gBAAgB,CAAC,IAAI,CAAC;UACtBE,YAAY,CAACxC,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;UAC7B8C,YAAY,CAAC,EAAE,CAAC;UAChBhB,UAAU,CAAC,EAAE,CAAC;UACd;UACAR,iBAAiB,CAACiD,OAAO,CAACgF,KAAK,CAAC,CAAC;QACnC;MACF;IAAE,gBAEFrL,KAAA,CAAA0K,aAAA,CAAC3J,IAAI;MAAC4J,KAAK,EAAExJ,MAAM,CAACmK;IAAS,GAAC,GAAO,CACrB,CAAC,eAEnBtL,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;MAACyJ,KAAK,EAAExJ,MAAM,CAACoK;IAAa,gBAC/BvL,KAAA,CAAA0K,aAAA,CAACzJ,gBAAgB;MACf6J,OAAO,EAAEA,CAAA,KAAM;QACbtH,OAAO,CAAC,MAAM,CAAC;QACfgB,gBAAgB,CAAC,KAAK,CAAC;MACzB,CAAE;MACFmG,KAAK,EAAExJ,MAAM,CAACqK;IAAU,gBAExBxL,KAAA,CAAA0K,aAAA,CAACjK,KAAK;MACJgL,SAAS,EAAE,OAAQ;MACnBC,MAAM,EAAEC,OAAO,CAAC,mBAAmB,CAAE;MACrChB,KAAK,EAAE,CAACxJ,MAAM,CAACyK,SAAS,EAAE;QAAEC,SAAS,EAAE,CAAC;UAAEC,MAAM,EAAE;QAAQ,CAAC;MAAE,CAAC;IAAE,CACjE,CACe,CAAC,eACnB9L,KAAA,CAAA0K,aAAA,CAACzJ,gBAAgB;MACf6J,OAAO,EAAEA,CAAA,KAAM;QACbtH,OAAO,CAAC,MAAM,CAAC;QACfgB,gBAAgB,CAAC,IAAI,CAAC;QACtBU,YAAY,CAACpD,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;MAC/B,CAAE;MACF6I,KAAK,EAAExJ,MAAM,CAACqK;IAAU,gBAExBxL,KAAA,CAAA0K,aAAA,CAAC3J,IAAI;MAAC4J,KAAK,EAAExJ,MAAM,CAAC4K;IAAc,GAAC,IAAQ,CAC3B,CAuBd,CACF,CAAC;EAEX,CAAC,EAAE,CACDtI,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEoC,MAAM,EACbhC,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEgC,MAAM,EACdlB,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEkB,MAAM,EACjBtC,IAAI,EACJqC,UAAU,EACVM,cAAc,EACdjD,cAAc,EACdL,WAAW,EACXC,aAAa,EACbC,oBAAoB,EACpBC,kBAAkB,EAClBL,OAAO,CACR,CAAC;EAEF,MAAMsJ,oBAAoB,GAAG7L,OAAO,CAAC,MAAM;IACzC,IAAIoD,IAAI,KAAK,MAAM,EAAE;MACnB,oBACEvD,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;QAACyJ,KAAK,EAAExJ,MAAM,CAAC8K;MAAW,gBAS7BjM,KAAA,CAAA0K,aAAA,CAAC5J,UAAU;QACToL,yBAAyB,EAAC,QAAQ;QAClCC,UAAU;QACVC,8BAA8B,EAAE;MAAM,GAErCtK,MAAM,CAACoG,GAAG,CAAEQ,KAAK,iBAChB1I,KAAA,CAAA0K,aAAA,CAACzJ,gBAAgB;QACf6J,OAAO,EAAEA,CAAA,KAAM;UACbxG,YAAY,CAACoE,KAAK,CAAC;QACrB,CAAE;QACF2D,GAAG,EAAE3D,KAAM;QACXiC,KAAK,EAAE,CACLxJ,MAAM,CAACmL,QAAQ,EACfjI,SAAS,KAAKqE,KAAK,IAAIvH,MAAM,CAACoL,aAAa;MAC3C,gBAEFvM,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;QAACyJ,KAAK,EAAE,CAACxJ,MAAM,CAACqL,QAAQ,EAAE;UAAEC,eAAe,EAAE/D;QAAM,CAAC;MAAE,CAAE,CAC7C,CACnB,CACS,CACR,CAAC;IAEX;IAEA,IAAInF,IAAI,KAAK,MAAM,EAAE;MACnB,oBACEvD,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;QAACyJ,KAAK,EAAExJ,MAAM,CAAC8K;MAAW,gBAC7BjM,KAAA,CAAA0K,aAAA,CAAC5J,UAAU;QACToL,yBAAyB,EAAC,QAAQ;QAClCC,UAAU;QACVC,8BAA8B,EAAE;MAAM,GAErCtK,MAAM,CAACoG,GAAG,CAAEQ,KAAK,iBAChB1I,KAAA,CAAA0K,aAAA,CAACzJ,gBAAgB;QACf6J,OAAO,EAAEA,CAAA,KAAM;UACb5F,YAAY,CAACwD,KAAK,CAAC;QACrB,CAAE;QACF2D,GAAG,EAAE3D,KAAM;QACXiC,KAAK,EAAE,CACLxJ,MAAM,CAACmL,QAAQ,EACfrH,SAAS,KAAKyD,KAAK,IAAIvH,MAAM,CAACoL,aAAa;MAC3C,gBAEFvM,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;QAACyJ,KAAK,EAAE,CAACxJ,MAAM,CAACqL,QAAQ,EAAE;UAAEC,eAAe,EAAE/D;QAAM,CAAC;MAAE,CAAE,CAC7C,CACnB,CACS,CACR,CAAC;IAEX;IACA,MAAM+B,UAAU,GACd,CAAAhH,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEoC,MAAM,IAAG,CAAC,IAAI,CAAAhC,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEgC,MAAM,IAAG,CAAC,IAAI,CAAAlB,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEkB,MAAM,IAAG,CAAC;IAClE,oBACE7F,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;MAACyJ,KAAK,EAAExJ,MAAM,CAAC8K;IAAW,GAC5BxB,UAAU,iBACTzK,KAAA,CAAA0K,aAAA,CAACzJ,gBAAgB;MACf0J,KAAK,EAAExJ,MAAM,CAACuL,OAAQ;MACtB5B,OAAO,EAAE,MAAAA,CAAA,KAAY;QACnB,MAAMvE,GAAG,GAAG,MAAMJ,aAAa,CAAC,CAAC;QACjC,IAAII,GAAG,IAAI5D,MAAM,EAAE;UACjBA,MAAM,CAAC4D,GAAG,CAAC;QACb;QAEAL,cAAc,CAAC,CAAC;QAChBxD,OAAO,CAAC,CAAC;QACTgB,QAAQ,CAAC,EAAE,CAAC;QACZM,cAAc,CAAC,IAAI,CAAC;QACpBF,SAAS,CAAC,EAAE,CAAC;QACbI,eAAe,CAAC,IAAI,CAAC;QACrBE,gBAAgB,CAAC,IAAI,CAAC;QACtBE,YAAY,CAACxC,MAAM,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;QAC7B8C,YAAY,CAAC,EAAE,CAAC;QAChBhB,UAAU,CAAC,EAAE,CAAC;QACd;QACAR,iBAAiB,CAACiD,OAAO,CAACgF,KAAK,CAAC,CAAC;MACnC;IAAE,gBAEFrL,KAAA,CAAA0K,aAAA,CAAC3J,IAAI;MAAC4J,KAAK,EAAE,CAACxJ,MAAM,CAAC8J,OAAO,EAAE;QAAEvC,KAAK,EAAE;MAAQ,CAAC;IAAE,GAC/C1F,UACG,CACU,CAEhB,CAAC;EAEX,CAAC,EAAE,CACDO,IAAI,EACJP,UAAU,EACVqB,SAAS,EACTY,SAAS,EACTxB,KAAK,CAACoC,MAAM,EACZhC,MAAM,CAACgC,MAAM,EACblB,SAAS,CAACkB,MAAM,EAChBK,cAAc,EACdxD,OAAO,EACPyD,aAAa,EACbxD,MAAM,CACP,CAAC;EAEF,IAAI,CAACJ,OAAO,EAAE;IACZ,OAAO,IAAI;EACb;EAEA,IAAIC,OAAO,EAAE;IACX,oBACExC,KAAA,CAAA0K,aAAA,CAAC/J,KAAK;MAAC4B,OAAO,EAAEA,OAAQ;MAACoK,WAAW;IAAA,gBAClC3M,KAAA,CAAA0K,aAAA,CAACtJ,YAAY;MAACuJ,KAAK,EAAExJ,MAAM,CAACyL;IAAe,gBACzC5M,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;MAACyJ,KAAK,EAAExJ,MAAM,CAAC0L;IAAiB,GAClCrC,oBAAoB,eAErBxK,KAAA,CAAA0K,aAAA,CAAC3I,QAAQ;MACP4I,KAAK,EAAE;QAAEmC,IAAI,EAAE;MAAE,CAAE;MACnBC,GAAG,EAAEzJ,WAAY;MACjB0J,OAAO,EAAE;QACPC,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;MACX;IAAE,gBAEFlN,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;MAACyJ,KAAK,EAAExJ,MAAM,CAACgM;IAAgB,gBAClCnN,KAAA,CAAA0K,aAAA,CAACrJ,MAAM,EAAA+L,QAAA;MACLL,GAAG,EAAE7J,SAAiB;MACtByH,KAAK,EAAE;QAAEzI,KAAK,EAAEF,SAAS;QAAE2D,MAAM,EAAExD;MAAW;IAAE,GAC5CkH,GAAG,CAACgE,WAAW,gBAEnBrN,KAAA,CAAA0K,aAAA,CAAC/I,KAAK;MAAC2L,IAAI,EAAEjI;IAAS,GAEnBlC,KAAK,iBACJnD,KAAA,CAAA0K,aAAA,CAACjJ,SAAS;MACR0B,KAAK,EAAEA,KAAM;MACbsC,CAAC,EAAE,CAAE;MACLC,CAAC,EAAE,CAAE;MACLxD,KAAK,EAAEF,SAAU;MACjB2D,MAAM,EAAExD,UAAW;MACnBoL,GAAG,EAAC;IAAS,CACd,CACF,EAGA9J,KAAK,CAACyE,GAAG,CAAC,CAACsF,aAAa,EAAEC,CAAC,kBAC1BzN,KAAA,CAAA0K,aAAA,CAACpJ,IAAI;MACH+K,GAAG,EAAE,QAAQoB,CAAC,EAAG;MACjBnI,IAAI,EAAEkI,aAAa,CAAClI,IAAK;MACzBoD,KAAK,EAAE8E,aAAa,CAAC9E,KAAM;MAC3BiC,KAAK,EAAC,QAAQ;MACd+C,WAAW,EAAE;IAAE,CAChB,CACF,CAAC,EACD3J,WAAW,iBACV/D,KAAA,CAAA0K,aAAA,CAACpJ,IAAI;MACHgE,IAAI,EAAEvB,WAAY;MAClB2E,KAAK,EAAErE,SAAU;MACjBsG,KAAK,EAAC,QAAQ;MACd+C,WAAW,EAAE;IAAE,CAChB,CACF,EAGA7J,MAAM,CAACqE,GAAG,CAAC,CAACyF,KAAK,EAAEF,CAAC,KAAK;MACxB,IACEE,KAAK,CAAC5H,IAAI,KAAK,MAAM,IACrB4H,KAAK,CAACzL,KAAK,IACXyL,KAAK,CAAChI,MAAM,EACZ;QACA,oBACE3F,KAAA,CAAA0K,aAAA,CAAC9I,IAAI;UACHyK,GAAG,EAAE,QAAQoB,CAAC,EAAG;UACjBhI,CAAC,EAAEkI,KAAK,CAAClI,CAAE;UACXC,CAAC,EAAEiI,KAAK,CAACjI,CAAE;UACXxD,KAAK,EAAEyL,KAAK,CAACzL,KAAM;UACnByD,MAAM,EAAEgI,KAAK,CAAChI,MAAO;UACrB+C,KAAK,EAAC,OAAO;UACbiC,KAAK,EAAC,QAAQ;UACd+C,WAAW,EAAE;QAAE,CAChB,CAAC;MAEN;MACA,IAAIC,KAAK,CAAC5H,IAAI,KAAK,QAAQ,IAAI4H,KAAK,CAAC5D,MAAM,EAAE;QAC3C,oBACE/J,KAAA,CAAA0K,aAAA,CAAC7I,MAAM;UACLwK,GAAG,EAAE,UAAUoB,CAAC,EAAG;UACnBG,EAAE,EAAED,KAAK,CAAClI,CAAE;UACZoI,EAAE,EAAEF,KAAK,CAACjI,CAAE;UACZoI,CAAC,EAAEH,KAAK,CAAC5D,MAAO;UAChBrB,KAAK,EAAC,MAAM;UACZiC,KAAK,EAAC,QAAQ;UACd+C,WAAW,EAAE;QAAE,CAChB,CAAC;MAEN;MACA,oBAAO1N,KAAA,CAAA0K,aAAA,CAAC1K,KAAK,CAAC+N,QAAQ;QAAC1B,GAAG,EAAE,SAASoB,CAAC;MAAG,CAAE,CAAC;IAC9C,CAAC,CAAC,EAGD,CAAAxJ,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAE8B,IAAI,MAAK,MAAM,IAC5B9B,YAAY,CAAC/B,KAAK,IAClB+B,YAAY,CAAC0B,MAAM,iBACjB3F,KAAA,CAAA0K,aAAA,CAAC9I,IAAI;MACH6D,CAAC,EAAExB,YAAY,CAACwB,CAAE;MAClBC,CAAC,EAAEzB,YAAY,CAACyB,CAAE;MAClBxD,KAAK,EAAE+B,YAAY,CAAC/B,KAAM;MAC1ByD,MAAM,EAAE1B,YAAY,CAAC0B,MAAO;MAC5B+C,KAAK,EAAC,OAAO;MACbiC,KAAK,EAAC,QAAQ;MACd+C,WAAW,EAAE,CAAE;MACfM,OAAO,EAAE;IAAE,CACZ,CACF,EACF,CAAA/J,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAE8B,IAAI,MAAK,QAAQ,IAAI9B,YAAY,CAAC8F,MAAM,iBACrD/J,KAAA,CAAA0K,aAAA,CAAC7I,MAAM;MACL+L,EAAE,EAAE3J,YAAY,CAACwB,CAAE;MACnBoI,EAAE,EAAE5J,YAAY,CAACyB,CAAE;MACnBoI,CAAC,EAAE7J,YAAY,CAAC8F,MAAO;MACvBrB,KAAK,EAAC,MAAM;MACZiC,KAAK,EAAC,QAAQ;MACd+C,WAAW,EAAE,CAAE;MACfM,OAAO,EAAE;IAAE,CACZ,CAEE,CACD,CAAC,EAER,CAACzK,IAAI,KAAK,MAAM,IAAIoB,SAAS,CAACkB,MAAM,GAAG,CAAC,kBACvC7F,KAAA,CAAA0K,aAAA,CAACxJ,IAAI,QACFyD,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEuD,GAAG,CAAE+F,OAAO,IAAK;MAC3B;MACA,IAAI,CAAC7K,iBAAiB,CAACiD,OAAO,CAAC6H,GAAG,CAACD,OAAO,CAAC7F,EAAE,CAAC,EAAE;QAC9ChF,iBAAiB,CAACiD,OAAO,CAACsC,GAAG,CAC3BsF,OAAO,CAAC7F,EAAE,EACV,IAAI7H,QAAQ,CAACqI,OAAO,CAAC;UAAEnD,CAAC,EAAEwI,OAAO,CAACxI,CAAC;UAAEC,CAAC,EAAEuI,OAAO,CAACvI;QAAE,CAAC,CACrD,CAAC;MACH;MACA,MAAMyB,QAAQ,GAAG/D,iBAAiB,CAACiD,OAAO,CAACpE,GAAG,CAC5CgM,OAAO,CAAC7F,EACV,CAAC;MACD,MAAM+F,YAAY,GAAGxH,kBAAkB,CACrCsH,OAAO,CAAC7F,EAAE,EACV6F,OAAO,CAACxF,IAAI,EACZwF,OAAO,CAACvF,KACV,CAAC;MACD,MAAM0F,SAAS,GAAGvJ,aAAa,KAAKoJ,OAAO,CAAC7F,EAAE;MAE9C,oBACEpI,KAAA,CAAA0K,aAAA,CAACnK,QAAQ,CAACW,IAAI,EAAAkM,QAAA;QACZf,GAAG,EAAE4B,OAAO,CAAC7F;MAAG,GACX,CAACgG,SAAS,GAAGD,YAAY,CAACd,WAAW,GAAG,CAAC,CAAC;QAC/C1C,KAAK,EAAE,CACLxJ,MAAM,CAACkN,UAAU,EACjB;UACExC,SAAS,EACP,CAAA1E,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEmH,qBAAqB,CAAC,CAAC,KAAI;QACzC,CAAC;MACD,IAEDF,SAAS,gBACRpO,KAAA,CAAA0K,aAAA,CAAC1J,SAAS;QACR2J,KAAK,EAAE,CACLxJ,MAAM,CAACoN,WAAW,EAClB;UAAE7F,KAAK,EAAEzD,SAAS;UAAE7C;QAAS,CAAC,CAC9B;QACFoM,KAAK,EAAEzJ,gBAAiB;QACxB0J,YAAY,EAAEzJ,mBAAoB;QAClC0J,cAAc,EAAEzJ,SAAU;QAC1B0J,SAAS;QACTC,SAAS;QACTC,MAAM,EAAEA,CAAA,KAAM;UACZ;UACAjK,YAAY,CAAEoB,IAAI,IAChBA,IAAI,CAACkC,GAAG,CAAEC,IAAI,IACZA,IAAI,CAACC,EAAE,KAAK6F,OAAO,CAAC7F,EAAE,GAClB;YACE,GAAGD,IAAI;YACPM,IAAI,EAAE1D,gBAAgB;YACtB2D,KAAK,EAAEzD;UACT,CAAC,GACDkD,IACN,CACF,CAAC;UACD3E,OAAO,CAAC,IAAI,CAAC;UACbsB,gBAAgB,CAAC,IAAI,CAAC;UACtBE,mBAAmB,CAAC,EAAE,CAAC;QACzB;MAAE,CACH,CAAC,gBAEFhF,KAAA,CAAA0K,aAAA,CAAC3J,IAAI;QACH4J,KAAK,EAAE,CACLxJ,MAAM,CAACoN,WAAW,EAClB;UAAE7F,KAAK,EAAEuF,OAAO,CAACvF,KAAK;UAAEtG;QAAS,CAAC;MAClC,GAED6L,OAAO,CAACxF,IACL,CAEK,CAAC;IAEpB,CAAC,CACG,CACP,EAEAlE,aAAa,iBACZvE,KAAA,CAAA0K,aAAA,CAAA1K,KAAA,CAAA+N,QAAA,qBACE/N,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;MAACyJ,KAAK,EAAExJ,MAAM,CAAC2N,UAAW;MAACC,aAAa,EAAC;IAAM,CAAE,CAAC,eACvD/O,KAAA,CAAA0K,aAAA,CAAC1J;IACC;IAAA;MACA2J,KAAK,EAAE,CACLxJ,MAAM,CAAC6N,gBAAgB,EACvB;QACE5M,QAAQ;QACR6M,GAAG,EAAE9M,UAAU,GAAG,CAAC;QACnBuG,KAAK,EAAEzD;MACT,CAAC,CACD;MACFuJ,KAAK,EAAE/J,gBAAiB;MACxBgK,YAAY,EAAE/J,mBAAoB;MAClCgK,cAAc,EAAEzJ,SAAU;MAC1B0J,SAAS;MACTO,OAAO,EAAEA,CAAA,KAAM1K,gBAAgB,CAAC,IAAI,CAAE;MACtCqK,MAAM,EAAEA,CAAA,KAAMrK,gBAAgB,CAAC,KAAK,CAAE;MACtCoK,SAAS;IAAA,CACV,CACD,CAEA,CACE,CAAC,eAEX5O,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;MAACyJ,KAAK,EAAE,CAACxJ,MAAM,CAACgO,MAAM,EAAE;QAAEC,MAAM,EAAEjK,cAAc,GAAG;MAAI,CAAC;IAAE,GAC5D6G,oBACG,CACF,CACM,CACT,CAAC;EAEZ;EAEA,oBACEhM,KAAA,CAAA0K,aAAA,CAACtJ,YAAY;IAACuJ,KAAK,EAAExJ,MAAM,CAACkO;EAAU,gBACpCrP,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;IAACyJ,KAAK,EAAExJ,MAAM,CAAC0L;EAAiB,GAClCrC,oBAAoB,eAErBxK,KAAA,CAAA0K,aAAA,CAAC3I,QAAQ;IACP4I,KAAK,EAAE;MAAEmC,IAAI,EAAE;IAAE,CAAE;IACnBC,GAAG,EAAEzJ,WAAY;IACjB0J,OAAO,EAAE;MACPC,MAAM,EAAE,KAAK;MACbC,OAAO,EAAE;IACX;EAAE,gBAEFlN,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;IAACyJ,KAAK,EAAExJ,MAAM,CAACgM;EAAgB,gBAClCnN,KAAA,CAAA0K,aAAA,CAACrJ,MAAM,EAAA+L,QAAA;IACLL,GAAG,EAAE7J,SAAiB;IACtByH,KAAK,EAAE;MAAEzI,KAAK,EAAEF,SAAS;MAAE2D,MAAM,EAAExD;IAAW;EAAE,GAC5CkH,GAAG,CAACgE,WAAW,gBAEnBrN,KAAA,CAAA0K,aAAA,CAAC/I,KAAK;IAAC2L,IAAI,EAAEjI;EAAS,GAEnBlC,KAAK,iBACJnD,KAAA,CAAA0K,aAAA,CAACjJ,SAAS;IACR0B,KAAK,EAAEA,KAAM;IACbsC,CAAC,EAAE,CAAE;IACLC,CAAC,EAAE,CAAE;IACLxD,KAAK,EAAEF,SAAU;IACjB2D,MAAM,EAAExD,UAAW;IACnBoL,GAAG,EAAC;EAAS,CACd,CACF,EAGA9J,KAAK,CAACyE,GAAG,CAAC,CAACsF,aAAa,EAAEC,CAAC,kBAC1BzN,KAAA,CAAA0K,aAAA,CAACpJ,IAAI;IACH+K,GAAG,EAAE,QAAQoB,CAAC,EAAG;IACjBnI,IAAI,EAAEkI,aAAa,CAAClI,IAAK;IACzBoD,KAAK,EAAE8E,aAAa,CAAC9E,KAAM;IAC3BiC,KAAK,EAAC,QAAQ;IACd+C,WAAW,EAAE;EAAE,CAChB,CACF,CAAC,EACD3J,WAAW,iBACV/D,KAAA,CAAA0K,aAAA,CAACpJ,IAAI;IACHgE,IAAI,EAAEvB,WAAY;IAClB2E,KAAK,EAAErE,SAAU;IACjBsG,KAAK,EAAC,QAAQ;IACd+C,WAAW,EAAE;EAAE,CAChB,CACF,EAGA7J,MAAM,CAACqE,GAAG,CAAC,CAACyF,KAAK,EAAEF,CAAC,KAAK;IACxB,IAAIE,KAAK,CAAC5H,IAAI,KAAK,MAAM,IAAI4H,KAAK,CAACzL,KAAK,IAAIyL,KAAK,CAAChI,MAAM,EAAE;MACxD,oBACE3F,KAAA,CAAA0K,aAAA,CAAC9I,IAAI;QACHyK,GAAG,EAAE,QAAQoB,CAAC,EAAG;QACjBhI,CAAC,EAAEkI,KAAK,CAAClI,CAAE;QACXC,CAAC,EAAEiI,KAAK,CAACjI,CAAE;QACXxD,KAAK,EAAEyL,KAAK,CAACzL,KAAM;QACnByD,MAAM,EAAEgI,KAAK,CAAChI,MAAO;QACrB+C,KAAK,EAAC,OAAO;QACbiC,KAAK,EAAC,QAAQ;QACd+C,WAAW,EAAE;MAAE,CAChB,CAAC;IAEN;IACA,IAAIC,KAAK,CAAC5H,IAAI,KAAK,QAAQ,IAAI4H,KAAK,CAAC5D,MAAM,EAAE;MAC3C,oBACE/J,KAAA,CAAA0K,aAAA,CAAC7I,MAAM;QACLwK,GAAG,EAAE,UAAUoB,CAAC,EAAG;QACnBG,EAAE,EAAED,KAAK,CAAClI,CAAE;QACZoI,EAAE,EAAEF,KAAK,CAACjI,CAAE;QACZoI,CAAC,EAAEH,KAAK,CAAC5D,MAAO;QAChBrB,KAAK,EAAC,MAAM;QACZiC,KAAK,EAAC,QAAQ;QACd+C,WAAW,EAAE;MAAE,CAChB,CAAC;IAEN;IACA,oBAAO1N,KAAA,CAAA0K,aAAA,CAAC1K,KAAK,CAAC+N,QAAQ;MAAC1B,GAAG,EAAE,SAASoB,CAAC;IAAG,CAAE,CAAC;EAC9C,CAAC,CAAC,EAGD,CAAAxJ,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAE8B,IAAI,MAAK,MAAM,IAC5B9B,YAAY,CAAC/B,KAAK,IAClB+B,YAAY,CAAC0B,MAAM,iBACjB3F,KAAA,CAAA0K,aAAA,CAAC9I,IAAI;IACH6D,CAAC,EAAExB,YAAY,CAACwB,CAAE;IAClBC,CAAC,EAAEzB,YAAY,CAACyB,CAAE;IAClBxD,KAAK,EAAE+B,YAAY,CAAC/B,KAAM;IAC1ByD,MAAM,EAAE1B,YAAY,CAAC0B,MAAO;IAC5B+C,KAAK,EAAC,OAAO;IACbiC,KAAK,EAAC,QAAQ;IACd+C,WAAW,EAAE,CAAE;IACfM,OAAO,EAAE;EAAE,CACZ,CACF,EACF,CAAA/J,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAE8B,IAAI,MAAK,QAAQ,IAAI9B,YAAY,CAAC8F,MAAM,iBACrD/J,KAAA,CAAA0K,aAAA,CAAC7I,MAAM;IACL+L,EAAE,EAAE3J,YAAY,CAACwB,CAAE;IACnBoI,EAAE,EAAE5J,YAAY,CAACyB,CAAE;IACnBoI,CAAC,EAAE7J,YAAY,CAAC8F,MAAO;IACvBrB,KAAK,EAAC,MAAM;IACZiC,KAAK,EAAC,QAAQ;IACd+C,WAAW,EAAE,CAAE;IACfM,OAAO,EAAE;EAAE,CACZ,CAEE,CACD,CAAC,EAER,CAACzK,IAAI,KAAK,MAAM,IAAIoB,SAAS,CAACkB,MAAM,GAAG,CAAC,kBACvC7F,KAAA,CAAA0K,aAAA,CAACxJ,IAAI,QACFyD,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEuD,GAAG,CAAE+F,OAAO,IAAK;IAC3B;IACA,IAAI,CAAC7K,iBAAiB,CAACiD,OAAO,CAAC6H,GAAG,CAACD,OAAO,CAAC7F,EAAE,CAAC,EAAE;MAC9ChF,iBAAiB,CAACiD,OAAO,CAACsC,GAAG,CAC3BsF,OAAO,CAAC7F,EAAE,EACV,IAAI7H,QAAQ,CAACqI,OAAO,CAAC;QAAEnD,CAAC,EAAEwI,OAAO,CAACxI,CAAC;QAAEC,CAAC,EAAEuI,OAAO,CAACvI;MAAE,CAAC,CACrD,CAAC;IACH;IACA,MAAMyB,QAAQ,GAAG/D,iBAAiB,CAACiD,OAAO,CAACpE,GAAG,CAACgM,OAAO,CAAC7F,EAAE,CAAC;IAC1D,MAAM+F,YAAY,GAAGxH,kBAAkB,CACrCsH,OAAO,CAAC7F,EAAE,EACV6F,OAAO,CAACxF,IAAI,EACZwF,OAAO,CAACvF,KACV,CAAC;IACD,MAAM0F,SAAS,GAAGvJ,aAAa,KAAKoJ,OAAO,CAAC7F,EAAE;IAE9C,oBACEpI,KAAA,CAAA0K,aAAA,CAACnK,QAAQ,CAACW,IAAI,EAAAkM,QAAA;MACZf,GAAG,EAAE4B,OAAO,CAAC7F;IAAG,GACX,CAACgG,SAAS,GAAGD,YAAY,CAACd,WAAW,GAAG,CAAC,CAAC;MAC/C1C,KAAK,EAAE,CACLxJ,MAAM,CAACkN,UAAU,EACjB;QACExC,SAAS,EAAE,CAAA1E,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEmH,qBAAqB,CAAC,CAAC,KAAI;MAClD,CAAC;IACD,IAEDF,SAAS,gBACRpO,KAAA,CAAA0K,aAAA,CAAC1J,SAAS;MACR2J,KAAK,EAAE,CACLxJ,MAAM,CAACoN,WAAW,EAClB;QAAE7F,KAAK,EAAEzD,SAAS;QAAE7C;MAAS,CAAC,CAC9B;MACFoM,KAAK,EAAEzJ,gBAAiB;MACxB0J,YAAY,EAAEzJ,mBAAoB;MAClC0J,cAAc,EAAEzJ,SAAU;MAC1B0J,SAAS;MACTC,SAAS;MACTC,MAAM,EAAEA,CAAA,KAAM;QACZ;QACAjK,YAAY,CAAEoB,IAAI,IAChBA,IAAI,CAACkC,GAAG,CAAEC,IAAI,IACZA,IAAI,CAACC,EAAE,KAAK6F,OAAO,CAAC7F,EAAE,GAClB;UACE,GAAGD,IAAI;UACPM,IAAI,EAAE1D,gBAAgB;UACtB2D,KAAK,EAAEzD;QACT,CAAC,GACDkD,IACN,CACF,CAAC;QACD3E,OAAO,CAAC,IAAI,CAAC;QACbsB,gBAAgB,CAAC,IAAI,CAAC;QACtBE,mBAAmB,CAAC,EAAE,CAAC;MACzB;IAAE,CACH,CAAC,gBAEFhF,KAAA,CAAA0K,aAAA,CAAC3J,IAAI;MACH4J,KAAK,EAAE,CACLxJ,MAAM,CAACoN,WAAW,EAClB;QAAE7F,KAAK,EAAEuF,OAAO,CAACvF,KAAK;QAAEtG;MAAS,CAAC;IAClC,GAED6L,OAAO,CAACxF,IACL,CAEK,CAAC;EAEpB,CAAC,CACG,CACP,EAEAlE,aAAa,iBACZvE,KAAA,CAAA0K,aAAA,CAAA1K,KAAA,CAAA+N,QAAA,qBACE/N,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;IAACyJ,KAAK,EAAExJ,MAAM,CAAC2N,UAAW;IAACC,aAAa,EAAC;EAAM,CAAE,CAAC,eACvD/O,KAAA,CAAA0K,aAAA,CAAC1J;EACC;EAAA;IACA2J,KAAK,EAAE,CACLxJ,MAAM,CAAC6N,gBAAgB,EACvB;MACE5M,QAAQ;MACR6M,GAAG,EAAE9M,UAAU,GAAG,CAAC;MACnBuG,KAAK,EAAEzD;IACT,CAAC,CACD;IACFuJ,KAAK,EAAE/J,gBAAiB;IACxBgK,YAAY,EAAE/J,mBAAoB;IAClCgK,cAAc,EAAEzJ,SAAU;IAC1B0J,SAAS;IACTO,OAAO,EAAEA,CAAA,KAAM1K,gBAAgB,CAAC,IAAI,CAAE;IACtCqK,MAAM,EAAEA,CAAA,KAAMrK,gBAAgB,CAAC,KAAK,CAAE;IACtCoK,SAAS;EAAA,CACV,CACD,CAEA,CACE,CAAC,eAEX5O,KAAA,CAAA0K,aAAA,CAACxJ,IAAI;IAACyJ,KAAK,EAAE,CAACxJ,MAAM,CAACgO,MAAM,EAAE;MAAEC,MAAM,EAAEjK,cAAc,GAAG;IAAI,CAAC;EAAE,GAC5D6G,oBACG,CACF,CACM,CAAC;AAEnB,CAAC;AAED,eAAe3J,kBAAkB","ignoreList":[]}