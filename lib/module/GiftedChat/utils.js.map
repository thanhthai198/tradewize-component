{"version":3,"names":["dayjs","createThumbnail","mime","isSameDay","currentMessage","diffMessage","createdAt","currentCreatedAt","diffCreatedAt","isValid","isSame","isSameUser","user","_id","chunkArray","array","size","result","i","length","push","slice","generateThumbnails","videoList","results","Promise","all","map","video","index","url","uri","timeStamp","path","e","console","error","id","formatDurationSmart","seconds","totalSeconds","Math","ceil","days","floor","hours","minutes","secondsLeft","padSeconds","n","String","padStart","parts","join","normalizeFileUri","log","cleaned","replace","getFileTypeFromPath","mimeType","getType"],"sources":["utils.ts"],"sourcesContent":["import dayjs from 'dayjs';\r\n\r\nimport { type FileMessage, type IMessage } from './types';\r\nimport { createThumbnail } from 'react-native-create-thumbnail';\r\nimport mime from 'mime';\r\n\r\nexport function isSameDay(\r\n  currentMessage: IMessage,\r\n  diffMessage: IMessage | null | undefined\r\n) {\r\n  if (!diffMessage || !diffMessage.createdAt) return false;\r\n\r\n  const currentCreatedAt = dayjs(currentMessage.createdAt);\r\n  const diffCreatedAt = dayjs(diffMessage.createdAt);\r\n\r\n  if (!currentCreatedAt.isValid() || !diffCreatedAt.isValid()) return false;\r\n\r\n  return currentCreatedAt.isSame(diffCreatedAt, 'day');\r\n}\r\n\r\nexport function isSameUser(\r\n  currentMessage: IMessage,\r\n  diffMessage: IMessage | null | undefined\r\n) {\r\n  return !!(\r\n    diffMessage &&\r\n    diffMessage.user &&\r\n    currentMessage.user &&\r\n    diffMessage.user._id === currentMessage.user._id\r\n  );\r\n}\r\n\r\nexport function chunkArray<T>(array: T[], size: number): T[][] {\r\n  const result = [];\r\n  for (let i = 0; i < array.length; i += size) {\r\n    result.push(array.slice(i, i + size));\r\n  }\r\n  return result;\r\n}\r\n\r\nexport const generateThumbnails = async (videoList: FileMessage[]) => {\r\n  const results = await Promise.all(\r\n    videoList.map(async (video, index) => {\r\n      try {\r\n        const result = await createThumbnail({\r\n          url: video.uri,\r\n          timeStamp: 500,\r\n        });\r\n        return { index, path: result.path };\r\n      } catch (e) {\r\n        console.error(`Lỗi với video ${video.id}`, e);\r\n        return { index, path: '' };\r\n      }\r\n    })\r\n  );\r\n\r\n  return results;\r\n};\r\n\r\nexport const formatDurationSmart = (seconds: number) => {\r\n  const totalSeconds = Math.ceil(seconds);\r\n\r\n  const days = Math.floor(totalSeconds / 86400);\r\n  const hours = Math.floor((totalSeconds % 86400) / 3600);\r\n  const minutes = Math.floor((totalSeconds % 3600) / 60);\r\n  const secondsLeft = totalSeconds % 60;\r\n\r\n  const padSeconds = (n: number) => String(n).padStart(2, '0');\r\n\r\n  const parts: string[] = [];\r\n\r\n  if (days) parts.push(String(days));\r\n  if (days || hours) parts.push(String(hours)); // chỉ show giờ nếu có ngày hoặc giờ\r\n  parts.push(String(minutes));\r\n  parts.push(padSeconds(secondsLeft));\r\n\r\n  return parts.join(':');\r\n};\r\n\r\nexport const normalizeFileUri = (uri: string): string => {\r\n  if (!uri) return uri;\r\n  console.log('uri', uri);\r\n\r\n  // Loại bỏ mọi tiền tố 'file://' nếu có (đề phòng lỗi)\r\n  const cleaned = uri.replace(/^file:\\/+/, '');\r\n  console.log('cleaned', cleaned);\r\n\r\n  return `file://${cleaned}`;\r\n};\r\n\r\nexport function getFileTypeFromPath(path: string): string | null {\r\n  if (!path) return null;\r\n\r\n  const mimeType = mime.getType(path);\r\n  return mimeType || null;\r\n}\r\n"],"mappings":"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","ignoreList":[]}