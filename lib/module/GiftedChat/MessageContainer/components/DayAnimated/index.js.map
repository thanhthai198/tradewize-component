{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","Animated","interpolate","useAnimatedStyle","useDerivedValue","useSharedValue","useAnimatedReaction","withTiming","runOnJS","Day","isSameDay","useAbsoluteScrolledPositionToBottomOfDay","useRelativeScrolledPositionToBottomOfDay","stylesCommon","styles","DayAnimated","scrolledY","daysPositions","listHeight","renderDay","messages","isLoadingEarlier","rest","opacity","fadeOutOpacityTimeoutId","undefined","containerHeight","isScrolledOnMount","isLoadingEarlierAnim","daysPositionsArray","Object","values","value","sort","a","b","y","createdAt","setCreatedAt","dayTopOffset","dayBottomMargin","absoluteScrolledPositionToBottomOfDay","relativeScrolledPositionToBottomOfDay","messagesDates","i","length","previousMessage","message","includes","Date","getTime","push","createdAtDate","day","dayPosition","height","style","top","contentStyle","fadeOut","duration","scheduleFadeOut","clearTimeout","setTimeout","handleLayout","nativeEvent","layout","prevValue","createElement","View","centerItems","dayAnimated","onLayout","pointerEvents","_extends","containerStyle","dayAnimatedDayContainerStyle"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { type LayoutChangeEvent } from 'react-native';\r\nimport Animated, {\r\n  interpolate,\r\n  useAnimatedStyle,\r\n  useDerivedValue,\r\n  useSharedValue,\r\n  useAnimatedReaction,\r\n  withTiming,\r\n  runOnJS,\r\n} from 'react-native-reanimated';\r\nimport { Day } from '../../../Day';\r\nimport { isSameDay } from '../../../utils';\r\nimport {\r\n  useAbsoluteScrolledPositionToBottomOfDay,\r\n  useRelativeScrolledPositionToBottomOfDay,\r\n} from '../Item';\r\nimport { type DayAnimatedProps } from './types';\r\n\r\nimport stylesCommon from '../../../styles';\r\nimport styles from './styles';\r\n\r\nexport * from './types';\r\n\r\nconst DayAnimated = ({\r\n  scrolledY,\r\n  daysPositions,\r\n  listHeight,\r\n  renderDay,\r\n  messages,\r\n  isLoadingEarlier,\r\n  ...rest\r\n}: DayAnimatedProps) => {\r\n  const opacity = useSharedValue(0);\r\n  const fadeOutOpacityTimeoutId = useSharedValue<\r\n    ReturnType<typeof setTimeout> | undefined\r\n  >(undefined);\r\n  const containerHeight = useSharedValue(0);\r\n\r\n  const isScrolledOnMount = useSharedValue(false);\r\n  const isLoadingEarlierAnim = useSharedValue(isLoadingEarlier);\r\n\r\n  const daysPositionsArray = useDerivedValue(() =>\r\n    Object.values(daysPositions.value).sort((a, b) => a.y - b.y)\r\n  );\r\n\r\n  const [createdAt, setCreatedAt] = useState<number | undefined>();\r\n\r\n  const dayTopOffset = useMemo(() => 10, []);\r\n  const dayBottomMargin = useMemo(() => 10, []);\r\n  const absoluteScrolledPositionToBottomOfDay =\r\n    useAbsoluteScrolledPositionToBottomOfDay(\r\n      listHeight,\r\n      scrolledY,\r\n      containerHeight,\r\n      dayBottomMargin,\r\n      dayTopOffset\r\n    );\r\n  const relativeScrolledPositionToBottomOfDay =\r\n    useRelativeScrolledPositionToBottomOfDay(\r\n      listHeight,\r\n      scrolledY,\r\n      daysPositions,\r\n      containerHeight,\r\n      dayBottomMargin,\r\n      dayTopOffset\r\n    );\r\n\r\n  const messagesDates = useMemo(() => {\r\n    const messagesDates: number[] = [];\r\n\r\n    for (let i = 1; i < messages.length; i++) {\r\n      const previousMessage: any = messages[i - 1];\r\n      const message: any = messages[i];\r\n\r\n      if (\r\n        !isSameDay(previousMessage, message) ||\r\n        !messagesDates.includes(new Date(message.createdAt).getTime())\r\n      )\r\n        messagesDates.push(new Date(message.createdAt).getTime());\r\n    }\r\n\r\n    return messagesDates;\r\n  }, [messages]);\r\n\r\n  const createdAtDate = useDerivedValue(() => {\r\n    for (let i = 0; i < daysPositionsArray.value.length; i++) {\r\n      const day: any = daysPositionsArray.value[i];\r\n      const dayPosition =\r\n        day.y + day.height - containerHeight.value - dayBottomMargin;\r\n\r\n      if (absoluteScrolledPositionToBottomOfDay.value < dayPosition)\r\n        return day.createdAt;\r\n    }\r\n\r\n    return messagesDates[messagesDates.length - 1];\r\n  }, [\r\n    daysPositionsArray,\r\n    absoluteScrolledPositionToBottomOfDay,\r\n    messagesDates,\r\n    containerHeight,\r\n    dayBottomMargin,\r\n  ]);\r\n\r\n  const style = useAnimatedStyle(\r\n    () => ({\r\n      top: interpolate(\r\n        relativeScrolledPositionToBottomOfDay.value,\r\n        [\r\n          -dayTopOffset,\r\n          -0.0001,\r\n          0,\r\n          isLoadingEarlierAnim.value ? 0 : containerHeight.value + dayTopOffset,\r\n        ],\r\n        [\r\n          dayTopOffset,\r\n          dayTopOffset,\r\n          -containerHeight.value,\r\n          isLoadingEarlierAnim.value ? -containerHeight.value : dayTopOffset,\r\n        ],\r\n        'clamp'\r\n      ),\r\n    }),\r\n    [\r\n      relativeScrolledPositionToBottomOfDay,\r\n      containerHeight,\r\n      dayTopOffset,\r\n      isLoadingEarlierAnim,\r\n    ]\r\n  );\r\n\r\n  const contentStyle = useAnimatedStyle(\r\n    () => ({\r\n      opacity: opacity.value,\r\n    }),\r\n    [opacity]\r\n  );\r\n\r\n  const fadeOut = useCallback(() => {\r\n    'worklet';\r\n\r\n    opacity.value = withTiming(0, { duration: 500 });\r\n  }, [opacity]);\r\n\r\n  const scheduleFadeOut = useCallback(() => {\r\n    clearTimeout(fadeOutOpacityTimeoutId.value);\r\n\r\n    fadeOutOpacityTimeoutId.value = setTimeout(fadeOut, 500);\r\n  }, [fadeOut, fadeOutOpacityTimeoutId]);\r\n\r\n  const handleLayout = useCallback(\r\n    ({ nativeEvent }: LayoutChangeEvent) => {\r\n      containerHeight.value = nativeEvent.layout.height;\r\n    },\r\n    [containerHeight]\r\n  );\r\n\r\n  useAnimatedReaction(\r\n    () => [scrolledY.value, daysPositionsArray],\r\n    (value, prevValue) => {\r\n      if (!isScrolledOnMount.value) {\r\n        isScrolledOnMount.value = true;\r\n        return;\r\n      }\r\n\r\n      if (value[0] === prevValue?.[0]) return;\r\n\r\n      opacity.value = withTiming(1, { duration: 500 });\r\n\r\n      runOnJS(scheduleFadeOut)();\r\n    },\r\n    [scrolledY, scheduleFadeOut, daysPositionsArray]\r\n  );\r\n\r\n  useAnimatedReaction(\r\n    () => createdAtDate.value,\r\n    (value, prevValue) => {\r\n      if (value && value !== prevValue) runOnJS(setCreatedAt)(value);\r\n    },\r\n    [createdAtDate]\r\n  );\r\n\r\n  useEffect(() => {\r\n    isLoadingEarlierAnim.value = isLoadingEarlier;\r\n  }, [isLoadingEarlierAnim, isLoadingEarlier]);\r\n\r\n  if (!createdAt) return null;\r\n\r\n  return (\r\n    <Animated.View\r\n      style={[stylesCommon.centerItems, styles.dayAnimated, style]}\r\n      onLayout={handleLayout}\r\n    >\r\n      <Animated.View style={contentStyle} pointerEvents=\"none\">\r\n        {renderDay ? (\r\n          renderDay({ ...rest, createdAt })\r\n        ) : (\r\n          <Day\r\n            {...rest}\r\n            containerStyle={[\r\n              styles.dayAnimatedDayContainerStyle,\r\n              rest.containerStyle,\r\n            ]}\r\n            createdAt={createdAt}\r\n          />\r\n        )}\r\n      </Animated.View>\r\n    </Animated.View>\r\n  );\r\n};\r\n\r\nexport default DayAnimated;\r\n"],"mappings":"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","ignoreList":[]}