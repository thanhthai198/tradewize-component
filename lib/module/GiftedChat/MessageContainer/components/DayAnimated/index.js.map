{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","Animated","interpolate","useAnimatedStyle","useDerivedValue","useSharedValue","useAnimatedReaction","withTiming","runOnJS","Day","isSameDay","useAbsoluteScrolledPositionToBottomOfDay","useRelativeScrolledPositionToBottomOfDay","stylesCommon","styles","DayAnimated","scrolledY","daysPositions","listHeight","renderDay","messages","isLoadingEarlier","rest","opacity","fadeOutOpacityTimeoutId","undefined","containerHeight","isScrolledOnMount","isLoadingEarlierAnim","daysPositionsArray","Object","values","value","sort","a","b","y","createdAt","setCreatedAt","dayTopOffset","dayBottomMargin","absoluteScrolledPositionToBottomOfDay","relativeScrolledPositionToBottomOfDay","messagesDates","i","length","previousMessage","message","includes","Date","getTime","push","createdAtDate","day","dayPosition","height","style","top","contentStyle","fadeOut","duration","scheduleFadeOut","clearTimeout","setTimeout","handleLayout","nativeEvent","layout","prevValue","createElement","View","centerItems","dayAnimated","onLayout","pointerEvents","_extends","containerStyle","dayAnimatedDayContainerStyle"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { type LayoutChangeEvent } from 'react-native';\nimport Animated, {\n  interpolate,\n  useAnimatedStyle,\n  useDerivedValue,\n  useSharedValue,\n  useAnimatedReaction,\n  withTiming,\n  runOnJS,\n} from 'react-native-reanimated';\nimport { Day } from '../../../Day';\nimport { isSameDay } from '../../../utils';\nimport {\n  useAbsoluteScrolledPositionToBottomOfDay,\n  useRelativeScrolledPositionToBottomOfDay,\n} from '../Item';\nimport { type DayAnimatedProps } from './types';\n\nimport stylesCommon from '../../../styles';\nimport styles from './styles';\n\nexport * from './types';\n\nconst DayAnimated = ({\n  scrolledY,\n  daysPositions,\n  listHeight,\n  renderDay,\n  messages,\n  isLoadingEarlier,\n  ...rest\n}: DayAnimatedProps) => {\n  const opacity = useSharedValue(0);\n  const fadeOutOpacityTimeoutId = useSharedValue<\n    ReturnType<typeof setTimeout> | undefined\n  >(undefined);\n  const containerHeight = useSharedValue(0);\n\n  const isScrolledOnMount = useSharedValue(false);\n  const isLoadingEarlierAnim = useSharedValue(isLoadingEarlier);\n\n  const daysPositionsArray = useDerivedValue(() =>\n    Object.values(daysPositions.value).sort((a, b) => a.y - b.y)\n  );\n\n  const [createdAt, setCreatedAt] = useState<number | undefined>();\n\n  const dayTopOffset = useMemo(() => 10, []);\n  const dayBottomMargin = useMemo(() => 10, []);\n  const absoluteScrolledPositionToBottomOfDay =\n    useAbsoluteScrolledPositionToBottomOfDay(\n      listHeight,\n      scrolledY,\n      containerHeight,\n      dayBottomMargin,\n      dayTopOffset\n    );\n  const relativeScrolledPositionToBottomOfDay =\n    useRelativeScrolledPositionToBottomOfDay(\n      listHeight,\n      scrolledY,\n      daysPositions,\n      containerHeight,\n      dayBottomMargin,\n      dayTopOffset\n    );\n\n  const messagesDates = useMemo(() => {\n    const messagesDates: number[] = [];\n\n    for (let i = 1; i < messages.length; i++) {\n      const previousMessage: any = messages[i - 1];\n      const message: any = messages[i];\n\n      if (\n        !isSameDay(previousMessage, message) ||\n        !messagesDates.includes(new Date(message.createdAt).getTime())\n      )\n        messagesDates.push(new Date(message.createdAt).getTime());\n    }\n\n    return messagesDates;\n  }, [messages]);\n\n  const createdAtDate = useDerivedValue(() => {\n    for (let i = 0; i < daysPositionsArray.value.length; i++) {\n      const day: any = daysPositionsArray.value[i];\n      const dayPosition =\n        day.y + day.height - containerHeight.value - dayBottomMargin;\n\n      if (absoluteScrolledPositionToBottomOfDay.value < dayPosition)\n        return day.createdAt;\n    }\n\n    return messagesDates[messagesDates.length - 1];\n  }, [\n    daysPositionsArray,\n    absoluteScrolledPositionToBottomOfDay,\n    messagesDates,\n    containerHeight,\n    dayBottomMargin,\n  ]);\n\n  const style = useAnimatedStyle(\n    () => ({\n      top: interpolate(\n        relativeScrolledPositionToBottomOfDay.value,\n        [\n          -dayTopOffset,\n          -0.0001,\n          0,\n          isLoadingEarlierAnim.value ? 0 : containerHeight.value + dayTopOffset,\n        ],\n        [\n          dayTopOffset,\n          dayTopOffset,\n          -containerHeight.value,\n          isLoadingEarlierAnim.value ? -containerHeight.value : dayTopOffset,\n        ],\n        'clamp'\n      ),\n    }),\n    [\n      relativeScrolledPositionToBottomOfDay,\n      containerHeight,\n      dayTopOffset,\n      isLoadingEarlierAnim,\n    ]\n  );\n\n  const contentStyle = useAnimatedStyle(\n    () => ({\n      opacity: opacity.value,\n    }),\n    [opacity]\n  );\n\n  const fadeOut = useCallback(() => {\n    'worklet';\n\n    opacity.value = withTiming(0, { duration: 500 });\n  }, [opacity]);\n\n  const scheduleFadeOut = useCallback(() => {\n    clearTimeout(fadeOutOpacityTimeoutId.value);\n\n    fadeOutOpacityTimeoutId.value = setTimeout(fadeOut, 500);\n  }, [fadeOut, fadeOutOpacityTimeoutId]);\n\n  const handleLayout = useCallback(\n    ({ nativeEvent }: LayoutChangeEvent) => {\n      containerHeight.value = nativeEvent.layout.height;\n    },\n    [containerHeight]\n  );\n\n  useAnimatedReaction(\n    () => [scrolledY.value, daysPositionsArray],\n    (value, prevValue) => {\n      if (!isScrolledOnMount.value) {\n        isScrolledOnMount.value = true;\n        return;\n      }\n\n      if (value[0] === prevValue?.[0]) return;\n\n      opacity.value = withTiming(1, { duration: 500 });\n\n      runOnJS(scheduleFadeOut)();\n    },\n    [scrolledY, scheduleFadeOut, daysPositionsArray]\n  );\n\n  useAnimatedReaction(\n    () => createdAtDate.value,\n    (value, prevValue) => {\n      if (value && value !== prevValue) runOnJS(setCreatedAt)(value);\n    },\n    [createdAtDate]\n  );\n\n  useEffect(() => {\n    isLoadingEarlierAnim.value = isLoadingEarlier;\n  }, [isLoadingEarlierAnim, isLoadingEarlier]);\n\n  if (!createdAt) return null;\n\n  return (\n    <Animated.View\n      style={[stylesCommon.centerItems, styles.dayAnimated, style]}\n      onLayout={handleLayout}\n    >\n      <Animated.View style={contentStyle} pointerEvents=\"none\">\n        {renderDay ? (\n          renderDay({ ...rest, createdAt })\n        ) : (\n          <Day\n            {...rest}\n            containerStyle={[\n              styles.dayAnimatedDayContainerStyle,\n              rest.containerStyle,\n            ]}\n            createdAt={createdAt}\n          />\n        )}\n      </Animated.View>\n    </Animated.View>\n  );\n};\n\nexport default DayAnimated;\n"],"mappings":"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","ignoreList":[]}