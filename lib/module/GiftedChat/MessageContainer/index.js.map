{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","View","TouchableOpacity","Text","Platform","FlatList","ScrollView","Animated","runOnJS","useAnimatedScrollHandler","useAnimatedStyle","useSharedValue","withTiming","DayAnimated","Item","LoadEarlier","TypingIndicator","warning","stylesCommon","styles","isSameDay","AnimatedFlatList","createAnimatedComponent","MessageContainer","props","messages","user","isTyping","renderChatEmpty","renderChatEmptyProp","onLoadEarlier","inverted","loadEarlier","listViewProps","invertibleScrollViewProps","extraData","isScrollToBottomEnabled","scrollToBottomOffset","alignTop","scrollToBottomStyle","infiniteScroll","isLoadingEarlier","renderTypingIndicator","renderTypingIndicatorProp","renderFooter","renderFooterProp","renderLoadEarlier","renderLoadEarlierProp","forwardRef","handleOnScroll","handleOnScrollProp","scrollToBottomComponent","scrollToBottomComponentProp","renderDay","renderDayProp","onPressFile","onLongPressReaction","useScrollView","scrollToBottomOpacity","isScrollToBottomVisible","setIsScrollToBottomVisible","isAtBottom","setIsAtBottom","scrollToBottomStyleAnim","opacity","value","daysPositions","listHeight","scrolledY","scrollPosition","contentHeight","scrollViewHeight","hasInitiallyRendered","previousLengthRef","length","lastMessageIdRef","hasScrolledToBottomRef","isFirstTimeAccess","hasScrolledOnFirstAccess","createElement","ListFooterComponent","Fragment","scrollTo","options","current","scrollViewRef","x","y","offset","animated","flatListRef","scrollToOffset","checkIsAtBottom","contentOffset","contentSize","layoutHeight","threshold","doScrollToBottom","scrollToEnd","event","contentOffsetY","height","contentSizeHeight","layoutMeasurement","layoutMeasurementHeight","atBottom","duration","makeScrollToBottomVisible","makeScrollToBottomHidden","isFinished","renderItem","item","index","messageItem","_id","JSON","stringify","system","restProps","previousMessage","nextMessage","messageProps","currentMessage","position","style","fill","emptyChatContainer","ListHeaderComponent","content","renderScrollBottomComponent","renderScrollToBottomWrapper","onPress","centerItems","isFirstRender","scrollToBottom","onLayoutList","_listViewProps$onLayo","nativeEvent","layout","setTimeout","onLayout","call","onEndReached","OS","handleScrollToTop","currentPosition","currentContentHeight","heightDiff","keyExtractor","toString","renderCell","handleOnLayout","_props$onLayout","_props$item","newValue","createdAt","Date","getTime","modify","date1","date2","d1","d2","getDate","getMonth","getFullYear","key","Object","entries","_extends","children","scrollHandler","onScroll","scrollHandlerForScrollView","currentOffset","currentScrollViewHeight","onScrollBeginDrag","timer","clearTimeout","currentLength","previousLength","lastMessage","currentLastMessageId","previousLastMessageId","hasNewContent","isFirstTimeWithMessages","shouldScroll","scrollAttempts","forEach","delay","keys","messageIndex","findIndex","m","shouldRemove","prevMessage","message","contentContainerStyle","containerAlignTop","ref","automaticallyAdjustContentInsets","scrollEventThrottle","nestedScrollEnabled","map","renderedItem","_renderCell$props$onL","_renderCell$props","data","ListEmptyComponent","onEndReachedThreshold","CellRendererComponent","maintainVisibleContentPosition","minIndexForVisible","autoscrollToTopThreshold"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport {\n  View,\n  TouchableOpacity,\n  Text,\n  Platform,\n  type LayoutChangeEvent,\n  type ListRenderItemInfo,\n  FlatList,\n  type CellRendererProps,\n  ScrollView,\n  type NativeSyntheticEvent,\n  type NativeScrollEvent,\n} from 'react-native';\nimport Animated, {\n  runOnJS,\n  useAnimatedScrollHandler,\n  useAnimatedStyle,\n  useSharedValue,\n  withTiming,\n} from 'react-native-reanimated';\nimport type { ReanimatedScrollEvent } from 'react-native-reanimated/lib/typescript/hook/commonTypes';\nimport DayAnimated from './components/DayAnimated';\nimport Item from './components/Item';\n\nimport { LoadEarlier } from '../LoadEarlier';\nimport { type IMessage } from '../types';\nimport TypingIndicator from '../TypingIndicator';\nimport { type MessageContainerProps, type DaysPositions, type AnimatedList } from './types';\nimport { type ItemProps } from './components/Item/types';\n\nimport { warning } from '../logging';\nimport stylesCommon from '../styles';\nimport styles from './styles';\nimport { isSameDay } from '../utils';\n\nexport * from './types';\n\nconst AnimatedFlatList = Animated.createAnimatedComponent(FlatList) as any;\n\nfunction MessageContainer<TMessage extends IMessage = IMessage>(\n  props: MessageContainerProps<TMessage>\n) {\n  const {\n    messages = [],\n    user,\n    isTyping = false,\n    renderChatEmpty: renderChatEmptyProp,\n    onLoadEarlier,\n    inverted = true,\n    loadEarlier = false,\n    listViewProps,\n    invertibleScrollViewProps,\n    extraData = null,\n    isScrollToBottomEnabled = false,\n    scrollToBottomOffset = 200,\n    alignTop = false,\n    scrollToBottomStyle,\n    infiniteScroll = false,\n    isLoadingEarlier = false,\n    renderTypingIndicator: renderTypingIndicatorProp,\n    renderFooter: renderFooterProp,\n    renderLoadEarlier: renderLoadEarlierProp,\n    forwardRef,\n    handleOnScroll: handleOnScrollProp,\n    scrollToBottomComponent: scrollToBottomComponentProp,\n    renderDay: renderDayProp,\n    onPressFile,\n    onLongPressReaction,\n    useScrollView = false,\n  } = props;\n\n  const scrollToBottomOpacity = useSharedValue(0);\n  const [isScrollToBottomVisible, setIsScrollToBottomVisible] = useState(false);\n  const [isAtBottom, setIsAtBottom] = useState<boolean>(true);\n  const scrollToBottomStyleAnim = useAnimatedStyle(\n    () => ({\n      opacity: scrollToBottomOpacity.value,\n    }),\n    [scrollToBottomOpacity]\n  );\n\n  const daysPositions = useSharedValue<DaysPositions>({});\n  const listHeight = useSharedValue(0);\n  const scrolledY = useSharedValue(0);\n\n  // Scroll position tracking refs for ScrollView load more functionality\n  const scrollPosition = useRef(0);\n  const contentHeight = useRef(0);\n  const scrollViewHeight = useRef(0);\n  const hasInitiallyRendered = useRef(false);\n\n  // Auto-scroll tracking refs (similar to ChatScrollView and VirtualizedChatList)\n  const previousLengthRef = useRef(messages.length);\n  const lastMessageIdRef = useRef<string | number | null>(null);\n  const hasScrolledToBottomRef = useRef(false);\n  const isFirstTimeAccess = useRef(true);\n  const hasScrolledOnFirstAccess = useRef(false);\n\n  const renderTypingIndicator = useCallback(() => {\n    if (renderTypingIndicatorProp) return renderTypingIndicatorProp();\n    return <TypingIndicator isTyping={isTyping} />;\n  }, [isTyping, renderTypingIndicatorProp]);\n\n  const ListFooterComponent = useMemo(() => {\n    if (renderFooterProp) return <>{renderFooterProp(props)}</>;\n\n    return <>{renderTypingIndicator()}</>;\n  }, [renderFooterProp, renderTypingIndicator, props]);\n\n  const renderLoadEarlier = useCallback(() => {\n    if (loadEarlier) {\n      if (renderLoadEarlierProp) return renderLoadEarlierProp(props);\n\n      return <LoadEarlier {...props} />;\n    }\n\n    return null;\n  }, [loadEarlier, renderLoadEarlierProp, props]);\n\n  const scrollTo = useCallback(\n    (options: { animated?: boolean; offset: number }) => {\n      if (forwardRef?.current && options) {\n        if (useScrollView) {\n          // ScrollView uses scrollTo method\n          const scrollViewRef = forwardRef.current as ScrollView;\n          if ('scrollTo' in scrollViewRef) {\n            scrollViewRef.scrollTo({\n              x: 0,\n              y: options.offset,\n              animated: options.animated ?? true,\n            });\n          }\n        } else {\n          // FlatList uses scrollToOffset method\n          const flatListRef = forwardRef.current as AnimatedList<TMessage>;\n          if ('scrollToOffset' in flatListRef) {\n            flatListRef.scrollToOffset(options);\n          }\n        }\n      }\n    },\n    [forwardRef, useScrollView]\n  );\n\n  // Check if user is at bottom (similar to ChatScrollView)\n  const checkIsAtBottom = useCallback(\n    (contentOffset: number, contentSize: number, layoutHeight: number) => {\n      const threshold = 100; // 100 px threshold\n      return contentOffset + layoutHeight >= contentSize - threshold;\n    },\n    [],\n  );\n\n  const doScrollToBottom = useCallback(\n    (animated: boolean = true) => {\n      if (forwardRef?.current) {\n        if (useScrollView) {\n          // ScrollView uses scrollToEnd method\n          const scrollViewRef = forwardRef.current as ScrollView;\n          if (inverted) {\n            if ('scrollTo' in scrollViewRef) {\n              scrollViewRef.scrollTo({\n                x: 0,\n                y: 0,\n                animated,\n              });\n            }\n          } else {\n            if ('scrollToEnd' in scrollViewRef) {\n              scrollViewRef.scrollToEnd({ animated });\n            }\n          }\n        } else {\n          // FlatList logic\n          const flatListRef = forwardRef.current as AnimatedList<TMessage>;\n          if (inverted) {\n            scrollTo({ offset: 0, animated });\n          } else {\n            if ('scrollToEnd' in flatListRef) {\n              flatListRef.scrollToEnd({ animated });\n            }\n          }\n        }\n      }\n    },\n    [forwardRef, inverted, scrollTo, useScrollView]\n  );\n\n  const handleOnScroll = useCallback(\n    (event: ReanimatedScrollEvent) => {\n      handleOnScrollProp?.(event);\n\n      const {\n        contentOffset: { y: contentOffsetY },\n        contentSize: { height: contentSizeHeight },\n        layoutMeasurement: { height: layoutMeasurementHeight },\n      } = event;\n\n      const atBottom = checkIsAtBottom(\n        contentOffsetY,\n        contentSizeHeight,\n        layoutMeasurementHeight,\n      );\n      runOnJS(setIsAtBottom)(atBottom);\n\n      const duration = 250;\n\n      const makeScrollToBottomVisible = () => {\n        setIsScrollToBottomVisible(true);\n        scrollToBottomOpacity.value = withTiming(1, { duration });\n      };\n\n      const makeScrollToBottomHidden = () => {\n        scrollToBottomOpacity.value = withTiming(\n          0,\n          { duration },\n          (isFinished) => {\n            if (isFinished) runOnJS(setIsScrollToBottomVisible)(false);\n          }\n        );\n      };\n\n      if (inverted)\n        if (contentOffsetY > scrollToBottomOffset!) makeScrollToBottomVisible();\n        else makeScrollToBottomHidden();\n      else if (\n        contentOffsetY < scrollToBottomOffset! &&\n        contentSizeHeight - layoutMeasurementHeight > scrollToBottomOffset!\n      )\n        makeScrollToBottomVisible();\n      else makeScrollToBottomHidden();\n    },\n    [handleOnScrollProp, inverted, scrollToBottomOffset, scrollToBottomOpacity, checkIsAtBottom]\n  );\n\n  const renderItem = useCallback(\n    ({\n      item,\n      index,\n    }: ListRenderItemInfo<unknown>): React.ReactElement | null => {\n      const messageItem = item as TMessage;\n\n      if (!messageItem._id && messageItem._id !== 0)\n        warning(\n          'GiftedChat: `_id` is missing for message',\n          JSON.stringify(item)\n        );\n\n      if (!messageItem.user) {\n        if (!messageItem.system)\n          warning(\n            'GiftedChat: `user` is missing for message',\n            JSON.stringify(messageItem)\n          );\n\n        messageItem.user = { _id: 0 };\n      }\n\n      const { messages, ...restProps } = props;\n\n      if (messages && user) {\n        const previousMessage =\n          (inverted ? messages[index + 1] : messages[index - 1]) ||\n          ({} as TMessage);\n        const nextMessage =\n          (inverted ? messages[index - 1] : messages[index + 1]) ||\n          ({} as TMessage);\n\n        const messageProps: ItemProps<TMessage> = {\n          ...restProps,\n          currentMessage: messageItem,\n          previousMessage,\n          nextMessage,\n          position: messageItem.user._id === user._id ? 'right' : 'left',\n          scrolledY,\n          daysPositions,\n          listHeight,\n          onPressFile,\n          onLongPressReaction,\n        };\n\n        return <Item<TMessage> {...messageProps} />;\n      }\n\n      return null;\n    },\n    [\n      props,\n      inverted,\n      scrolledY,\n      daysPositions,\n      listHeight,\n      user,\n      onPressFile,\n      onLongPressReaction,\n    ]\n  );\n\n  const renderChatEmpty = useCallback(() => {\n    if (renderChatEmptyProp)\n      return inverted ? (\n        renderChatEmptyProp()\n      ) : (\n        <View style={[stylesCommon.fill, styles.emptyChatContainer]}>\n          {renderChatEmptyProp()}\n        </View>\n      );\n\n    return <View style={stylesCommon.fill} />;\n  }, [inverted, renderChatEmptyProp]);\n\n  const ListHeaderComponent = useMemo(() => {\n    const content = renderLoadEarlier();\n\n    if (!content) return null;\n\n    return <View style={stylesCommon.fill}>{content}</View>;\n  }, [renderLoadEarlier]);\n\n  const renderScrollBottomComponent = useCallback(() => {\n    if (scrollToBottomComponentProp) return scrollToBottomComponentProp();\n\n    return <Text>{'V'}</Text>;\n  }, [scrollToBottomComponentProp]);\n\n  const renderScrollToBottomWrapper = useCallback(() => {\n    if (!isScrollToBottomVisible) return null;\n\n    return (\n      <TouchableOpacity onPress={() => doScrollToBottom()}>\n        <Animated.View\n          style={[\n            stylesCommon.centerItems,\n            styles.scrollToBottomStyle,\n            scrollToBottomStyle,\n            scrollToBottomStyleAnim,\n          ]}\n        >\n          {renderScrollBottomComponent()}\n        </Animated.View>\n      </TouchableOpacity>\n    );\n  }, [\n    scrollToBottomStyle,\n    renderScrollBottomComponent,\n    doScrollToBottom,\n    scrollToBottomStyleAnim,\n    isScrollToBottomVisible,\n  ]);\n\n  const isFirstRender = useRef({\n    scrollToBottom: true,\n  });\n\n  const onLayoutList = useCallback(\n    (event: LayoutChangeEvent) => {\n      listHeight.value = event.nativeEvent.layout.height;\n\n      if (!inverted && isFirstRender.current.scrollToBottom) {\n        setTimeout(() => {\n          doScrollToBottom(false);\n          isFirstRender.current.scrollToBottom = false;\n        }, 500);\n      }\n\n      listViewProps?.onLayout?.(event);\n    },\n    [inverted, doScrollToBottom, listHeight, listViewProps]\n  );\n\n  const onEndReached = useCallback(() => {\n    if (\n      infiniteScroll &&\n      loadEarlier &&\n      onLoadEarlier &&\n      !isLoadingEarlier &&\n      Platform.OS !== 'web'\n    )\n      onLoadEarlier();\n  }, [infiniteScroll, loadEarlier, onLoadEarlier, isLoadingEarlier]);\n\n  // Handle scroll to the top for loading more messages (ScrollView version)\n  const handleScrollToTop = useCallback(() => {\n    // Only trigger load more if we have more messages, not loading, and have rendered initially\n    if (\n      infiniteScroll &&\n      loadEarlier &&\n      onLoadEarlier &&\n      !isLoadingEarlier &&\n      hasInitiallyRendered.current &&\n      Platform.OS !== 'web'\n    ) {\n      // Record the current position before loading more\n      const currentPosition = scrollPosition.current;\n      const currentContentHeight = contentHeight.current;\n\n      // Call load more\n      onLoadEarlier();\n\n      // After loading more, try to maintain the scroll position\n      setTimeout(() => {\n        if (\n          forwardRef?.current &&\n          contentHeight.current > currentContentHeight\n        ) {\n          // Calculate new position to maintain relative view\n          const heightDiff = contentHeight.current - currentContentHeight;\n          const scrollViewRef = forwardRef.current as ScrollView;\n          if ('scrollTo' in scrollViewRef) {\n            scrollViewRef.scrollTo({\n              y: currentPosition + heightDiff,\n              animated: false,\n            });\n          }\n        }\n      }, 300);\n    }\n  }, [infiniteScroll, loadEarlier, onLoadEarlier, isLoadingEarlier, forwardRef]);\n\n  const keyExtractor: any = useCallback(\n    (item: unknown) => (item as TMessage)._id.toString(),\n    []\n  );\n\n  const renderCell = useCallback(\n    (props: CellRendererProps<unknown>) => {\n      const handleOnLayout = (event: LayoutChangeEvent) => {\n        props.onLayout?.(event);\n\n        const { y, height } = event.nativeEvent.layout;\n\n        const newValue = {\n          y,\n          height,\n          createdAt: new Date((props?.item as IMessage)?.createdAt).getTime(),\n        };\n\n        daysPositions.modify((value) => {\n          'worklet';\n\n          const isSameDay = (date1: number, date2: number) => {\n            const d1 = new Date(date1);\n            const d2 = new Date(date2);\n\n            return (\n              d1.getDate() === d2.getDate() &&\n              d1.getMonth() === d2.getMonth() &&\n              d1.getFullYear() === d2.getFullYear()\n            );\n          };\n\n          for (const [key, item] of Object.entries(value))\n            if (\n              isSameDay(newValue.createdAt, item.createdAt) &&\n              (inverted ? item.y <= newValue.y : item.y >= newValue.y)\n            ) {\n              delete value[key];\n              break;\n            }\n\n          // @ts-expect-error: https://docs.swmansion.com/react-native-reanimated/docs/core/useSharedValue#remarks\n          value[props.item._id] = newValue;\n          return value;\n        });\n      };\n\n      return (\n        <View {...props} onLayout={handleOnLayout}>\n          {props.children}\n        </View>\n      );\n    },\n    [daysPositions, inverted]\n  );\n\n  const scrollHandler = useAnimatedScrollHandler(\n    {\n      onScroll: (event) => {\n        scrolledY.value = event.contentOffset.y;\n\n        runOnJS(handleOnScroll)(event);\n      },\n    },\n    [handleOnScroll]\n  );\n\n  const scrollHandlerForScrollView = useCallback((event: NativeSyntheticEvent<NativeScrollEvent>) => {\n    const { contentOffset, contentSize, layoutMeasurement } = event.nativeEvent;\n    const currentOffset = contentOffset.y;\n    const currentContentHeight = contentSize.height;\n    const currentScrollViewHeight = layoutMeasurement.height;\n\n    // Update refs for scroll position tracking\n    scrollPosition.current = currentOffset;\n    contentHeight.current = currentContentHeight;\n    scrollViewHeight.current = currentScrollViewHeight;\n\n    // Check if at the bottom and update state\n    const atBottom = checkIsAtBottom(\n      currentOffset,\n      currentContentHeight,\n      currentScrollViewHeight,\n    );\n    setIsAtBottom(atBottom);\n\n    // Update animated value for existing functionality\n    scrolledY.value = currentOffset;\n  }, [checkIsAtBottom]);\n\n  // Update scroll-to-bottom button visibility based on isAtBottom state\n  useEffect(() => {\n    if (!isAtBottom && !isScrollToBottomVisible) {\n      setIsScrollToBottomVisible(true);\n      scrollToBottomOpacity.value = withTiming(1, { duration: 200 });\n    } else if (isAtBottom && isScrollToBottomVisible) {\n      scrollToBottomOpacity.value = withTiming(0, { duration: 200 }, () => {\n        runOnJS(setIsScrollToBottomVisible)(false);\n      });\n    }\n  }, [isAtBottom, isScrollToBottomVisible, scrollToBottomOpacity]);\n\n  // Handle scroll begin drag to detect scrolling to top\n  const onScrollBeginDrag = useCallback(() => {\n    // If user scrolls near the top (less than 100 pixels from top) and has more messages to load\n    if (scrollPosition.current < 100 && loadEarlier) {\n      handleScrollToTop();\n    }\n  }, [handleScrollToTop, loadEarlier]);\n\n  // Prevent early load more calls during initial render\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      hasInitiallyRendered.current = true;\n    }, 1000); // Wait 1 second before allowing load more calls\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  // Enhanced auto-scroll to the bottom when new messages arrive (only if user is at bottom)\n  useEffect(() => {\n    const currentLength = messages.length;\n    const previousLength = previousLengthRef.current;\n\n    // Get the last message ID\n    const lastMessage = messages[messages.length - 1];\n    const currentLastMessageId = lastMessage?._id || null;\n    const previousLastMessageId = lastMessageIdRef.current;\n\n    // Only auto-scroll if:\n    // 1. User is at the bottom (or this is an initial load)\n    // 2. AND (new messages were added OR last message changed OR first time with messages)\n    // 3. AND not loading (if loading prop exists)\n    const hasNewContent =\n      currentLength > previousLength ||\n      (currentLastMessageId !== previousLastMessageId &&\n        currentLastMessageId !== null);\n    const isFirstTimeWithMessages =\n      currentLength > 0 && !hasScrolledToBottomRef.current;\n\n    const shouldScroll =\n      (isAtBottom || isFirstTimeWithMessages) &&\n      (hasNewContent || isFirstTimeWithMessages) &&\n      currentLength > 0;\n\n    if (shouldScroll) {\n      doScrollToBottom();\n      hasScrolledToBottomRef.current = true;\n    }\n\n    // Update refs\n    previousLengthRef.current = currentLength;\n    lastMessageIdRef.current = currentLastMessageId;\n  }, [messages, doScrollToBottom, isAtBottom]);\n\n  // Enhanced initial scroll to the bottom when messages first load\n  useEffect(() => {\n    if (\n      messages.length > 0 &&\n      isFirstTimeAccess.current &&\n      !hasScrolledOnFirstAccess.current\n    ) {\n      // Mark that we've attempted the first scroll\n      hasScrolledOnFirstAccess.current = true;\n\n      // Multiple scroll attempts with increasing delays to ensure messages are fully rendered\n      const scrollAttempts = [100, 300, 500, 800, 1200];\n\n      scrollAttempts.forEach((delay, index) => {\n        setTimeout(() => {\n          if (messages.length > 0) {\n            doScrollToBottom(index > 0); // First attempt immediate, rest animated\n          }\n        }, delay);\n      });\n\n      // Mark as no longer first time after all attempts\n      setTimeout(() => {\n        isFirstTimeAccess.current = false;\n        hasScrolledToBottomRef.current = true;\n      }, 1500);\n    } else if (\n      messages.length > 0 &&\n      !hasScrolledToBottomRef.current &&\n      !isFirstTimeAccess.current\n    ) {\n      // Regular initial scroll for subsequent loads\n      setTimeout(() => doScrollToBottom(), 100);\n      hasScrolledToBottomRef.current = true;\n    }\n  }, [messages.length, doScrollToBottom]);\n\n  // Reset scroll flag when messages are cleared (e.g., when switching chats)\n  useEffect(() => {\n    if (messages.length === 0) {\n      hasScrolledToBottomRef.current = false;\n      isFirstTimeAccess.current = true;\n      hasScrolledOnFirstAccess.current = false;\n      setIsAtBottom(true);\n    }\n  }, [messages.length]);\n\n  // Auto-scroll when typing indicator appears (only if user is truly at bottom)\n  useEffect(() => {\n    // Only auto-scroll if:\n    // 1. Typing indicator just appeared (isTyping became true)\n    // 2. User is at the bottom\n    // 3. User is not actively scrolling up to read old messages\n    if (isTyping && isAtBottom && hasScrolledToBottomRef.current) {\n      // Small delay to ensure typing indicator is rendered\n      setTimeout(() => {\n        doScrollToBottom(true);\n      }, 100);\n    }\n  }, [isTyping, isAtBottom, doScrollToBottom]);\n\n  // removes unrendered days positions when messages are added/removed\n  useEffect(() => {\n    Object.keys(daysPositions.value).forEach((key) => {\n      const messageIndex = messages.findIndex((m) => m._id.toString() === key);\n      let shouldRemove = messageIndex === -1;\n\n      if (!shouldRemove) {\n        const prevMessage = messages[messageIndex + (inverted ? 1 : -1)] as\n          | IMessage\n          | undefined;\n        const message = messages[messageIndex] as IMessage;\n        shouldRemove = !!prevMessage && isSameDay(message, prevMessage);\n      }\n\n      if (shouldRemove)\n        daysPositions.modify((value) => {\n          'worklet';\n\n          delete value[key];\n          return value;\n        });\n    });\n  }, [messages, daysPositions, inverted]);\n\n  return (\n    <View\n      style={[\n        styles.contentContainerStyle,\n        alignTop ? styles.containerAlignTop : stylesCommon.fill,\n      ]}\n    >\n      {useScrollView ? (\n        <ScrollView\n          ref={forwardRef as any}\n          style={stylesCommon.fill}\n          automaticallyAdjustContentInsets={false}\n          {...invertibleScrollViewProps}\n          onScroll={scrollHandlerForScrollView}\n          onScrollBeginDrag={onScrollBeginDrag}\n          scrollEventThrottle={1}\n          onLayout={onLayoutList}\n          nestedScrollEnabled={true}\n        >\n          {inverted ? ListHeaderComponent : null}\n          {messages.length === 0 ? renderChatEmpty() : null}\n          {messages.map((item, index) => {\n            const renderedItem = renderItem({ item, index } as ListRenderItemInfo<unknown>);\n            return renderedItem ? (\n              <View key={keyExtractor(item)} onLayout={(event) => renderCell({ item, index, onLayout: () => {}, children: renderedItem } as any).props.onLayout?.(event)}>\n                {renderedItem}\n              </View>\n            ) : null;\n          })}\n          {inverted ? null : ListFooterComponent}\n        </ScrollView>\n      ) : (\n        <AnimatedFlatList\n          extraData={extraData}\n          ref={forwardRef as any}\n          keyExtractor={keyExtractor}\n          data={messages}\n          renderItem={renderItem as any}\n          inverted={inverted}\n          automaticallyAdjustContentInsets={false}\n          style={stylesCommon.fill}\n          {...invertibleScrollViewProps}\n          ListEmptyComponent={renderChatEmpty}\n          ListFooterComponent={\n            inverted ? ListHeaderComponent : ListFooterComponent\n          }\n          ListHeaderComponent={\n            inverted ? ListFooterComponent : ListHeaderComponent\n          }\n          onScroll={scrollHandler}\n          scrollEventThrottle={1}\n          onEndReached={onEndReached}\n          onEndReachedThreshold={0.1}\n          {...listViewProps}\n          onLayout={onLayoutList}\n          CellRendererComponent={renderCell}\n          maintainVisibleContentPosition={{\n            minIndexForVisible: 0,\n            autoscrollToTopThreshold: 10,\n          }}\n        />\n      )}\n      {isScrollToBottomEnabled ? renderScrollToBottomWrapper() : null}\n      <DayAnimated\n        scrolledY={scrolledY}\n        daysPositions={daysPositions}\n        listHeight={listHeight}\n        renderDay={renderDayProp}\n        messages={messages}\n        isLoadingEarlier={isLoadingEarlier}\n      />\n    </View>\n  );\n}\n\nexport default MessageContainer;\n"],"mappings":"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","ignoreList":[]}