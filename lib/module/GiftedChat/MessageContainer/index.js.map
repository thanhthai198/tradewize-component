{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","View","TouchableOpacity","Text","Platform","FlatList","Animated","runOnJS","useAnimatedScrollHandler","useAnimatedStyle","useSharedValue","withTiming","DayAnimated","Item","LoadEarlier","TypingIndicator","warning","stylesCommon","styles","isSameDay","AnimatedFlatList","createAnimatedComponent","MessageContainer","props","messages","user","isTyping","renderChatEmpty","renderChatEmptyProp","onLoadEarlier","inverted","loadEarlier","listViewProps","invertibleScrollViewProps","extraData","isScrollToBottomEnabled","scrollToBottomOffset","alignTop","scrollToBottomStyle","infiniteScroll","isLoadingEarlier","renderTypingIndicator","renderTypingIndicatorProp","renderFooter","renderFooterProp","renderLoadEarlier","renderLoadEarlierProp","forwardRef","handleOnScroll","handleOnScrollProp","scrollToBottomComponent","scrollToBottomComponentProp","renderDay","renderDayProp","onPressFile","onLongPressReaction","scrollToBottomOpacity","isScrollToBottomVisible","setIsScrollToBottomVisible","scrollToBottomStyleAnim","opacity","value","daysPositions","listHeight","scrolledY","createElement","ListFooterComponent","Fragment","scrollTo","options","current","scrollToOffset","doScrollToBottom","animated","offset","scrollToEnd","event","contentOffset","y","contentOffsetY","contentSize","height","contentSizeHeight","layoutMeasurement","layoutMeasurementHeight","duration","makeScrollToBottomVisible","makeScrollToBottomHidden","isFinished","renderItem","item","index","messageItem","_id","JSON","stringify","system","restProps","previousMessage","nextMessage","messageProps","currentMessage","position","style","fill","emptyChatContainer","ListHeaderComponent","content","renderScrollBottomComponent","renderScrollToBottomWrapper","onPress","centerItems","onLayoutList","_listViewProps$onLayo","nativeEvent","layout","length","setTimeout","onLayout","call","onEndReached","OS","keyExtractor","toString","renderCell","handleOnLayout","_props$onLayout","newValue","createdAt","Date","getTime","modify","date1","date2","d1","d2","getDate","getMonth","getFullYear","key","Object","entries","_extends","children","scrollHandler","onScroll","keys","forEach","messageIndex","findIndex","m","shouldRemove","prevMessage","message","contentContainerStyle","containerAlignTop","ref","data","automaticallyAdjustContentInsets","ListEmptyComponent","scrollEventThrottle","onEndReachedThreshold","CellRendererComponent"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport {\n  View,\n  TouchableOpacity,\n  Text,\n  Platform,\n  type LayoutChangeEvent,\n  type ListRenderItemInfo,\n  FlatList,\n  type CellRendererProps,\n} from 'react-native';\nimport Animated, {\n  runOnJS,\n  useAnimatedScrollHandler,\n  useAnimatedStyle,\n  useSharedValue,\n  withTiming,\n} from 'react-native-reanimated';\nimport type { ReanimatedScrollEvent } from 'react-native-reanimated/lib/typescript/hook/commonTypes';\nimport DayAnimated from './components/DayAnimated';\nimport Item from './components/Item';\n\nimport { LoadEarlier } from '../LoadEarlier';\nimport { type IMessage } from '../types';\nimport TypingIndicator from '../TypingIndicator';\nimport { type MessageContainerProps, type DaysPositions } from './types';\nimport { type ItemProps } from './components/Item/types';\n\nimport { warning } from '../logging';\nimport stylesCommon from '../styles';\nimport styles from './styles';\nimport { isSameDay } from '../utils';\n\nexport * from './types';\n\nconst AnimatedFlatList = Animated.createAnimatedComponent(FlatList) as any;\n\nfunction MessageContainer<TMessage extends IMessage = IMessage>(\n  props: MessageContainerProps<TMessage>\n) {\n  const {\n    messages = [],\n    user,\n    isTyping = false,\n    renderChatEmpty: renderChatEmptyProp,\n    onLoadEarlier,\n    inverted = true,\n    loadEarlier = false,\n    listViewProps,\n    invertibleScrollViewProps,\n    extraData = null,\n    isScrollToBottomEnabled = false,\n    scrollToBottomOffset = 200,\n    alignTop = false,\n    scrollToBottomStyle,\n    infiniteScroll = false,\n    isLoadingEarlier = false,\n    renderTypingIndicator: renderTypingIndicatorProp,\n    renderFooter: renderFooterProp,\n    renderLoadEarlier: renderLoadEarlierProp,\n    forwardRef,\n    handleOnScroll: handleOnScrollProp,\n    scrollToBottomComponent: scrollToBottomComponentProp,\n    renderDay: renderDayProp,\n    onPressFile,\n    onLongPressReaction,\n  } = props;\n\n  const scrollToBottomOpacity = useSharedValue(0);\n  const [isScrollToBottomVisible, setIsScrollToBottomVisible] = useState(false);\n  const scrollToBottomStyleAnim = useAnimatedStyle(\n    () => ({\n      opacity: scrollToBottomOpacity.value,\n    }),\n    [scrollToBottomOpacity]\n  );\n\n  const daysPositions = useSharedValue<DaysPositions>({});\n  const listHeight = useSharedValue(0);\n  const scrolledY = useSharedValue(0);\n\n  const renderTypingIndicator = useCallback(() => {\n    if (renderTypingIndicatorProp) return renderTypingIndicatorProp();\n    if (isTyping) return <TypingIndicator />;\n\n    return null;\n  }, [isTyping, renderTypingIndicatorProp]);\n\n  const ListFooterComponent = useMemo(() => {\n    if (renderFooterProp) return <>{renderFooterProp(props)}</>;\n\n    return <>{renderTypingIndicator()}</>;\n  }, [renderFooterProp, renderTypingIndicator, props]);\n\n  const renderLoadEarlier = useCallback(() => {\n    if (loadEarlier) {\n      if (renderLoadEarlierProp) return renderLoadEarlierProp(props);\n\n      return <LoadEarlier {...props} />;\n    }\n\n    return null;\n  }, [loadEarlier, renderLoadEarlierProp, props]);\n\n  const scrollTo = useCallback(\n    (options: { animated?: boolean; offset: number }) => {\n      if (forwardRef?.current && options)\n        forwardRef.current.scrollToOffset(options);\n    },\n    [forwardRef]\n  );\n\n  const doScrollToBottom = useCallback(\n    (animated: boolean = true) => {\n      if (inverted) scrollTo({ offset: 0, animated });\n      else if (forwardRef?.current)\n        forwardRef.current.scrollToEnd({ animated });\n    },\n    [forwardRef, inverted, scrollTo]\n  );\n\n  const handleOnScroll = useCallback(\n    (event: ReanimatedScrollEvent) => {\n      handleOnScrollProp?.(event);\n\n      const {\n        contentOffset: { y: contentOffsetY },\n        contentSize: { height: contentSizeHeight },\n        layoutMeasurement: { height: layoutMeasurementHeight },\n      } = event;\n\n      const duration = 250;\n\n      const makeScrollToBottomVisible = () => {\n        setIsScrollToBottomVisible(true);\n        scrollToBottomOpacity.value = withTiming(1, { duration });\n      };\n\n      const makeScrollToBottomHidden = () => {\n        scrollToBottomOpacity.value = withTiming(\n          0,\n          { duration },\n          (isFinished) => {\n            if (isFinished) runOnJS(setIsScrollToBottomVisible)(false);\n          }\n        );\n      };\n\n      if (inverted)\n        if (contentOffsetY > scrollToBottomOffset!) makeScrollToBottomVisible();\n        else makeScrollToBottomHidden();\n      else if (\n        contentOffsetY < scrollToBottomOffset! &&\n        contentSizeHeight - layoutMeasurementHeight > scrollToBottomOffset!\n      )\n        makeScrollToBottomVisible();\n      else makeScrollToBottomHidden();\n    },\n    [handleOnScrollProp, inverted, scrollToBottomOffset, scrollToBottomOpacity]\n  );\n\n  const renderItem = useCallback(\n    ({\n      item,\n      index,\n    }: ListRenderItemInfo<unknown>): React.ReactElement | null => {\n      const messageItem = item as TMessage;\n\n      if (!messageItem._id && messageItem._id !== 0)\n        warning(\n          'GiftedChat: `_id` is missing for message',\n          JSON.stringify(item)\n        );\n\n      if (!messageItem.user) {\n        if (!messageItem.system)\n          warning(\n            'GiftedChat: `user` is missing for message',\n            JSON.stringify(messageItem)\n          );\n\n        messageItem.user = { _id: 0 };\n      }\n\n      const { messages, ...restProps } = props;\n\n      if (messages && user) {\n        const previousMessage =\n          (inverted ? messages[index + 1] : messages[index - 1]) ||\n          ({} as TMessage);\n        const nextMessage =\n          (inverted ? messages[index - 1] : messages[index + 1]) ||\n          ({} as TMessage);\n\n        const messageProps: ItemProps<TMessage> = {\n          ...restProps,\n          currentMessage: messageItem,\n          previousMessage,\n          nextMessage,\n          position: messageItem.user._id === user._id ? 'right' : 'left',\n          scrolledY,\n          daysPositions,\n          listHeight,\n          onPressFile,\n          onLongPressReaction,\n        };\n\n        return <Item<TMessage> {...messageProps} />;\n      }\n\n      return null;\n    },\n    [\n      props,\n      inverted,\n      scrolledY,\n      daysPositions,\n      listHeight,\n      user,\n      onPressFile,\n      onLongPressReaction,\n    ]\n  );\n\n  const renderChatEmpty = useCallback(() => {\n    if (renderChatEmptyProp)\n      return inverted ? (\n        renderChatEmptyProp()\n      ) : (\n        <View style={[stylesCommon.fill, styles.emptyChatContainer]}>\n          {renderChatEmptyProp()}\n        </View>\n      );\n\n    return <View style={stylesCommon.fill} />;\n  }, [inverted, renderChatEmptyProp]);\n\n  const ListHeaderComponent = useMemo(() => {\n    const content = renderLoadEarlier();\n\n    if (!content) return null;\n\n    return <View style={stylesCommon.fill}>{content}</View>;\n  }, [renderLoadEarlier]);\n\n  const renderScrollBottomComponent = useCallback(() => {\n    if (scrollToBottomComponentProp) return scrollToBottomComponentProp();\n\n    return <Text>{'V'}</Text>;\n  }, [scrollToBottomComponentProp]);\n\n  const renderScrollToBottomWrapper = useCallback(() => {\n    if (!isScrollToBottomVisible) return null;\n\n    return (\n      <TouchableOpacity onPress={() => doScrollToBottom()}>\n        <Animated.View\n          style={[\n            stylesCommon.centerItems,\n            styles.scrollToBottomStyle,\n            scrollToBottomStyle,\n            scrollToBottomStyleAnim,\n          ]}\n        >\n          {renderScrollBottomComponent()}\n        </Animated.View>\n      </TouchableOpacity>\n    );\n  }, [\n    scrollToBottomStyle,\n    renderScrollBottomComponent,\n    doScrollToBottom,\n    scrollToBottomStyleAnim,\n    isScrollToBottomVisible,\n  ]);\n\n  const onLayoutList = useCallback(\n    (event: LayoutChangeEvent) => {\n      listHeight.value = event.nativeEvent.layout.height;\n\n      if (!inverted && messages?.length)\n        setTimeout(() => {\n          doScrollToBottom(false);\n        }, 500);\n\n      listViewProps?.onLayout?.(event);\n    },\n    [inverted, messages, doScrollToBottom, listHeight, listViewProps]\n  );\n\n  const onEndReached = useCallback(() => {\n    if (\n      infiniteScroll &&\n      loadEarlier &&\n      onLoadEarlier &&\n      !isLoadingEarlier &&\n      Platform.OS !== 'web'\n    )\n      onLoadEarlier();\n  }, [infiniteScroll, loadEarlier, onLoadEarlier, isLoadingEarlier]);\n\n  const keyExtractor: any = useCallback(\n    (item: unknown) => (item as TMessage)._id.toString(),\n    []\n  );\n\n  const renderCell = useCallback(\n    (props: CellRendererProps<unknown>) => {\n      const handleOnLayout = (event: LayoutChangeEvent) => {\n        props.onLayout?.(event);\n\n        const { y, height } = event.nativeEvent.layout;\n\n        const newValue = {\n          y,\n          height,\n          createdAt: new Date((props.item as IMessage).createdAt).getTime(),\n        };\n\n        daysPositions.modify((value) => {\n          'worklet';\n\n          const isSameDay = (date1: number, date2: number) => {\n            const d1 = new Date(date1);\n            const d2 = new Date(date2);\n\n            return (\n              d1.getDate() === d2.getDate() &&\n              d1.getMonth() === d2.getMonth() &&\n              d1.getFullYear() === d2.getFullYear()\n            );\n          };\n\n          for (const [key, item] of Object.entries(value))\n            if (\n              isSameDay(newValue.createdAt, item.createdAt) &&\n              (inverted ? item.y <= newValue.y : item.y >= newValue.y)\n            ) {\n              delete value[key];\n              break;\n            }\n\n          // @ts-expect-error: https://docs.swmansion.com/react-native-reanimated/docs/core/useSharedValue#remarks\n          value[props.item._id] = newValue;\n          return value;\n        });\n      };\n\n      return (\n        <View {...props} onLayout={handleOnLayout}>\n          {props.children}\n        </View>\n      );\n    },\n    [daysPositions, inverted]\n  );\n\n  const scrollHandler = useAnimatedScrollHandler(\n    {\n      onScroll: (event) => {\n        scrolledY.value = event.contentOffset.y;\n\n        runOnJS(handleOnScroll)(event);\n      },\n    },\n    [handleOnScroll]\n  );\n\n  // removes unrendered days positions when messages are added/removed\n  useEffect(() => {\n    Object.keys(daysPositions.value).forEach((key) => {\n      const messageIndex = messages.findIndex((m) => m._id.toString() === key);\n      let shouldRemove = messageIndex === -1;\n\n      if (!shouldRemove) {\n        const prevMessage = messages[messageIndex + (inverted ? 1 : -1)] as\n          | IMessage\n          | undefined;\n        const message = messages[messageIndex] as IMessage;\n        shouldRemove = !!prevMessage && isSameDay(message, prevMessage);\n      }\n\n      if (shouldRemove)\n        daysPositions.modify((value) => {\n          'worklet';\n\n          delete value[key];\n          return value;\n        });\n    });\n  }, [messages, daysPositions, inverted]);\n\n  return (\n    <View\n      style={[\n        styles.contentContainerStyle,\n        alignTop ? styles.containerAlignTop : stylesCommon.fill,\n      ]}\n    >\n      <AnimatedFlatList\n        extraData={extraData}\n        ref={forwardRef as any}\n        keyExtractor={keyExtractor}\n        data={messages}\n        renderItem={renderItem as any}\n        inverted={inverted}\n        automaticallyAdjustContentInsets={false}\n        style={stylesCommon.fill}\n        {...invertibleScrollViewProps}\n        ListEmptyComponent={renderChatEmpty}\n        ListFooterComponent={\n          inverted ? ListHeaderComponent : ListFooterComponent\n        }\n        ListHeaderComponent={\n          inverted ? ListFooterComponent : ListHeaderComponent\n        }\n        onScroll={scrollHandler}\n        scrollEventThrottle={1}\n        onEndReached={onEndReached}\n        onEndReachedThreshold={0.1}\n        {...listViewProps}\n        onLayout={onLayoutList}\n        CellRendererComponent={renderCell}\n      />\n      {isScrollToBottomEnabled ? renderScrollToBottomWrapper() : null}\n      <DayAnimated\n        scrolledY={scrolledY}\n        daysPositions={daysPositions}\n        listHeight={listHeight}\n        renderDay={renderDayProp}\n        messages={messages}\n        isLoadingEarlier={isLoadingEarlier}\n      />\n    </View>\n  );\n}\n\nexport default MessageContainer;\n"],"mappings":"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","ignoreList":[]}