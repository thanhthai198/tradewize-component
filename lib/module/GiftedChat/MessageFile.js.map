{"version":3,"names":["React","useEffect","useState","memo","useRef","ActivityIndicator","FlatList","StyleSheet","Text","TouchableOpacity","View","generateThumbnails","FastImage","Color","AnimatedCircularProgress","getScreenWidth","GAP_MEDIA","calcSize","isShowAll","messageWidth","width","Number","sizeMedia","sizeMediaShowAll","MediaItem","item","index","size","arrMedia","isReaction","currentMessage","onPressFile","onLongPressFile","progressNum","progress","safeProgress","isFinite","Math","max","min","createElement","Fragment","onLongPress","onPress","length","file","disabled","isLoading","typeFile","style","styles","mediaItem","height","thumbnailPreview","uri","url","source","priority","low","image","playIcon","borderRadius","color","defaultBlue","require","resizeMode","cover","reactionIcon","reactionIconText","fill","tintColor","white","backgroundColor","defaultColor","prev","next","MessageFile","onLayout","onSaveThumbnail","setArrMedia","thumbnailCache","Map","processedFiles","Set","fetchData","getFileComplete","filter","videosNeedThumbnail","current","has","newArrMediaLoading","map","isProcessing","some","v","result","forEach","res","video","path","set","add","newArrMedia","cachedThumbnail","get","thumbnail","error","console","log","arrMediaShow","slice","container","gap","data","renderItem","keyExtractor","_item$clientId","_item$uri","clientId","toString","numColumns","scrollEnabled","columnWrapperStyle","initialNumToRender","maxToRenderPerBatch","windowSize","removeClippedSubviews","getItemLayout","_","offset","floor","create","flexDirection","marginVertical","paddingHorizontal","overflow","alignItems","justifyContent","marginBottom","position","fontSize","fontWeight","lineHeight","top","left"],"sources":["MessageFile.tsx"],"sourcesContent":["import React, { useEffect, useState, memo, useRef } from 'react';\nimport {\n  ActivityIndicator,\n  FlatList,\n  StyleSheet,\n  Text,\n  TouchableOpacity,\n  View,\n  type LayoutChangeEvent,\n} from 'react-native';\nimport type { FileMessage, IMessage } from './types';\nimport { generateThumbnails } from './utils';\nimport FastImage from 'react-native-fast-image';\nimport Color from './Color';\nimport { AnimatedCircularProgress } from 'react-native-circular-progress';\nimport { getScreenWidth } from '../utils';\n\nconst GAP_MEDIA = 3;\n\ninterface MessageFileProps {\n  onPressFile?: (\n    file: FileMessage,\n    isShowAll?: boolean,\n    arrMedia?: IMessage\n  ) => void;\n  messageWidth?: { width: number; _id: string } | null;\n  currentMessage: IMessage;\n  isReaction?: boolean;\n  onLayout?: (event: LayoutChangeEvent) => void;\n  onSaveThumbnail?: (file: FileMessage[]) => void;\n  isShowAll?: boolean;\n  onLongPressFile?: () => void;\n}\n\n// ✅ tính toán size cố định dựa vào messageWidth + isShowAll\nconst calcSize = (\n  isShowAll: boolean | undefined,\n  messageWidth?: { width: number } | null\n) => {\n  const width = Number(messageWidth?.width) || getScreenWidth(); // fallback an toàn\n\n  const sizeMedia = width / 4.65 - GAP_MEDIA * 3.65;\n  const sizeMediaShowAll = width / 4 - GAP_MEDIA * 3;\n\n  if (isShowAll) return sizeMediaShowAll;\n  if (sizeMedia < getScreenWidth() * 0.1) return getScreenWidth() * 0.15;\n  return sizeMedia;\n};\n\ninterface MediaItemProps {\n  item: FileMessage;\n  index: number;\n  size: number;\n  arrMedia: FileMessage[];\n  isShowAll?: boolean;\n  isReaction?: boolean;\n  currentMessage: IMessage;\n  onPressFile?: (\n    file: FileMessage,\n    isShowAll?: boolean,\n    arrMedia?: IMessage\n  ) => void;\n  onLongPressFile?: () => void;\n}\n\n// ✅ MediaItem chỉ nhận size từ ngoài → ổn định layout\nconst MediaItem = memo(\n  ({\n    item,\n    index,\n    size,\n    arrMedia,\n    isShowAll,\n    isReaction,\n    currentMessage,\n    onPressFile,\n    onLongPressFile,\n  }: MediaItemProps) => {\n    const progressNum = Number(item?.progress);\n    const safeProgress = Number.isFinite(progressNum)\n      ? Math.max(0, Math.min(100, progressNum))\n      : 0;\n\n    return (\n      <>\n        <TouchableOpacity\n          onLongPress={onLongPressFile}\n          onPress={() =>\n            onPressFile?.(item, arrMedia?.length > 8 && index === 7, {\n              ...currentMessage,\n              file: arrMedia,\n            })\n          }\n          disabled={\n            isReaction || (item?.isLoading && item?.typeFile === 'video')\n          }\n          style={[\n            styles.mediaItem,\n            {\n              width: size,\n              height: size,\n            },\n          ]}\n        >\n          {(item?.thumbnailPreview || item?.uri || item?.url) && (\n            <FastImage\n              source={{\n                uri: item?.thumbnailPreview || item?.uri || item?.url,\n                priority: FastImage.priority.low,\n              }}\n              style={styles.image}\n            />\n          )}\n\n          {item?.typeFile === 'video' && (\n            <View\n              style={[\n                styles.playIcon,\n                (safeProgress <= 0 ||\n                  safeProgress >= 100 ||\n                  item?.isLoading) && {\n                  width: size * 0.5,\n                  height: size * 0.5,\n                  borderRadius: (size * 0.5) / 2,\n                },\n              ]}\n            >\n              {item?.isLoading ? (\n                <ActivityIndicator size=\"small\" color={Color.defaultBlue} />\n              ) : (\n                (safeProgress <= 0 || safeProgress >= 100) && (\n                  <FastImage\n                    source={require('./assets/play.png')}\n                    resizeMode={FastImage.resizeMode.cover}\n                    style={{\n                      width: (size * 0.5) / 2,\n                      height: (size * 0.5) / 2,\n                    }}\n                  />\n                )\n              )}\n            </View>\n          )}\n\n          {arrMedia?.length > 8 && index === 7 && !isShowAll && (\n            <View style={styles.reactionIcon}>\n              <Text style={styles.reactionIconText}>\n                + {arrMedia?.length - 8 > 99 ? '99+' : arrMedia?.length - 8}\n              </Text>\n            </View>\n          )}\n        </TouchableOpacity>\n\n        {!item?.isLoading && safeProgress > 0 && safeProgress < 100 && (\n          <View style={[styles.progress, { width: size, height: size }]}>\n            <AnimatedCircularProgress\n              size={size * 0.3}\n              width={3}\n              fill={safeProgress}\n              tintColor={Color.white}\n              backgroundColor={Color.defaultColor}\n            />\n          </View>\n        )}\n      </>\n    );\n  },\n  (prev, next) =>\n    prev.item.uri === next.item.uri &&\n    prev.item.thumbnailPreview === next.item.thumbnailPreview &&\n    prev.item.progress === next.item.progress &&\n    prev.item.isLoading === next.item.isLoading &&\n    prev.size === next.size // ✅ so sánh luôn size\n);\n\nexport function MessageFile({\n  onPressFile,\n  messageWidth,\n  currentMessage,\n  isReaction,\n  onLayout,\n  onSaveThumbnail,\n  isShowAll,\n  onLongPressFile,\n}: MessageFileProps) {\n  const [arrMedia, setArrMedia] = useState<FileMessage[]>(\n    currentMessage?.file || []\n  );\n\n  // ✅ Cache để tránh tạo lại thumbnail\n  const thumbnailCache = useRef<Map<string, string>>(new Map());\n  const processedFiles = useRef<Set<string>>(new Set());\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const { file } = currentMessage;\n        const getFileComplete = file?.filter((item) => item.uri);\n        if (!getFileComplete) return;\n\n        // ✅ Chỉ xử lý những video chưa có thumbnail và chưa được xử lý\n        const videosNeedThumbnail = getFileComplete.filter(\n          (item) =>\n            item.typeFile === 'video' &&\n            !item?.thumbnailPreview &&\n            !processedFiles.current.has(item.uri)\n        );\n\n        // ✅ Cập nhật loading state cho tất cả video chưa có thumbnail\n        const newArrMediaLoading = getFileComplete.map((item) => {\n          if (item.typeFile === 'video' && !item?.thumbnailPreview) {\n            const isProcessing = videosNeedThumbnail.some(\n              (v) => v.uri === item.uri\n            );\n            return { ...item, isLoading: isProcessing };\n          }\n          return item;\n        });\n\n        setArrMedia(newArrMediaLoading);\n\n        // ✅ Chỉ tạo thumbnail cho những video cần thiết\n        if (videosNeedThumbnail.length > 0) {\n          const result = await generateThumbnails(videosNeedThumbnail);\n\n          // ✅ Cache thumbnail results\n          result.forEach((res, index) => {\n            const video = videosNeedThumbnail[index];\n            if (video && res.path) {\n              thumbnailCache.current.set(video.uri, res.path);\n              processedFiles.current.add(video.uri);\n            }\n          });\n        }\n\n        // ✅ Cập nhật final state với thumbnail từ cache hoặc mới tạo\n        const newArrMedia = getFileComplete.map((item) => {\n          if (item.typeFile === 'video') {\n            const cachedThumbnail = thumbnailCache.current.get(item.uri);\n            const thumbnail = item?.thumbnailPreview || cachedThumbnail || '';\n            return {\n              ...item,\n              thumbnailPreview: thumbnail,\n              isLoading: false,\n            };\n          }\n          return item;\n        });\n\n        onSaveThumbnail?.(newArrMedia);\n        setArrMedia(newArrMedia);\n      } catch (error) {\n        console.log('error fetchData media', error);\n      }\n    };\n    fetchData();\n  }, [currentMessage, onSaveThumbnail]);\n\n  const arrMediaShow = isShowAll ? arrMedia : arrMedia?.slice(0, 8);\n  const size = calcSize(!!isShowAll, messageWidth);\n\n  return (\n    <View onLayout={onLayout} style={[styles.container, { gap: GAP_MEDIA }]}>\n      <FlatList\n        data={arrMediaShow || []}\n        renderItem={({ item, index }) => (\n          <MediaItem\n            item={item}\n            index={index}\n            size={size}\n            arrMedia={arrMedia}\n            isShowAll={!!isShowAll}\n            isReaction={isReaction}\n            currentMessage={currentMessage}\n            onPressFile={onPressFile}\n            onLongPressFile={onLongPressFile}\n          />\n        )}\n        keyExtractor={(item) =>\n          item?.clientId?.toString() || item?.uri?.toString()\n        }\n        numColumns={4}\n        scrollEnabled={false}\n        columnWrapperStyle={{ gap: GAP_MEDIA }}\n        initialNumToRender={4}\n        maxToRenderPerBatch={4}\n        windowSize={5}\n        removeClippedSubviews={false} // ✅ tránh flicker\n        getItemLayout={(_, index) => ({\n          length: size,\n          offset: Math.floor(index / 4) * size,\n          index,\n        })}\n      />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flexDirection: 'row',\n    marginVertical: 4,\n    paddingHorizontal: 4,\n    borderRadius: 8,\n  },\n  mediaItem: {\n    borderRadius: 8,\n    backgroundColor: 'rgba(0, 0, 0, 0.05)',\n    overflow: 'hidden',\n    alignItems: 'center',\n    justifyContent: 'center',\n    marginBottom: 4,\n  },\n  playIcon: {\n    position: 'absolute',\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'rgba(255, 255, 255, 0.5)',\n  },\n  image: {\n    width: '100%',\n    height: '100%',\n  },\n  reactionIcon: {\n    position: 'absolute',\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n    width: '100%',\n    height: '100%',\n    borderRadius: 8,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  reactionIconText: {\n    color: Color.white,\n    fontSize: 16,\n    fontWeight: '600',\n    lineHeight: 22,\n  },\n  progress: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: 'rgba(0, 0, 0, 0.3)',\n  },\n});\n"],"mappings":"AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,EAAEC,IAAI,EAAEC,MAAM,QAAQ,OAAO;AAChE,SACEC,iBAAiB,EACjBC,QAAQ,EACRC,UAAU,EACVC,IAAI,EACJC,gBAAgB,EAChBC,IAAI,QAEC,cAAc;AAErB,SAASC,kBAAkB,QAAQ,SAAS;AAC5C,OAAOC,SAAS,MAAM,yBAAyB;AAC/C,OAAOC,KAAK,MAAM,SAAS;AAC3B,SAASC,wBAAwB,QAAQ,gCAAgC;AACzE,SAASC,cAAc,QAAQ,UAAU;AAEzC,MAAMC,SAAS,GAAG,CAAC;AAiBnB;AACA,MAAMC,QAAQ,GAAGA,CACfC,SAA8B,EAC9BC,YAAuC,KACpC;EACH,MAAMC,KAAK,GAAGC,MAAM,CAACF,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAEC,KAAK,CAAC,IAAIL,cAAc,CAAC,CAAC,CAAC,CAAC;;EAE/D,MAAMO,SAAS,GAAGF,KAAK,GAAG,IAAI,GAAGJ,SAAS,GAAG,IAAI;EACjD,MAAMO,gBAAgB,GAAGH,KAAK,GAAG,CAAC,GAAGJ,SAAS,GAAG,CAAC;EAElD,IAAIE,SAAS,EAAE,OAAOK,gBAAgB;EACtC,IAAID,SAAS,GAAGP,cAAc,CAAC,CAAC,GAAG,GAAG,EAAE,OAAOA,cAAc,CAAC,CAAC,GAAG,IAAI;EACtE,OAAOO,SAAS;AAClB,CAAC;AAkBD;AACA,MAAME,SAAS,gBAAGrB,IAAI,CACpB,CAAC;EACCsB,IAAI;EACJC,KAAK;EACLC,IAAI;EACJC,QAAQ;EACRV,SAAS;EACTW,UAAU;EACVC,cAAc;EACdC,WAAW;EACXC;AACc,CAAC,KAAK;EACpB,MAAMC,WAAW,GAAGZ,MAAM,CAACI,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAES,QAAQ,CAAC;EAC1C,MAAMC,YAAY,GAAGd,MAAM,CAACe,QAAQ,CAACH,WAAW,CAAC,GAC7CI,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,GAAG,EAAEN,WAAW,CAAC,CAAC,GACvC,CAAC;EAEL,oBACEjC,KAAA,CAAAwC,aAAA,CAAAxC,KAAA,CAAAyC,QAAA,qBACEzC,KAAA,CAAAwC,aAAA,CAAC/B,gBAAgB;IACfiC,WAAW,EAAEV,eAAgB;IAC7BW,OAAO,EAAEA,CAAA,KACPZ,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAGN,IAAI,EAAE,CAAAG,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEgB,MAAM,IAAG,CAAC,IAAIlB,KAAK,KAAK,CAAC,EAAE;MACvD,GAAGI,cAAc;MACjBe,IAAI,EAAEjB;IACR,CAAC,CACF;IACDkB,QAAQ,EACNjB,UAAU,IAAK,CAAAJ,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEsB,SAAS,KAAI,CAAAtB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEuB,QAAQ,MAAK,OACtD;IACDC,KAAK,EAAE,CACLC,MAAM,CAACC,SAAS,EAChB;MACE/B,KAAK,EAAEO,IAAI;MACXyB,MAAM,EAAEzB;IACV,CAAC;EACD,GAED,CAAC,CAAAF,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE4B,gBAAgB,MAAI5B,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE6B,GAAG,MAAI7B,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE8B,GAAG,mBAChDvD,KAAA,CAAAwC,aAAA,CAAC5B,SAAS;IACR4C,MAAM,EAAE;MACNF,GAAG,EAAE,CAAA7B,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE4B,gBAAgB,MAAI5B,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE6B,GAAG,MAAI7B,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE8B,GAAG;MACrDE,QAAQ,EAAE7C,SAAS,CAAC6C,QAAQ,CAACC;IAC/B,CAAE;IACFT,KAAK,EAAEC,MAAM,CAACS;EAAM,CACrB,CACF,EAEA,CAAAlC,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEuB,QAAQ,MAAK,OAAO,iBACzBhD,KAAA,CAAAwC,aAAA,CAAC9B,IAAI;IACHuC,KAAK,EAAE,CACLC,MAAM,CAACU,QAAQ,EACf,CAACzB,YAAY,IAAI,CAAC,IAChBA,YAAY,IAAI,GAAG,KACnBV,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEsB,SAAS,MAAK;MACpB3B,KAAK,EAAEO,IAAI,GAAG,GAAG;MACjByB,MAAM,EAAEzB,IAAI,GAAG,GAAG;MAClBkC,YAAY,EAAGlC,IAAI,GAAG,GAAG,GAAI;IAC/B,CAAC;EACD,GAEDF,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEsB,SAAS,gBACd/C,KAAA,CAAAwC,aAAA,CAACnC,iBAAiB;IAACsB,IAAI,EAAC,OAAO;IAACmC,KAAK,EAAEjD,KAAK,CAACkD;EAAY,CAAE,CAAC,GAE5D,CAAC5B,YAAY,IAAI,CAAC,IAAIA,YAAY,IAAI,GAAG,kBACvCnC,KAAA,CAAAwC,aAAA,CAAC5B,SAAS;IACR4C,MAAM,EAAEQ,OAAO,CAAC,mBAAmB,CAAE;IACrCC,UAAU,EAAErD,SAAS,CAACqD,UAAU,CAACC,KAAM;IACvCjB,KAAK,EAAE;MACL7B,KAAK,EAAGO,IAAI,GAAG,GAAG,GAAI,CAAC;MACvByB,MAAM,EAAGzB,IAAI,GAAG,GAAG,GAAI;IACzB;EAAE,CACH,CAGD,CACP,EAEA,CAAAC,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEgB,MAAM,IAAG,CAAC,IAAIlB,KAAK,KAAK,CAAC,IAAI,CAACR,SAAS,iBAChDlB,KAAA,CAAAwC,aAAA,CAAC9B,IAAI;IAACuC,KAAK,EAAEC,MAAM,CAACiB;EAAa,gBAC/BnE,KAAA,CAAAwC,aAAA,CAAChC,IAAI;IAACyC,KAAK,EAAEC,MAAM,CAACkB;EAAiB,GAAC,IAClC,EAAC,CAAAxC,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEgB,MAAM,IAAG,CAAC,GAAG,EAAE,GAAG,KAAK,GAAG,CAAAhB,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEgB,MAAM,IAAG,CACtD,CACF,CAEQ,CAAC,EAElB,EAACnB,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEsB,SAAS,KAAIZ,YAAY,GAAG,CAAC,IAAIA,YAAY,GAAG,GAAG,iBACzDnC,KAAA,CAAAwC,aAAA,CAAC9B,IAAI;IAACuC,KAAK,EAAE,CAACC,MAAM,CAAChB,QAAQ,EAAE;MAAEd,KAAK,EAAEO,IAAI;MAAEyB,MAAM,EAAEzB;IAAK,CAAC;EAAE,gBAC5D3B,KAAA,CAAAwC,aAAA,CAAC1B,wBAAwB;IACvBa,IAAI,EAAEA,IAAI,GAAG,GAAI;IACjBP,KAAK,EAAE,CAAE;IACTiD,IAAI,EAAElC,YAAa;IACnBmC,SAAS,EAAEzD,KAAK,CAAC0D,KAAM;IACvBC,eAAe,EAAE3D,KAAK,CAAC4D;EAAa,CACrC,CACG,CAER,CAAC;AAEP,CAAC,EACD,CAACC,IAAI,EAAEC,IAAI,KACTD,IAAI,CAACjD,IAAI,CAAC6B,GAAG,KAAKqB,IAAI,CAAClD,IAAI,CAAC6B,GAAG,IAC/BoB,IAAI,CAACjD,IAAI,CAAC4B,gBAAgB,KAAKsB,IAAI,CAAClD,IAAI,CAAC4B,gBAAgB,IACzDqB,IAAI,CAACjD,IAAI,CAACS,QAAQ,KAAKyC,IAAI,CAAClD,IAAI,CAACS,QAAQ,IACzCwC,IAAI,CAACjD,IAAI,CAACsB,SAAS,KAAK4B,IAAI,CAAClD,IAAI,CAACsB,SAAS,IAC3C2B,IAAI,CAAC/C,IAAI,KAAKgD,IAAI,CAAChD,IAAI,CAAC;AAC5B,CAAC;AAED,OAAO,SAASiD,WAAWA,CAAC;EAC1B7C,WAAW;EACXZ,YAAY;EACZW,cAAc;EACdD,UAAU;EACVgD,QAAQ;EACRC,eAAe;EACf5D,SAAS;EACTc;AACgB,CAAC,EAAE;EACnB,MAAM,CAACJ,QAAQ,EAAEmD,WAAW,CAAC,GAAG7E,QAAQ,CACtC,CAAA4B,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAEe,IAAI,KAAI,EAC1B,CAAC;;EAED;EACA,MAAMmC,cAAc,GAAG5E,MAAM,CAAsB,IAAI6E,GAAG,CAAC,CAAC,CAAC;EAC7D,MAAMC,cAAc,GAAG9E,MAAM,CAAc,IAAI+E,GAAG,CAAC,CAAC,CAAC;EAErDlF,SAAS,CAAC,MAAM;IACd,MAAMmF,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC5B,IAAI;QACF,MAAM;UAAEvC;QAAK,CAAC,GAAGf,cAAc;QAC/B,MAAMuD,eAAe,GAAGxC,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEyC,MAAM,CAAE7D,IAAI,IAAKA,IAAI,CAAC6B,GAAG,CAAC;QACxD,IAAI,CAAC+B,eAAe,EAAE;;QAEtB;QACA,MAAME,mBAAmB,GAAGF,eAAe,CAACC,MAAM,CAC/C7D,IAAI,IACHA,IAAI,CAACuB,QAAQ,KAAK,OAAO,IACzB,EAACvB,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAE4B,gBAAgB,KACvB,CAAC6B,cAAc,CAACM,OAAO,CAACC,GAAG,CAAChE,IAAI,CAAC6B,GAAG,CACxC,CAAC;;QAED;QACA,MAAMoC,kBAAkB,GAAGL,eAAe,CAACM,GAAG,CAAElE,IAAI,IAAK;UACvD,IAAIA,IAAI,CAACuB,QAAQ,KAAK,OAAO,IAAI,EAACvB,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAE4B,gBAAgB,GAAE;YACxD,MAAMuC,YAAY,GAAGL,mBAAmB,CAACM,IAAI,CAC1CC,CAAC,IAAKA,CAAC,CAACxC,GAAG,KAAK7B,IAAI,CAAC6B,GACxB,CAAC;YACD,OAAO;cAAE,GAAG7B,IAAI;cAAEsB,SAAS,EAAE6C;YAAa,CAAC;UAC7C;UACA,OAAOnE,IAAI;QACb,CAAC,CAAC;QAEFsD,WAAW,CAACW,kBAAkB,CAAC;;QAE/B;QACA,IAAIH,mBAAmB,CAAC3C,MAAM,GAAG,CAAC,EAAE;UAClC,MAAMmD,MAAM,GAAG,MAAMpF,kBAAkB,CAAC4E,mBAAmB,CAAC;;UAE5D;UACAQ,MAAM,CAACC,OAAO,CAAC,CAACC,GAAG,EAAEvE,KAAK,KAAK;YAC7B,MAAMwE,KAAK,GAAGX,mBAAmB,CAAC7D,KAAK,CAAC;YACxC,IAAIwE,KAAK,IAAID,GAAG,CAACE,IAAI,EAAE;cACrBnB,cAAc,CAACQ,OAAO,CAACY,GAAG,CAACF,KAAK,CAAC5C,GAAG,EAAE2C,GAAG,CAACE,IAAI,CAAC;cAC/CjB,cAAc,CAACM,OAAO,CAACa,GAAG,CAACH,KAAK,CAAC5C,GAAG,CAAC;YACvC;UACF,CAAC,CAAC;QACJ;;QAEA;QACA,MAAMgD,WAAW,GAAGjB,eAAe,CAACM,GAAG,CAAElE,IAAI,IAAK;UAChD,IAAIA,IAAI,CAACuB,QAAQ,KAAK,OAAO,EAAE;YAC7B,MAAMuD,eAAe,GAAGvB,cAAc,CAACQ,OAAO,CAACgB,GAAG,CAAC/E,IAAI,CAAC6B,GAAG,CAAC;YAC5D,MAAMmD,SAAS,GAAG,CAAAhF,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE4B,gBAAgB,KAAIkD,eAAe,IAAI,EAAE;YACjE,OAAO;cACL,GAAG9E,IAAI;cACP4B,gBAAgB,EAAEoD,SAAS;cAC3B1D,SAAS,EAAE;YACb,CAAC;UACH;UACA,OAAOtB,IAAI;QACb,CAAC,CAAC;QAEFqD,eAAe,aAAfA,eAAe,eAAfA,eAAe,CAAGwB,WAAW,CAAC;QAC9BvB,WAAW,CAACuB,WAAW,CAAC;MAC1B,CAAC,CAAC,OAAOI,KAAK,EAAE;QACdC,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEF,KAAK,CAAC;MAC7C;IACF,CAAC;IACDtB,SAAS,CAAC,CAAC;EACb,CAAC,EAAE,CAACtD,cAAc,EAAEgD,eAAe,CAAC,CAAC;EAErC,MAAM+B,YAAY,GAAG3F,SAAS,GAAGU,QAAQ,GAAGA,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEkF,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;EACjE,MAAMnF,IAAI,GAAGV,QAAQ,CAAC,CAAC,CAACC,SAAS,EAAEC,YAAY,CAAC;EAEhD,oBACEnB,KAAA,CAAAwC,aAAA,CAAC9B,IAAI;IAACmE,QAAQ,EAAEA,QAAS;IAAC5B,KAAK,EAAE,CAACC,MAAM,CAAC6D,SAAS,EAAE;MAAEC,GAAG,EAAEhG;IAAU,CAAC;EAAE,gBACtEhB,KAAA,CAAAwC,aAAA,CAAClC,QAAQ;IACP2G,IAAI,EAAEJ,YAAY,IAAI,EAAG;IACzBK,UAAU,EAAEA,CAAC;MAAEzF,IAAI;MAAEC;IAAM,CAAC,kBAC1B1B,KAAA,CAAAwC,aAAA,CAAChB,SAAS;MACRC,IAAI,EAAEA,IAAK;MACXC,KAAK,EAAEA,KAAM;MACbC,IAAI,EAAEA,IAAK;MACXC,QAAQ,EAAEA,QAAS;MACnBV,SAAS,EAAE,CAAC,CAACA,SAAU;MACvBW,UAAU,EAAEA,UAAW;MACvBC,cAAc,EAAEA,cAAe;MAC/BC,WAAW,EAAEA,WAAY;MACzBC,eAAe,EAAEA;IAAgB,CAClC,CACD;IACFmF,YAAY,EAAG1F,IAAI;MAAA,IAAA2F,cAAA,EAAAC,SAAA;MAAA,OACjB,CAAA5F,IAAI,aAAJA,IAAI,gBAAA2F,cAAA,GAAJ3F,IAAI,CAAE6F,QAAQ,cAAAF,cAAA,uBAAdA,cAAA,CAAgBG,QAAQ,CAAC,CAAC,MAAI9F,IAAI,aAAJA,IAAI,gBAAA4F,SAAA,GAAJ5F,IAAI,CAAE6B,GAAG,cAAA+D,SAAA,uBAATA,SAAA,CAAWE,QAAQ,CAAC,CAAC;IAAA,CACpD;IACDC,UAAU,EAAE,CAAE;IACdC,aAAa,EAAE,KAAM;IACrBC,kBAAkB,EAAE;MAAEV,GAAG,EAAEhG;IAAU,CAAE;IACvC2G,kBAAkB,EAAE,CAAE;IACtBC,mBAAmB,EAAE,CAAE;IACvBC,UAAU,EAAE,CAAE;IACdC,qBAAqB,EAAE,KAAM,CAAC;IAAA;IAC9BC,aAAa,EAAEA,CAACC,CAAC,EAAEtG,KAAK,MAAM;MAC5BkB,MAAM,EAAEjB,IAAI;MACZsG,MAAM,EAAE5F,IAAI,CAAC6F,KAAK,CAACxG,KAAK,GAAG,CAAC,CAAC,GAAGC,IAAI;MACpCD;IACF,CAAC;EAAE,CACJ,CACG,CAAC;AAEX;AAEA,MAAMwB,MAAM,GAAG3C,UAAU,CAAC4H,MAAM,CAAC;EAC/BpB,SAAS,EAAE;IACTqB,aAAa,EAAE,KAAK;IACpBC,cAAc,EAAE,CAAC;IACjBC,iBAAiB,EAAE,CAAC;IACpBzE,YAAY,EAAE;EAChB,CAAC;EACDV,SAAS,EAAE;IACTU,YAAY,EAAE,CAAC;IACfW,eAAe,EAAE,qBAAqB;IACtC+D,QAAQ,EAAE,QAAQ;IAClBC,UAAU,EAAE,QAAQ;IACpBC,cAAc,EAAE,QAAQ;IACxBC,YAAY,EAAE;EAChB,CAAC;EACD9E,QAAQ,EAAE;IACR+E,QAAQ,EAAE,UAAU;IACpBF,cAAc,EAAE,QAAQ;IACxBD,UAAU,EAAE,QAAQ;IACpBhE,eAAe,EAAE;EACnB,CAAC;EACDb,KAAK,EAAE;IACLvC,KAAK,EAAE,MAAM;IACbgC,MAAM,EAAE;EACV,CAAC;EACDe,YAAY,EAAE;IACZwE,QAAQ,EAAE,UAAU;IACpBnE,eAAe,EAAE,oBAAoB;IACrCpD,KAAK,EAAE,MAAM;IACbgC,MAAM,EAAE,MAAM;IACdS,YAAY,EAAE,CAAC;IACf4E,cAAc,EAAE,QAAQ;IACxBD,UAAU,EAAE;EACd,CAAC;EACDpE,gBAAgB,EAAE;IAChBN,KAAK,EAAEjD,KAAK,CAAC0D,KAAK;IAClBqE,QAAQ,EAAE,EAAE;IACZC,UAAU,EAAE,KAAK;IACjBC,UAAU,EAAE;EACd,CAAC;EACD5G,QAAQ,EAAE;IACRyG,QAAQ,EAAE,UAAU;IACpBI,GAAG,EAAE,CAAC;IACNC,IAAI,EAAE,CAAC;IACPR,UAAU,EAAE,QAAQ;IACpBC,cAAc,EAAE,QAAQ;IACxBjE,eAAe,EAAE;EACnB;AACF,CAAC,CAAC","ignoreList":[]}