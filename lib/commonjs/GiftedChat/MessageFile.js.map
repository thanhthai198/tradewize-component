{"version":3,"names":["_reactNative","require","_react","_utils","_reactNativeFastImage","_interopRequireDefault","_Color","_ButtonBase","e","__esModule","default","GAP_MEDIA","MessageFile","onPressFile","messageWidth","currentMessage","isReaction","onLayout","onSaveThumbnail","isShowAll","arrMedia","setArrMedia","useState","file","MediaItem","useCallback","item","index","sizeMedia","Number","width","sizeMediaShowAll","React","createElement","ButtonBase","onPress","length","disabled","isLoading","typeFile","style","styles","mediaItem","height","source","uri","thumbnailPreview","image","View","playIcon","borderRadius","ActivityIndicator","size","color","Color","defaultBlue","iconPlay","reactionIcon","Text","reactionIconText","renderFile","useMemo","arrMediaShow","slice","container","gap","map","key","useEffect","fetchData","getFileComplete","filter","newArrMediaLoading","arrVideo","result","generateThumbnails","newArrMedia","_result$find","videoIndex","findIndex","v","path","find","res","error","console","log","StyleSheet","create","flexDirection","flexWrap","paddingHorizontal","paddingTop","marginBottom","backgroundColor","overflow","alignItems","justifyContent","position","marginLeft","white","fontSize","fontWeight","lineHeight"],"sources":["MessageFile.tsx"],"sourcesContent":["import {\n  ActivityIndicator,\n  StyleSheet,\n  Text,\n  View,\n  type LayoutChangeEvent,\n} from 'react-native';\nimport type { FileMessage, IMessage } from './types';\nimport { useCallback, useEffect, useState } from 'react';\nimport { useMemo } from 'react';\nimport { generateThumbnails } from './utils';\nimport FastImage from 'react-native-fast-image';\nimport Color from './Color';\nimport { ButtonBase } from '../ButtonBase';\n\nconst GAP_MEDIA = 3;\n\ninterface MessageFileProps {\n  onPressFile?: (\n    file: FileMessage,\n    isShowAll?: boolean,\n    arrMedia?: IMessage\n  ) => void;\n  messageWidth: { width: number; _id: string } | null;\n  currentMessage: IMessage;\n  isReaction?: boolean;\n  onLayout?: (event: LayoutChangeEvent) => void;\n  onSaveThumbnail?: (file: FileMessage[]) => void;\n  isShowAll?: boolean;\n}\n\nexport function MessageFile({\n  onPressFile,\n  messageWidth,\n  currentMessage,\n  isReaction,\n  onLayout,\n  onSaveThumbnail,\n  isShowAll,\n}: MessageFileProps) {\n  const [arrMedia, setArrMedia] = useState<FileMessage[]>(\n    currentMessage?.file || []\n  );\n\n  const MediaItem = useCallback(\n    ({ item, index }: { item: FileMessage; index: number }) => {\n      const sizeMedia = Number(messageWidth?.width) / 4.65 - GAP_MEDIA * 3.65;\n      const sizeMediaShowAll = Number(messageWidth?.width) / 4 - GAP_MEDIA * 3;\n      return (\n        <ButtonBase\n          onPress={() =>\n            onPressFile?.(item, arrMedia?.length > 8 && index === 7, {\n              ...currentMessage,\n              file: arrMedia,\n            })\n          }\n          disabled={\n            isReaction || (item?.isLoading && item?.typeFile === 'video')\n          }\n          style={[\n            styles.mediaItem,\n            {\n              width: isShowAll ? sizeMediaShowAll : sizeMedia,\n              height: isShowAll ? sizeMediaShowAll : sizeMedia,\n            },\n          ]}\n        >\n          <FastImage\n            source={{ uri: item.thumbnailPreview || item.uri }}\n            style={styles.image}\n          />\n\n          {item?.typeFile === 'video' && (\n            <View\n              style={[\n                styles.playIcon,\n                {\n                  width: sizeMedia * 0.5,\n                  height: sizeMedia * 0.5,\n                  borderRadius: (sizeMedia * 0.5) / 2,\n                },\n              ]}\n            >\n              {item?.isLoading ? (\n                <ActivityIndicator size=\"small\" color={Color.defaultBlue} />\n              ) : (\n                <FastImage\n                  source={require('../assets/play.png')}\n                  style={[\n                    styles.iconPlay,\n                    {\n                      width: (sizeMedia * 0.5) / 2,\n                      height: (sizeMedia * 0.5) / 2,\n                    },\n                  ]}\n                />\n              )}\n            </View>\n          )}\n\n          {arrMedia?.length > 8 && index === 7 && !isShowAll && (\n            <View style={styles.reactionIcon}>\n              <Text style={styles.reactionIconText}>\n                + {arrMedia?.length - 8 > 99 ? '99+' : arrMedia?.length - 8}\n              </Text>\n            </View>\n          )}\n        </ButtonBase>\n      );\n    },\n    [messageWidth, onPressFile, isReaction, arrMedia, currentMessage, isShowAll]\n  );\n\n  const renderFile = useMemo(() => {\n    if (!currentMessage?.file) return null;\n\n    const arrMediaShow = isShowAll ? arrMedia : arrMedia?.slice(0, 8);\n\n    return (\n      <View\n        onLayout={onLayout}\n        style={[\n          styles.container,\n          {\n            gap: GAP_MEDIA,\n          },\n        ]}\n      >\n        {arrMediaShow?.map((item, index) => (\n          <MediaItem key={`${item.uri}-${index}`} item={item} index={index} />\n        ))}\n      </View>\n    );\n  }, [currentMessage?.file, arrMedia, MediaItem, onLayout, isShowAll]);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const { file } = currentMessage;\n        const getFileComplete = file?.filter((item) => item.uri);\n        if (!getFileComplete) return;\n\n        // isLoading: true cho video\n        const newArrMediaLoading = getFileComplete.map((item) => {\n          if (item.typeFile === 'video') {\n            const isLoading = !item?.thumbnailPreview;\n            return { ...item, isLoading };\n          }\n          return item;\n        });\n\n        setArrMedia(newArrMediaLoading);\n\n        // Lấy danh sách video để generate thumbnail\n        const arrVideo = getFileComplete.filter(\n          (item) => item.typeFile === 'video'\n        );\n        const result = await generateThumbnails(arrVideo); // generate tất cả video một lần\n\n        const newArrMedia = getFileComplete.map((item) => {\n          if (item.typeFile === 'video') {\n            // Tìm thumbnail tương ứng theo vị trí trong arrVideo\n            const videoIndex = arrVideo.findIndex((v) => v.uri === item.uri);\n            const path = result?.find((res) => res?.index === videoIndex)?.path;\n            // isLoading: false cho video\n            return { ...item, thumbnailPreview: path, isLoading: false };\n          }\n          return item; // Không phải video thì giữ nguyên\n        });\n        onSaveThumbnail?.(newArrMedia);\n        setArrMedia(newArrMedia);\n      } catch (error) {\n        console.log('error fetchData media', error);\n      }\n    };\n    fetchData();\n  }, [currentMessage, onSaveThumbnail]);\n\n  return renderFile;\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    paddingHorizontal: 8,\n    paddingTop: 8,\n    marginBottom: 4,\n  },\n  mediaItem: {\n    borderRadius: 8,\n    backgroundColor: 'rgba(0, 0, 0, 0.05)',\n    overflow: 'hidden',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  playIcon: {\n    position: 'absolute',\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'rgba(255, 255, 255, 0.5)',\n  },\n  iconPlay: {\n    marginLeft: 4,\n  },\n  image: {\n    width: '100%',\n    height: '100%',\n  },\n  reactionIcon: {\n    position: 'absolute',\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n    width: '100%',\n    height: '100%',\n    borderRadius: 8,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  reactionIconText: {\n    color: Color.white,\n    fontSize: 16,\n    fontWeight: '600',\n    lineHeight: 22,\n  },\n});\n"],"mappings":"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","ignoreList":[]}