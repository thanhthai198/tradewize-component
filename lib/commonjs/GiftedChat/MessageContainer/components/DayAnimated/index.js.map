{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNativeReanimated","_Day","_utils","_Item","_styles","_interopRequireDefault","_styles2","_types","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","set","getOwnPropertyDescriptor","_extends","assign","bind","arguments","length","apply","DayAnimated","scrolledY","daysPositions","listHeight","renderDay","messages","isLoadingEarlier","rest","opacity","useSharedValue","fadeOutOpacityTimeoutId","undefined","containerHeight","isScrolledOnMount","isLoadingEarlierAnim","daysPositionsArray","useDerivedValue","values","value","sort","a","b","y","createdAt","setCreatedAt","useState","dayTopOffset","useMemo","dayBottomMargin","absoluteScrolledPositionToBottomOfDay","useAbsoluteScrolledPositionToBottomOfDay","relativeScrolledPositionToBottomOfDay","useRelativeScrolledPositionToBottomOfDay","messagesDates","previousMessage","message","isSameDay","includes","Date","getTime","push","createdAtDate","day","dayPosition","height","style","useAnimatedStyle","top","interpolate","contentStyle","fadeOut","useCallback","withTiming","duration","scheduleFadeOut","clearTimeout","setTimeout","handleLayout","nativeEvent","layout","useAnimatedReaction","prevValue","runOnJS","useEffect","createElement","View","stylesCommon","centerItems","styles","dayAnimated","onLayout","pointerEvents","Day","containerStyle","dayAnimatedDayContainerStyle","_default"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { type LayoutChangeEvent } from 'react-native';\r\nimport Animated, {\r\n  interpolate,\r\n  useAnimatedStyle,\r\n  useDerivedValue,\r\n  useSharedValue,\r\n  useAnimatedReaction,\r\n  withTiming,\r\n  runOnJS,\r\n} from 'react-native-reanimated';\r\nimport { Day } from '../../../Day';\r\nimport { isSameDay } from '../../../utils';\r\nimport {\r\n  useAbsoluteScrolledPositionToBottomOfDay,\r\n  useRelativeScrolledPositionToBottomOfDay,\r\n} from '../Item';\r\nimport { type DayAnimatedProps } from './types';\r\n\r\nimport stylesCommon from '../../../styles';\r\nimport styles from './styles';\r\n\r\nexport * from './types';\r\n\r\nconst DayAnimated = ({\r\n  scrolledY,\r\n  daysPositions,\r\n  listHeight,\r\n  renderDay,\r\n  messages,\r\n  isLoadingEarlier,\r\n  ...rest\r\n}: DayAnimatedProps) => {\r\n  const opacity = useSharedValue(0);\r\n  const fadeOutOpacityTimeoutId = useSharedValue<\r\n    ReturnType<typeof setTimeout> | undefined\r\n  >(undefined);\r\n  const containerHeight = useSharedValue(0);\r\n\r\n  const isScrolledOnMount = useSharedValue(false);\r\n  const isLoadingEarlierAnim = useSharedValue(isLoadingEarlier);\r\n\r\n  const daysPositionsArray = useDerivedValue(() =>\r\n    Object.values(daysPositions.value).sort((a, b) => a.y - b.y)\r\n  );\r\n\r\n  const [createdAt, setCreatedAt] = useState<number | undefined>();\r\n\r\n  const dayTopOffset = useMemo(() => 10, []);\r\n  const dayBottomMargin = useMemo(() => 10, []);\r\n  const absoluteScrolledPositionToBottomOfDay =\r\n    useAbsoluteScrolledPositionToBottomOfDay(\r\n      listHeight,\r\n      scrolledY,\r\n      containerHeight,\r\n      dayBottomMargin,\r\n      dayTopOffset\r\n    );\r\n  const relativeScrolledPositionToBottomOfDay =\r\n    useRelativeScrolledPositionToBottomOfDay(\r\n      listHeight,\r\n      scrolledY,\r\n      daysPositions,\r\n      containerHeight,\r\n      dayBottomMargin,\r\n      dayTopOffset\r\n    );\r\n\r\n  const messagesDates = useMemo(() => {\r\n    const messagesDates: number[] = [];\r\n\r\n    for (let i = 1; i < messages.length; i++) {\r\n      const previousMessage: any = messages[i - 1];\r\n      const message: any = messages[i];\r\n\r\n      if (\r\n        !isSameDay(previousMessage, message) ||\r\n        !messagesDates.includes(new Date(message.createdAt).getTime())\r\n      )\r\n        messagesDates.push(new Date(message.createdAt).getTime());\r\n    }\r\n\r\n    return messagesDates;\r\n  }, [messages]);\r\n\r\n  const createdAtDate = useDerivedValue(() => {\r\n    for (let i = 0; i < daysPositionsArray.value.length; i++) {\r\n      const day: any = daysPositionsArray.value[i];\r\n      const dayPosition =\r\n        day.y + day.height - containerHeight.value - dayBottomMargin;\r\n\r\n      if (absoluteScrolledPositionToBottomOfDay.value < dayPosition)\r\n        return day.createdAt;\r\n    }\r\n\r\n    return messagesDates[messagesDates.length - 1];\r\n  }, [\r\n    daysPositionsArray,\r\n    absoluteScrolledPositionToBottomOfDay,\r\n    messagesDates,\r\n    containerHeight,\r\n    dayBottomMargin,\r\n  ]);\r\n\r\n  const style = useAnimatedStyle(\r\n    () => ({\r\n      top: interpolate(\r\n        relativeScrolledPositionToBottomOfDay.value,\r\n        [\r\n          -dayTopOffset,\r\n          -0.0001,\r\n          0,\r\n          isLoadingEarlierAnim.value ? 0 : containerHeight.value + dayTopOffset,\r\n        ],\r\n        [\r\n          dayTopOffset,\r\n          dayTopOffset,\r\n          -containerHeight.value,\r\n          isLoadingEarlierAnim.value ? -containerHeight.value : dayTopOffset,\r\n        ],\r\n        'clamp'\r\n      ),\r\n    }),\r\n    [\r\n      relativeScrolledPositionToBottomOfDay,\r\n      containerHeight,\r\n      dayTopOffset,\r\n      isLoadingEarlierAnim,\r\n    ]\r\n  );\r\n\r\n  const contentStyle = useAnimatedStyle(\r\n    () => ({\r\n      opacity: opacity.value,\r\n    }),\r\n    [opacity]\r\n  );\r\n\r\n  const fadeOut = useCallback(() => {\r\n    'worklet';\r\n\r\n    opacity.value = withTiming(0, { duration: 500 });\r\n  }, [opacity]);\r\n\r\n  const scheduleFadeOut = useCallback(() => {\r\n    clearTimeout(fadeOutOpacityTimeoutId.value);\r\n\r\n    fadeOutOpacityTimeoutId.value = setTimeout(fadeOut, 500);\r\n  }, [fadeOut, fadeOutOpacityTimeoutId]);\r\n\r\n  const handleLayout = useCallback(\r\n    ({ nativeEvent }: LayoutChangeEvent) => {\r\n      containerHeight.value = nativeEvent.layout.height;\r\n    },\r\n    [containerHeight]\r\n  );\r\n\r\n  useAnimatedReaction(\r\n    () => [scrolledY.value, daysPositionsArray],\r\n    (value, prevValue) => {\r\n      if (!isScrolledOnMount.value) {\r\n        isScrolledOnMount.value = true;\r\n        return;\r\n      }\r\n\r\n      if (value[0] === prevValue?.[0]) return;\r\n\r\n      opacity.value = withTiming(1, { duration: 500 });\r\n\r\n      runOnJS(scheduleFadeOut)();\r\n    },\r\n    [scrolledY, scheduleFadeOut, daysPositionsArray]\r\n  );\r\n\r\n  useAnimatedReaction(\r\n    () => createdAtDate.value,\r\n    (value, prevValue) => {\r\n      if (value && value !== prevValue) runOnJS(setCreatedAt)(value);\r\n    },\r\n    [createdAtDate]\r\n  );\r\n\r\n  useEffect(() => {\r\n    isLoadingEarlierAnim.value = isLoadingEarlier;\r\n  }, [isLoadingEarlierAnim, isLoadingEarlier]);\r\n\r\n  if (!createdAt) return null;\r\n\r\n  return (\r\n    <Animated.View\r\n      style={[stylesCommon.centerItems, styles.dayAnimated, style]}\r\n      onLayout={handleLayout}\r\n    >\r\n      <Animated.View style={contentStyle} pointerEvents=\"none\">\r\n        {renderDay ? (\r\n          renderDay({ ...rest, createdAt })\r\n        ) : (\r\n          <Day\r\n            {...rest}\r\n            containerStyle={[\r\n              styles.dayAnimatedDayContainerStyle,\r\n              rest.containerStyle,\r\n            ]}\r\n            createdAt={createdAt}\r\n          />\r\n        )}\r\n      </Animated.View>\r\n    </Animated.View>\r\n  );\r\n};\r\n\r\nexport default DayAnimated;\r\n"],"mappings":"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","ignoreList":[]}