{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNativeReanimated","_Day","_utils","_Item","_styles","_interopRequireDefault","_styles2","_types","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","set","getOwnPropertyDescriptor","_extends","assign","bind","arguments","length","apply","DayAnimated","scrolledY","daysPositions","listHeight","renderDay","messages","isLoadingEarlier","rest","opacity","useSharedValue","fadeOutOpacityTimeoutId","undefined","containerHeight","isScrolledOnMount","isLoadingEarlierAnim","daysPositionsArray","useDerivedValue","values","value","sort","a","b","y","createdAt","setCreatedAt","useState","dayTopOffset","useMemo","dayBottomMargin","absoluteScrolledPositionToBottomOfDay","useAbsoluteScrolledPositionToBottomOfDay","relativeScrolledPositionToBottomOfDay","useRelativeScrolledPositionToBottomOfDay","messagesDates","previousMessage","message","isSameDay","includes","Date","getTime","push","createdAtDate","day","dayPosition","height","style","useAnimatedStyle","top","interpolate","contentStyle","fadeOut","useCallback","withTiming","duration","scheduleFadeOut","clearTimeout","setTimeout","handleLayout","nativeEvent","layout","useAnimatedReaction","prevValue","runOnJS","useEffect","createElement","View","stylesCommon","centerItems","styles","dayAnimated","onLayout","pointerEvents","Day","containerStyle","dayAnimatedDayContainerStyle","_default"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { type LayoutChangeEvent } from 'react-native';\nimport Animated, {\n  interpolate,\n  useAnimatedStyle,\n  useDerivedValue,\n  useSharedValue,\n  useAnimatedReaction,\n  withTiming,\n  runOnJS,\n} from 'react-native-reanimated';\nimport { Day } from '../../../Day';\nimport { isSameDay } from '../../../utils';\nimport {\n  useAbsoluteScrolledPositionToBottomOfDay,\n  useRelativeScrolledPositionToBottomOfDay,\n} from '../Item';\nimport { type DayAnimatedProps } from './types';\n\nimport stylesCommon from '../../../styles';\nimport styles from './styles';\n\nexport * from './types';\n\nconst DayAnimated = ({\n  scrolledY,\n  daysPositions,\n  listHeight,\n  renderDay,\n  messages,\n  isLoadingEarlier,\n  ...rest\n}: DayAnimatedProps) => {\n  const opacity = useSharedValue(0);\n  const fadeOutOpacityTimeoutId = useSharedValue<\n    ReturnType<typeof setTimeout> | undefined\n  >(undefined);\n  const containerHeight = useSharedValue(0);\n\n  const isScrolledOnMount = useSharedValue(false);\n  const isLoadingEarlierAnim = useSharedValue(isLoadingEarlier);\n\n  const daysPositionsArray = useDerivedValue(() =>\n    Object.values(daysPositions.value).sort((a, b) => a.y - b.y)\n  );\n\n  const [createdAt, setCreatedAt] = useState<number | undefined>();\n\n  const dayTopOffset = useMemo(() => 10, []);\n  const dayBottomMargin = useMemo(() => 10, []);\n  const absoluteScrolledPositionToBottomOfDay =\n    useAbsoluteScrolledPositionToBottomOfDay(\n      listHeight,\n      scrolledY,\n      containerHeight,\n      dayBottomMargin,\n      dayTopOffset\n    );\n  const relativeScrolledPositionToBottomOfDay =\n    useRelativeScrolledPositionToBottomOfDay(\n      listHeight,\n      scrolledY,\n      daysPositions,\n      containerHeight,\n      dayBottomMargin,\n      dayTopOffset\n    );\n\n  const messagesDates = useMemo(() => {\n    const messagesDates: number[] = [];\n\n    for (let i = 1; i < messages.length; i++) {\n      const previousMessage: any = messages[i - 1];\n      const message: any = messages[i];\n\n      if (\n        !isSameDay(previousMessage, message) ||\n        !messagesDates.includes(new Date(message.createdAt).getTime())\n      )\n        messagesDates.push(new Date(message.createdAt).getTime());\n    }\n\n    return messagesDates;\n  }, [messages]);\n\n  const createdAtDate = useDerivedValue(() => {\n    for (let i = 0; i < daysPositionsArray.value.length; i++) {\n      const day: any = daysPositionsArray.value[i];\n      const dayPosition =\n        day.y + day.height - containerHeight.value - dayBottomMargin;\n\n      if (absoluteScrolledPositionToBottomOfDay.value < dayPosition)\n        return day.createdAt;\n    }\n\n    return messagesDates[messagesDates.length - 1];\n  }, [\n    daysPositionsArray,\n    absoluteScrolledPositionToBottomOfDay,\n    messagesDates,\n    containerHeight,\n    dayBottomMargin,\n  ]);\n\n  const style = useAnimatedStyle(\n    () => ({\n      top: interpolate(\n        relativeScrolledPositionToBottomOfDay.value,\n        [\n          -dayTopOffset,\n          -0.0001,\n          0,\n          isLoadingEarlierAnim.value ? 0 : containerHeight.value + dayTopOffset,\n        ],\n        [\n          dayTopOffset,\n          dayTopOffset,\n          -containerHeight.value,\n          isLoadingEarlierAnim.value ? -containerHeight.value : dayTopOffset,\n        ],\n        'clamp'\n      ),\n    }),\n    [\n      relativeScrolledPositionToBottomOfDay,\n      containerHeight,\n      dayTopOffset,\n      isLoadingEarlierAnim,\n    ]\n  );\n\n  const contentStyle = useAnimatedStyle(\n    () => ({\n      opacity: opacity.value,\n    }),\n    [opacity]\n  );\n\n  const fadeOut = useCallback(() => {\n    'worklet';\n\n    opacity.value = withTiming(0, { duration: 500 });\n  }, [opacity]);\n\n  const scheduleFadeOut = useCallback(() => {\n    clearTimeout(fadeOutOpacityTimeoutId.value);\n\n    fadeOutOpacityTimeoutId.value = setTimeout(fadeOut, 500);\n  }, [fadeOut, fadeOutOpacityTimeoutId]);\n\n  const handleLayout = useCallback(\n    ({ nativeEvent }: LayoutChangeEvent) => {\n      containerHeight.value = nativeEvent.layout.height;\n    },\n    [containerHeight]\n  );\n\n  useAnimatedReaction(\n    () => [scrolledY.value, daysPositionsArray],\n    (value, prevValue) => {\n      if (!isScrolledOnMount.value) {\n        isScrolledOnMount.value = true;\n        return;\n      }\n\n      if (value[0] === prevValue?.[0]) return;\n\n      opacity.value = withTiming(1, { duration: 500 });\n\n      runOnJS(scheduleFadeOut)();\n    },\n    [scrolledY, scheduleFadeOut, daysPositionsArray]\n  );\n\n  useAnimatedReaction(\n    () => createdAtDate.value,\n    (value, prevValue) => {\n      if (value && value !== prevValue) runOnJS(setCreatedAt)(value);\n    },\n    [createdAtDate]\n  );\n\n  useEffect(() => {\n    isLoadingEarlierAnim.value = isLoadingEarlier;\n  }, [isLoadingEarlierAnim, isLoadingEarlier]);\n\n  if (!createdAt) return null;\n\n  return (\n    <Animated.View\n      style={[stylesCommon.centerItems, styles.dayAnimated, style]}\n      onLayout={handleLayout}\n    >\n      <Animated.View style={contentStyle} pointerEvents=\"none\">\n        {renderDay ? (\n          renderDay({ ...rest, createdAt })\n        ) : (\n          <Day\n            {...rest}\n            containerStyle={[\n              styles.dayAnimatedDayContainerStyle,\n              rest.containerStyle,\n            ]}\n            createdAt={createdAt}\n          />\n        )}\n      </Animated.View>\n    </Animated.View>\n  );\n};\n\nexport default DayAnimated;\n"],"mappings":"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","ignoreList":[]}