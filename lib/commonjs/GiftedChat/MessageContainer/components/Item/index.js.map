{"version":3,"names":["_react","require","_reactNative","_Message","_interopRequireDefault","_reactNativeReanimated","_interopRequireWildcard","_Day","_utils","_types","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","set","getOwnPropertyDescriptor","_extends","assign","bind","arguments","length","apply","useAbsoluteScrolledPositionToBottomOfDay","listHeight","scrolledY","containerHeight","dayBottomMargin","dayTopOffset","absoluteScrolledPositionToBottomOfDay","useDerivedValue","value","useRelativeScrolledPositionToBottomOfDay","daysPositions","createdAt","dayMarginTop","useMemo","daysPositionsArray","values","sort","a","b","y","currentDayPosition","find","day","index","dayPosition","height","relativeScrolledPositionToBottomOfDay","_currentDayPosition$v","_currentDayPosition$v2","scrolledBottomY","DayWrapper","forwardRef","props","ref","renderDay","renderDayProp","currentMessage","previousMessage","isSameDay","containerStyle","onMessageLayout","rest","React","createElement","View","Day","Item","renderMessage","renderMessageProp","onPressFile","onLongPressReaction","dayContainerHeight","useSharedValue","Date","getTime","handleLayoutDayContainer","useCallback","nativeEvent","layout","style","useAnimatedStyle","opacity","interpolate","_id","toString","onLayout","_default"],"sources":["index.tsx"],"sourcesContent":["import { forwardRef, useCallback, useMemo } from 'react';\nimport { type LayoutChangeEvent, View } from 'react-native';\nimport { type IMessage } from '../../../types';\nimport Message, { type MessageProps } from '../../../Message';\nimport Animated, {\n  interpolate,\n  useAnimatedStyle,\n  useDerivedValue,\n  useSharedValue,\n} from 'react-native-reanimated';\nimport { type DaysPositions } from '../../types';\nimport { Day } from '../../../Day';\nimport { isSameDay } from '../../../utils';\nimport { type ItemProps } from './types';\n\nexport * from './types';\n\n// y-position of current scroll position relative to the bottom of the day container. (since we have inverted list it is bottom)\nexport const useAbsoluteScrolledPositionToBottomOfDay = (\n  listHeight: { value: number },\n  scrolledY: { value: number },\n  containerHeight: { value: number },\n  dayBottomMargin: number,\n  dayTopOffset: number\n) => {\n  const absoluteScrolledPositionToBottomOfDay = useDerivedValue(\n    () =>\n      listHeight.value +\n      scrolledY.value -\n      containerHeight.value -\n      dayBottomMargin -\n      dayTopOffset,\n    [listHeight, scrolledY, containerHeight, dayBottomMargin, dayTopOffset]\n  );\n\n  return absoluteScrolledPositionToBottomOfDay;\n};\n\nexport const useRelativeScrolledPositionToBottomOfDay = (\n  listHeight: { value: number },\n  scrolledY: { value: number },\n  daysPositions: { value: DaysPositions },\n  containerHeight: { value: number },\n  dayBottomMargin: number,\n  dayTopOffset: number,\n  createdAt?: number\n) => {\n  const dayMarginTop = useMemo(() => 5, []);\n\n  const absoluteScrolledPositionToBottomOfDay =\n    useAbsoluteScrolledPositionToBottomOfDay(\n      listHeight,\n      scrolledY,\n      containerHeight,\n      dayBottomMargin,\n      dayTopOffset\n    );\n\n  // sorted array of days positions by y\n  const daysPositionsArray = useDerivedValue(() =>\n    Object.values(daysPositions.value).sort((a, b) => a.y - b.y)\n  );\n\n  // find current day position by scrolled position\n  const currentDayPosition = useDerivedValue(() => {\n    if (createdAt != null) {\n      const currentDayPosition = daysPositionsArray.value.find(\n        (day) => day.createdAt === createdAt\n      );\n      if (currentDayPosition) return currentDayPosition;\n    }\n\n    return daysPositionsArray.value.find((day, index) => {\n      const dayPosition = day.y + day.height;\n      return (\n        absoluteScrolledPositionToBottomOfDay.value < dayPosition ||\n        index === daysPositionsArray.value.length - 1\n      );\n    });\n  }, [daysPositionsArray, absoluteScrolledPositionToBottomOfDay, createdAt]);\n\n  const relativeScrolledPositionToBottomOfDay = useDerivedValue(() => {\n    const scrolledBottomY =\n      listHeight.value +\n      scrolledY.value -\n      ((currentDayPosition.value?.y ?? 0) +\n        (currentDayPosition.value?.height ?? 0) +\n        dayMarginTop);\n\n    return scrolledBottomY;\n  }, [listHeight, scrolledY, currentDayPosition, dayMarginTop]);\n\n  return relativeScrolledPositionToBottomOfDay;\n};\n\nconst DayWrapper = forwardRef<View, MessageProps<IMessage>>((props, ref) => {\n  const { renderDay: renderDayProp, currentMessage, previousMessage } = props;\n\n  if (!currentMessage?.createdAt || isSameDay(currentMessage, previousMessage))\n    return null;\n\n  const {\n    /* eslint-disable @typescript-eslint/no-unused-vars */\n    containerStyle,\n    onMessageLayout,\n    /* eslint-enable @typescript-eslint/no-unused-vars */\n    ...rest\n  } = props;\n\n  return (\n    <View ref={ref}>\n      {renderDayProp ? (\n        renderDayProp({ ...rest, createdAt: currentMessage.createdAt })\n      ) : (\n        <Day {...rest} createdAt={currentMessage.createdAt} />\n      )}\n    </View>\n  );\n});\n\nconst Item = <TMessage extends IMessage>(props: ItemProps<TMessage>) => {\n  const {\n    renderMessage: renderMessageProp,\n    scrolledY,\n    daysPositions,\n    listHeight,\n    onPressFile,\n    onLongPressReaction,\n    ...rest\n  } = props;\n\n  const dayContainerHeight = useSharedValue(0);\n  const dayTopOffset = useMemo(() => 10, []);\n  const dayBottomMargin = useMemo(() => 10, []);\n\n  const createdAt = useMemo(\n    () => new Date(props.currentMessage.createdAt).getTime(),\n    [props.currentMessage.createdAt]\n  );\n\n  const relativeScrolledPositionToBottomOfDay =\n    useRelativeScrolledPositionToBottomOfDay(\n      listHeight,\n      scrolledY,\n      daysPositions,\n      dayContainerHeight,\n      dayBottomMargin,\n      dayTopOffset,\n      createdAt\n    );\n\n  const handleLayoutDayContainer = useCallback(\n    ({ nativeEvent }: LayoutChangeEvent) => {\n      dayContainerHeight.value = nativeEvent.layout.height;\n    },\n    [dayContainerHeight]\n  );\n\n  const style = useAnimatedStyle(\n    () => ({\n      opacity: interpolate(\n        relativeScrolledPositionToBottomOfDay.value,\n        [-dayTopOffset, -0.0001, 0, dayContainerHeight.value + dayTopOffset],\n        [0, 0, 1, 1],\n        'clamp'\n      ),\n    }),\n    [relativeScrolledPositionToBottomOfDay, dayContainerHeight, dayTopOffset]\n  );\n\n  return (\n    // do not remove key. it helps to get correct position of the day container\n    <View key={props.currentMessage._id.toString()}>\n      <Animated.View style={style} onLayout={handleLayoutDayContainer}>\n        <DayWrapper {...(rest as MessageProps<TMessage>)} />\n      </Animated.View>\n      {renderMessageProp ? (\n        renderMessageProp(rest as MessageProps<TMessage>)\n      ) : (\n        <Message\n          {...(rest as MessageProps<TMessage>)}\n          onPressFile={onPressFile}\n          onLongPressReaction={onLongPressReaction}\n        />\n      )}\n    </View>\n  );\n};\n\nexport default Item;\n"],"mappings":"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","ignoreList":[]}