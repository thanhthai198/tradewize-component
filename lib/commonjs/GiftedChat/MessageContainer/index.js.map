{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_reactNativeReanimated","_DayAnimated","_interopRequireDefault","_Item","_LoadEarlier","_TypingIndicator","_logging","_styles","_styles2","_utils","_types","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","set","getOwnPropertyDescriptor","_extends","assign","bind","arguments","length","apply","AnimatedFlatList","Animated","createAnimatedComponent","FlatList","MessageContainer","props","messages","user","isTyping","renderChatEmpty","renderChatEmptyProp","onLoadEarlier","inverted","loadEarlier","listViewProps","invertibleScrollViewProps","extraData","isScrollToBottomEnabled","scrollToBottomOffset","alignTop","scrollToBottomStyle","infiniteScroll","isLoadingEarlier","renderTypingIndicator","renderTypingIndicatorProp","renderFooter","renderFooterProp","renderLoadEarlier","renderLoadEarlierProp","forwardRef","handleOnScroll","handleOnScrollProp","scrollToBottomComponent","scrollToBottomComponentProp","renderDay","renderDayProp","onPressFile","onLongPressReaction","scrollToBottomOpacity","useSharedValue","isScrollToBottomVisible","setIsScrollToBottomVisible","useState","scrollToBottomStyleAnim","useAnimatedStyle","opacity","value","daysPositions","listHeight","scrolledY","useCallback","createElement","ListFooterComponent","useMemo","Fragment","LoadEarlier","scrollTo","options","current","scrollToOffset","doScrollToBottom","animated","offset","scrollToEnd","event","contentOffset","y","contentOffsetY","contentSize","height","contentSizeHeight","layoutMeasurement","layoutMeasurementHeight","duration","makeScrollToBottomVisible","withTiming","makeScrollToBottomHidden","isFinished","runOnJS","renderItem","item","index","messageItem","_id","warning","JSON","stringify","system","restProps","previousMessage","nextMessage","messageProps","currentMessage","position","View","style","stylesCommon","fill","styles","emptyChatContainer","ListHeaderComponent","content","renderScrollBottomComponent","Text","renderScrollToBottomWrapper","TouchableOpacity","onPress","centerItems","onLayoutList","_listViewProps$onLayo","nativeEvent","layout","setTimeout","onLayout","onEndReached","Platform","OS","keyExtractor","toString","renderCell","handleOnLayout","_props$onLayout","_props$item","newValue","createdAt","Date","getTime","modify","isSameDay","date1","date2","d1","d2","getDate","getMonth","getFullYear","entries","children","scrollHandler","useAnimatedScrollHandler","onScroll","useEffect","messageIndex","findIndex","m","shouldRemove","prevMessage","message","contentContainerStyle","containerAlignTop","ref","data","automaticallyAdjustContentInsets","ListEmptyComponent","scrollEventThrottle","onEndReachedThreshold","CellRendererComponent","_default"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport {\r\n  View,\r\n  TouchableOpacity,\r\n  Text,\r\n  Platform,\r\n  type LayoutChangeEvent,\r\n  type ListRenderItemInfo,\r\n  FlatList,\r\n  type CellRendererProps,\r\n} from 'react-native';\r\nimport Animated, {\r\n  runOnJS,\r\n  useAnimatedScrollHandler,\r\n  useAnimatedStyle,\r\n  useSharedValue,\r\n  withTiming,\r\n} from 'react-native-reanimated';\r\nimport type { ReanimatedScrollEvent } from 'react-native-reanimated/lib/typescript/hook/commonTypes';\r\nimport DayAnimated from './components/DayAnimated';\r\nimport Item from './components/Item';\r\n\r\nimport { LoadEarlier } from '../LoadEarlier';\r\nimport { type IMessage } from '../types';\r\nimport TypingIndicator from '../TypingIndicator';\r\nimport { type MessageContainerProps, type DaysPositions } from './types';\r\nimport { type ItemProps } from './components/Item/types';\r\n\r\nimport { warning } from '../logging';\r\nimport stylesCommon from '../styles';\r\nimport styles from './styles';\r\nimport { isSameDay } from '../utils';\r\n\r\nexport * from './types';\r\n\r\nconst AnimatedFlatList = Animated.createAnimatedComponent(FlatList) as any;\r\n\r\nfunction MessageContainer<TMessage extends IMessage = IMessage>(\r\n  props: MessageContainerProps<TMessage>\r\n) {\r\n  const {\r\n    messages = [],\r\n    user,\r\n    isTyping = false,\r\n    renderChatEmpty: renderChatEmptyProp,\r\n    onLoadEarlier,\r\n    inverted = true,\r\n    loadEarlier = false,\r\n    listViewProps,\r\n    invertibleScrollViewProps,\r\n    extraData = null,\r\n    isScrollToBottomEnabled = false,\r\n    scrollToBottomOffset = 200,\r\n    alignTop = false,\r\n    scrollToBottomStyle,\r\n    infiniteScroll = false,\r\n    isLoadingEarlier = false,\r\n    renderTypingIndicator: renderTypingIndicatorProp,\r\n    renderFooter: renderFooterProp,\r\n    renderLoadEarlier: renderLoadEarlierProp,\r\n    forwardRef,\r\n    handleOnScroll: handleOnScrollProp,\r\n    scrollToBottomComponent: scrollToBottomComponentProp,\r\n    renderDay: renderDayProp,\r\n    onPressFile,\r\n    onLongPressReaction,\r\n  } = props;\r\n\r\n  const scrollToBottomOpacity = useSharedValue(0);\r\n  const [isScrollToBottomVisible, setIsScrollToBottomVisible] = useState(false);\r\n  const scrollToBottomStyleAnim = useAnimatedStyle(\r\n    () => ({\r\n      opacity: scrollToBottomOpacity.value,\r\n    }),\r\n    [scrollToBottomOpacity]\r\n  );\r\n\r\n  const daysPositions = useSharedValue<DaysPositions>({});\r\n  const listHeight = useSharedValue(0);\r\n  const scrolledY = useSharedValue(0);\r\n\r\n  const renderTypingIndicator = useCallback(() => {\r\n    if (renderTypingIndicatorProp) return renderTypingIndicatorProp();\r\n    if (isTyping) return <TypingIndicator />;\r\n\r\n    return null;\r\n  }, [isTyping, renderTypingIndicatorProp]);\r\n\r\n  const ListFooterComponent = useMemo(() => {\r\n    if (renderFooterProp) return <>{renderFooterProp(props)}</>;\r\n\r\n    return <>{renderTypingIndicator()}</>;\r\n  }, [renderFooterProp, renderTypingIndicator, props]);\r\n\r\n  const renderLoadEarlier = useCallback(() => {\r\n    if (loadEarlier) {\r\n      if (renderLoadEarlierProp) return renderLoadEarlierProp(props);\r\n\r\n      return <LoadEarlier {...props} />;\r\n    }\r\n\r\n    return null;\r\n  }, [loadEarlier, renderLoadEarlierProp, props]);\r\n\r\n  const scrollTo = useCallback(\r\n    (options: { animated?: boolean; offset: number }) => {\r\n      if (forwardRef?.current && options)\r\n        forwardRef.current.scrollToOffset(options);\r\n    },\r\n    [forwardRef]\r\n  );\r\n\r\n  const doScrollToBottom = useCallback(\r\n    (animated: boolean = true) => {\r\n      if (inverted) scrollTo({ offset: 0, animated });\r\n      else if (forwardRef?.current)\r\n        forwardRef.current.scrollToEnd({ animated });\r\n    },\r\n    [forwardRef, inverted, scrollTo]\r\n  );\r\n\r\n  const handleOnScroll = useCallback(\r\n    (event: ReanimatedScrollEvent) => {\r\n      handleOnScrollProp?.(event);\r\n\r\n      const {\r\n        contentOffset: { y: contentOffsetY },\r\n        contentSize: { height: contentSizeHeight },\r\n        layoutMeasurement: { height: layoutMeasurementHeight },\r\n      } = event;\r\n\r\n      const duration = 250;\r\n\r\n      const makeScrollToBottomVisible = () => {\r\n        setIsScrollToBottomVisible(true);\r\n        scrollToBottomOpacity.value = withTiming(1, { duration });\r\n      };\r\n\r\n      const makeScrollToBottomHidden = () => {\r\n        scrollToBottomOpacity.value = withTiming(\r\n          0,\r\n          { duration },\r\n          (isFinished) => {\r\n            if (isFinished) runOnJS(setIsScrollToBottomVisible)(false);\r\n          }\r\n        );\r\n      };\r\n\r\n      if (inverted)\r\n        if (contentOffsetY > scrollToBottomOffset!) makeScrollToBottomVisible();\r\n        else makeScrollToBottomHidden();\r\n      else if (\r\n        contentOffsetY < scrollToBottomOffset! &&\r\n        contentSizeHeight - layoutMeasurementHeight > scrollToBottomOffset!\r\n      )\r\n        makeScrollToBottomVisible();\r\n      else makeScrollToBottomHidden();\r\n    },\r\n    [handleOnScrollProp, inverted, scrollToBottomOffset, scrollToBottomOpacity]\r\n  );\r\n\r\n  const renderItem = useCallback(\r\n    ({\r\n      item,\r\n      index,\r\n    }: ListRenderItemInfo<unknown>): React.ReactElement | null => {\r\n      const messageItem = item as TMessage;\r\n\r\n      if (!messageItem._id && messageItem._id !== 0)\r\n        warning(\r\n          'GiftedChat: `_id` is missing for message',\r\n          JSON.stringify(item)\r\n        );\r\n\r\n      if (!messageItem.user) {\r\n        if (!messageItem.system)\r\n          warning(\r\n            'GiftedChat: `user` is missing for message',\r\n            JSON.stringify(messageItem)\r\n          );\r\n\r\n        messageItem.user = { _id: 0 };\r\n      }\r\n\r\n      const { messages, ...restProps } = props;\r\n\r\n      if (messages && user) {\r\n        const previousMessage =\r\n          (inverted ? messages[index + 1] : messages[index - 1]) ||\r\n          ({} as TMessage);\r\n        const nextMessage =\r\n          (inverted ? messages[index - 1] : messages[index + 1]) ||\r\n          ({} as TMessage);\r\n\r\n        const messageProps: ItemProps<TMessage> = {\r\n          ...restProps,\r\n          currentMessage: messageItem,\r\n          previousMessage,\r\n          nextMessage,\r\n          position: messageItem.user._id === user._id ? 'right' : 'left',\r\n          scrolledY,\r\n          daysPositions,\r\n          listHeight,\r\n          onPressFile,\r\n          onLongPressReaction,\r\n        };\r\n\r\n        return <Item<TMessage> {...messageProps} />;\r\n      }\r\n\r\n      return null;\r\n    },\r\n    [\r\n      props,\r\n      inverted,\r\n      scrolledY,\r\n      daysPositions,\r\n      listHeight,\r\n      user,\r\n      onPressFile,\r\n      onLongPressReaction,\r\n    ]\r\n  );\r\n\r\n  const renderChatEmpty = useCallback(() => {\r\n    if (renderChatEmptyProp)\r\n      return inverted ? (\r\n        renderChatEmptyProp()\r\n      ) : (\r\n        <View style={[stylesCommon.fill, styles.emptyChatContainer]}>\r\n          {renderChatEmptyProp()}\r\n        </View>\r\n      );\r\n\r\n    return <View style={stylesCommon.fill} />;\r\n  }, [inverted, renderChatEmptyProp]);\r\n\r\n  const ListHeaderComponent = useMemo(() => {\r\n    const content = renderLoadEarlier();\r\n\r\n    if (!content) return null;\r\n\r\n    return <View style={stylesCommon.fill}>{content}</View>;\r\n  }, [renderLoadEarlier]);\r\n\r\n  const renderScrollBottomComponent = useCallback(() => {\r\n    if (scrollToBottomComponentProp) return scrollToBottomComponentProp();\r\n\r\n    return <Text>{'V'}</Text>;\r\n  }, [scrollToBottomComponentProp]);\r\n\r\n  const renderScrollToBottomWrapper = useCallback(() => {\r\n    if (!isScrollToBottomVisible) return null;\r\n\r\n    return (\r\n      <TouchableOpacity onPress={() => doScrollToBottom()}>\r\n        <Animated.View\r\n          style={[\r\n            stylesCommon.centerItems,\r\n            styles.scrollToBottomStyle,\r\n            scrollToBottomStyle,\r\n            scrollToBottomStyleAnim,\r\n          ]}\r\n        >\r\n          {renderScrollBottomComponent()}\r\n        </Animated.View>\r\n      </TouchableOpacity>\r\n    );\r\n  }, [\r\n    scrollToBottomStyle,\r\n    renderScrollBottomComponent,\r\n    doScrollToBottom,\r\n    scrollToBottomStyleAnim,\r\n    isScrollToBottomVisible,\r\n  ]);\r\n\r\n  const onLayoutList = useCallback(\r\n    (event: LayoutChangeEvent) => {\r\n      listHeight.value = event.nativeEvent.layout.height;\r\n\r\n      if (!inverted && messages?.length)\r\n        setTimeout(() => {\r\n          doScrollToBottom(false);\r\n        }, 500);\r\n\r\n      listViewProps?.onLayout?.(event);\r\n    },\r\n    [inverted, messages, doScrollToBottom, listHeight, listViewProps]\r\n  );\r\n\r\n  const onEndReached = useCallback(() => {\r\n    if (\r\n      infiniteScroll &&\r\n      loadEarlier &&\r\n      onLoadEarlier &&\r\n      !isLoadingEarlier &&\r\n      Platform.OS !== 'web'\r\n    )\r\n      onLoadEarlier();\r\n  }, [infiniteScroll, loadEarlier, onLoadEarlier, isLoadingEarlier]);\r\n\r\n  const keyExtractor: any = useCallback(\r\n    (item: unknown) => (item as TMessage)._id.toString(),\r\n    []\r\n  );\r\n\r\n  const renderCell = useCallback(\r\n    (props: CellRendererProps<unknown>) => {\r\n      const handleOnLayout = (event: LayoutChangeEvent) => {\r\n        props.onLayout?.(event);\r\n\r\n        const { y, height } = event.nativeEvent.layout;\r\n\r\n        const newValue = {\r\n          y,\r\n          height,\r\n          createdAt: new Date((props?.item as IMessage)?.createdAt).getTime(),\r\n        };\r\n\r\n        daysPositions.modify((value) => {\r\n          'worklet';\r\n\r\n          const isSameDay = (date1: number, date2: number) => {\r\n            const d1 = new Date(date1);\r\n            const d2 = new Date(date2);\r\n\r\n            return (\r\n              d1.getDate() === d2.getDate() &&\r\n              d1.getMonth() === d2.getMonth() &&\r\n              d1.getFullYear() === d2.getFullYear()\r\n            );\r\n          };\r\n\r\n          for (const [key, item] of Object.entries(value))\r\n            if (\r\n              isSameDay(newValue.createdAt, item.createdAt) &&\r\n              (inverted ? item.y <= newValue.y : item.y >= newValue.y)\r\n            ) {\r\n              delete value[key];\r\n              break;\r\n            }\r\n\r\n          // @ts-expect-error: https://docs.swmansion.com/react-native-reanimated/docs/core/useSharedValue#remarks\r\n          value[props.item._id] = newValue;\r\n          return value;\r\n        });\r\n      };\r\n\r\n      return (\r\n        <View {...props} onLayout={handleOnLayout}>\r\n          {props.children}\r\n        </View>\r\n      );\r\n    },\r\n    [daysPositions, inverted]\r\n  );\r\n\r\n  const scrollHandler = useAnimatedScrollHandler(\r\n    {\r\n      onScroll: (event) => {\r\n        scrolledY.value = event.contentOffset.y;\r\n\r\n        runOnJS(handleOnScroll)(event);\r\n      },\r\n    },\r\n    [handleOnScroll]\r\n  );\r\n\r\n  // removes unrendered days positions when messages are added/removed\r\n  useEffect(() => {\r\n    Object.keys(daysPositions.value).forEach((key) => {\r\n      const messageIndex = messages.findIndex((m) => m._id.toString() === key);\r\n      let shouldRemove = messageIndex === -1;\r\n\r\n      if (!shouldRemove) {\r\n        const prevMessage = messages[messageIndex + (inverted ? 1 : -1)] as\r\n          | IMessage\r\n          | undefined;\r\n        const message = messages[messageIndex] as IMessage;\r\n        shouldRemove = !!prevMessage && isSameDay(message, prevMessage);\r\n      }\r\n\r\n      if (shouldRemove)\r\n        daysPositions.modify((value) => {\r\n          'worklet';\r\n\r\n          delete value[key];\r\n          return value;\r\n        });\r\n    });\r\n  }, [messages, daysPositions, inverted]);\r\n\r\n  return (\r\n    <View\r\n      style={[\r\n        styles.contentContainerStyle,\r\n        alignTop ? styles.containerAlignTop : stylesCommon.fill,\r\n      ]}\r\n    >\r\n      <AnimatedFlatList\r\n        extraData={extraData}\r\n        ref={forwardRef as any}\r\n        keyExtractor={keyExtractor}\r\n        data={messages}\r\n        renderItem={renderItem as any}\r\n        inverted={inverted}\r\n        automaticallyAdjustContentInsets={false}\r\n        style={stylesCommon.fill}\r\n        {...invertibleScrollViewProps}\r\n        ListEmptyComponent={renderChatEmpty}\r\n        ListFooterComponent={\r\n          inverted ? ListHeaderComponent : ListFooterComponent\r\n        }\r\n        ListHeaderComponent={\r\n          inverted ? ListFooterComponent : ListHeaderComponent\r\n        }\r\n        onScroll={scrollHandler}\r\n        scrollEventThrottle={1}\r\n        onEndReached={onEndReached}\r\n        onEndReachedThreshold={0.1}\r\n        {...listViewProps}\r\n        onLayout={onLayoutList}\r\n        CellRendererComponent={renderCell}\r\n      />\r\n      {isScrollToBottomEnabled ? renderScrollToBottomWrapper() : null}\r\n      <DayAnimated\r\n        scrolledY={scrolledY}\r\n        daysPositions={daysPositions}\r\n        listHeight={listHeight}\r\n        renderDay={renderDayProp}\r\n        messages={messages}\r\n        isLoadingEarlier={isLoadingEarlier}\r\n      />\r\n    </View>\r\n  );\r\n}\r\n\r\nexport default MessageContainer;\r\n"],"mappings":"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","ignoreList":[]}